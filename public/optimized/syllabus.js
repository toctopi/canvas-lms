define(["jquery","calendar_move","wikiSidebar","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.loadingImg","compiled/tinymce","tinymce.editor_box","vendor/jquery.scrollTo","jqueryui/datepicker"],function(a,b,c){a(function(a){function d(){k.find(".day.has_event").removeClass("has_event"),j.find("tr.date").each(function(){var b=a(this).find(".day_date").attr("data-date").split("/"),c=b.join("_"),d=[b[2],b[0],b[1]].join("_");k.find(".mini_calendar_day.date_"+c+", #mini_day_"+d).addClass("has_event")})}function e(b,c){a("tr.date.related,.day.related").removeClass("related");if(b){var d=c.split("/"),e=d.join("_"),f=[d[2],d[0],d[1]].join("_");k.find(".mini_calendar_day.date_"+e+", #mini_day_"+f).add(j.find("tr.date.events_"+e)).addClass("related")}}var f=a("#edit_course_syllabus_form"),g=a("#course_syllabus_body"),h=a("#course_syllabus"),i=a("#course_syllabus_details"),j=a("#syllabus"),k=a(".mini_month");k.find(".next_month_link, .prev_month_link").bind("mousedown",function(c){c.preventDefault(),b.changeMonth(k,a(this).hasClass("next_month_link")?1:-1),d()}).bind("click",!1),k.delegate(".mini_calendar_day","click",function(c){c.preventDefault();var f=a(this).find(".day_number").attr("title");b.changeMonth(k,f),d(),a(".events_"+f.replace(/\//g,"_")).ifExists(function(b){a("html,body").scrollTo(b),e(!0,f)})}).delegate(".mini_calendar_day","mouseover mouseout",function(b){e(b.type==="mouseover",a(this).find(".day_number").attr("title"))}),j.delegate("tr.date","mouseenter mouseleave",function(b){e(b.type==="mouseenter",a(this).find(".day_date").attr("title"))}),a(".jump_to_today_link").click(function(c){c.preventDefault();var d=a.datepicker.formatDate("mm/dd/yy",new Date),f;a("tr.date").each(function(){var b=a(this).find(".day_date").attr("title");if(b>d)return!1;f=a(this)}),b.changeMonth(k,d),a("html,body").scrollTo(f||a("tr.date:first")),e(!0,d)}),c&&c.init(),f.bind("edit",function(){f.show(),h.hide(),i.hide(),g.editorBox(),g.editorBox("set_code",h.html()),c&&(c.attachToEditor(g),c.show(),a("#sidebar_content").hide())}),f.bind("hide_edit",function(){f.hide(),h.show();var b=a.trim(h.html());i.showIf(!b),g.editorBox("destroy"),a("#sidebar_content").show(),c&&c.hide()}),a(".edit_syllabus_link").click(function(b){b.preventDefault(),a("#edit_course_syllabus_form").triggerHandler("edit")}),f.find(".toggle_views_link").click(function(a){a.preventDefault(),g.editorBox("toggle")}),f.find(".cancel_button").click(function(a){f.triggerHandler("hide_edit"),a.preventDefault()}),f.formSubmit({object_name:"course",processData:function(a){return a["course[syllabus_body]"]=g.editorBox("get_code"),a},beforeSubmit:function(a){f.triggerHandler("hide_edit"),i.hide(),h.loadingImage()},success:function(a){h.loadingImage("remove").html(a.course.syllabus_body),i.hide()},error:function(a){f.triggerHandler("edit").formErrors(a)}}),a.scrollSidebar(),d()})})