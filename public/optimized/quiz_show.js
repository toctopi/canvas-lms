define(["i18n!quizzes.show","jquery","jquery.instructure_date_and_time","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","message_students"],function(a,b){b(document).ready(function(){function c(){var a={};b(".student_list .student").each(function(c){var d={};d.id=b(this).attr("data-id"),d.name=b.trim(b(this).find(".name").text()),d.submitted=b(this).closest(".student_list").hasClass("submitted"),a[d.id]=d});var c=[];for(var d in a)c.push(a[d]);return c}b(".delete_quiz_link").click(function(d){d.preventDefault(),students=c(),submittedCount=b.grep(students,function(a){return a.submitted}).length;var e=a.t("confirms.delete_quiz","Are you sure you want to delete this quiz?");submittedCount<0&&(e+="\n\n"+a.t("confirms.delete_quiz_submissions_warning",{one:"Warning: 1 student has already taken this quiz. If you delete it, any completed submissions will be deleted and no longer appear in the gradebook.",other:"Warning: %{count} students have already taken this quiz. If you delete it, any completed submissions will be deleted and no longer appear in the gradebook."},{count:submittedCount})),b("nothing").confirmDelete({url:b(this).attr("href"),message:e,success:function(){window.location.href=b("#context_quizzes_url").attr("href")}})}),b(".quiz_details_link").click(function(a){a.preventDefault(),b("#quiz_details").slideToggle()}),b(".message_students_link").click(function(d){d.preventDefault(),students=c();var e=b("#quiz_title").text();window.messageStudents({options:[{text:a.t("have_taken_the_quiz","Have taken the quiz")},{text:a.t("have_not_taken_the_quiz","Have NOT taken the quiz")}],title:e,students:students,callback:function(c,d,e){return e=b.grep(e,function(b,d){var e=b.user_data;if(c==a.t("have_taken_the_quiz","Have taken the quiz"))return e.submitted;if(c==a.t("have_not_taken_the_quiz","Have NOT taken the quiz"))return!e.submitted}),b.map(e,function(a){return a.user_data.id})}})}),b.scrollSidebar(),b("#let_students_take_this_quiz_button").ifExists(function(a){var c=b("#unlock_for_how_long_dialog");a.click(function(){return c.dialog("open"),!1}),c.dialog({autoOpen:!1,modal:!0,resizable:!1,width:400,buttons:{Unlock:function(){var c=b(this).find(".datetime_suggest").text();a.closest("form").append(b(this).dialog("destroy")).find("#quiz_lock_at").val(c).end().submit()}}}).find(".datetime_field").datetime_field()})})})