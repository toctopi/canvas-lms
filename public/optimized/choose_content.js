define(["jquery","i18n!content_imports","compiled/util/processMigrationItemSelections","jquery.ajaxJSON","jquery.instructure_date_and_time","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_plugins","jquery.rails_flash_notifications","jqueryui/autocomplete","jqueryui/progressbar"],function(a,b,c){a(function(){var d=a("<iframe id='copy_course_target' name='copy_course_target' src='about:blank'/>");a("body").append(d.hide()),a("#copy_context_form").attr("target","copy_course_target"),a(".copy_progress").progressbar();var e=function(c){a.ajaxJSON(c,"GET",{},function(d){d&&d.workflow_state&&a(".copy_progress").progressbar("option","value",d.progress);if(!d||d.workflow_state!="completed"&&d.workflow_state!="imported")if(d&&d.workflow_state=="failed"){var f=b.t("errors.failed","Course Import failed with the following error:")+' "import_'+d.id+'"';a.flashError(f),a(".progress_bar_holder").after("<b>"+f+"</b>")}else setTimeout(function(){e(c)},1500);else window.location=ENV.COPY_COURSE_FINISH_URL+"?content_migration_id="+d.id},function(){setTimeout(function(){e(c)},3e3)})};a("#copy_context_form").formSubmit({processData:c,beforeSubmit:function(c){a("#copy_context_form .submit_button").text(b.t("messages.copying","Copying... this will take a few minutes")).attr("disabled",!0),a(".progress_bar_holder").show()},success:function(a){setTimeout(function(){e(a.status_url)},5e3)}}),a("#copy_entries_dialog button").click(function(){var b=a("#copy_all_discussion_topics"),c=a(this).hasClass("include");c?b.parent().next("ul").find(":checkbox:not(.secondary_checkbox)").prop("checked",b.prop("checked")).each(function(){a(this).triggerHandler("change",!0)}):b.parent().next("ul").find(":checkbox:not(.secondary_checkbox)").prop("checked",b.prop("checked")),a("#copy_entries_dialog").dialog("close")});var f=function(b){a("#copy_context_form :checkbox:not(.secondary_checkbox):not(.copy_everything):not(.skip_on_everything):not(.shift_dates_checkbox)").prop("checked",b).filter(":not(.copy_all)").each(function(){a(this).triggerHandler("change")})},g,h=a("#item_selections");a("#copy_context_form").delegate(":checkbox","change",function(b,c){a(this).attr("checked")||(c=!0);if(a(this).hasClass("copy_all"))a(this).parent().next("ul").find(":checkbox:not(.secondary_checkbox)").prop("checked",a(this).prop("checked")).each(function(){a(this).triggerHandler("change")}),a("#copy_everything").attr("checked",!1);else if(a(this).hasClass("copy_everything"))if(a(this).prop("checked"))h.hide();else{var d=ENV.CONTENT_SELECT_URL;g=g||a.ajaxJSON(d,"GET",{},function(a){a&&(h.find(".content_list").html(a.selection_list),f(!1))}),h.show().disableWhileLoading(g)}else a(this).parent().find(":checkbox.secondary_checkbox"+(c?"":":not(.skip)")).attr("checked",a(this).attr("checked")),a(this).hasClass("secondary_checkbox")&&a(this).attr("checked")&&a(this).parents("li").children(":checkbox").attr("checked",!0),a(this).attr("checked")||(a(this).parents("ul").each(function(){a(this).prev("h2,h3,h4").find(":checkbox").attr("checked",!1)}),a(this).is("#copy_shift_dates")||a("#copy_everything").attr("checked",!1))}),a("#check_everything").click(function(a){a.preventDefault(),f(!0)}),a("#uncheck_everything").click(function(a){a.preventDefault(),f(!1)}),a(".shift_dates_checkbox").change(function(){a(".shift_dates_settings").showIf(a(this).attr("checked"))}).change(),a(".add_substitution_link").click(function(b){b.preventDefault();var c=a(".substitution_blank").clone(!0).removeClass("substitution_blank");a(".substitutions").append(c.hide());var d=a(".weekday_select_blank").clone(!0).removeClass("weekday_select_blank");c.find(".old_select").empty().append(d.clone(!0)),c.find(".new_select").empty().append(d),c.find(".old_select").children("select").change(),c.slideDown()}),a(".weekday_select").change(function(){if(a(this).parents(".old_select").length>0){var b=a(this).parents(".substitution").find(".new_select").children("select");b.attr("name","copy[day_substitutions]["+a(this).val()+"]")}}),a(".delete_substitution_link").click(function(b){b.preventDefault(),a(this).parents(".substitution").slideUp(function(){a(this).remove()})}),a("#copy_context_form .copy_all").each(function(){a(this).triggerHandler("change")}),a(".date_field").date_field()})})