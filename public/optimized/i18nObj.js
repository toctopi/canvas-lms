define(["jquery","str/htmlEscape","str/pluralize","str/escapeRegex","vendor/date"],function(a,b,c,d){var e=window.I18n={};return e.defaultLocale="en",e.defaultSeparator=".",e.locale=document.documentElement.getAttribute("lang"),e.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,e.isValidNode=function(a,b){var c=b.split(".");for(var d=0;d<c.length;d++)if(c[d]in a)a=a[c[d]];else return!1;return!0},e.lookup=function(a,b){var c=this.prepareOptions(e.translations),d=c[e.currentLocale()];b=this.prepareOptions(b);if(!d)return;typeof a=="object"&&(a=a.join(this.defaultSeparator)),b.scope&&(a=b.scope.toString()+this.defaultSeparator+a),a=a.split(this.defaultSeparator);while(a.length>0){var f=a.shift();d=d[f];if(!d)break}return!d&&this.isValidNode(b,"defaultValue")&&(d=b.defaultValue),d},e.prepareOptions=function(){var a={},b,c=arguments.length;for(var d=0;d<c;d++){b=arguments[d];if(!b)continue;for(var e in b)this.isValidNode(a,e)||(a[e]=b[e])}return a},e.interpolate=function(a,c){var d,e,f,g,h=!1;c=this.prepareOptions(c),c.wrapper&&(h=!0,a=this.applyWrappers(a,c.wrapper)),g=a.match(this.PLACEHOLDER)||[];for(var i=0;d=g[i];i++){f=d.replace(this.PLACEHOLDER,"$1");var j=f.split(".");e=c;for(var k=0;k<j.length;k++)e=e[j[k]];this.isValidNode(c,f)||(e="[missing "+d+" value]"),h?e.htmlSafe||(e=b(e)):e.htmlSafe&&(h=!0,a=b(a)),regex=new RegExp(d.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),a=a.replace(regex,e)}return a},e.wrapperRegexes={},e.applyWrappers=function(a,c){var e=[],f;a=b(a),typeof c=="string"&&(c={"*":c});for(f in c)e.push(f);e.sort().reverse();for(var g in e){f=e[g];if(!this.wrapperRegexes[f]){var h=d(f);this.wrapperRegexes[f]=new RegExp(h+"([^"+h+"]*)"+h,"g")}a=a.replace(this.wrapperRegexes[f],c[f])}return a},e.translate=function(a,b){b=this.prepareOptions(b);var c=this.lookup(a,b);try{return typeof c=="object"?typeof b.count=="number"?this.pluralize(b.count,a,b):c:this.interpolate(c,b)}catch(d){return this.missingTranslation(a)}},e.localize=function(a,b){switch(a){case"currency":return this.toCurrency(b);case"number":return a=this.lookup("number.format"),this.toNumber(b,a);case"percentage":return this.toPercentage(b);default:return a.match(/^(date|time)/)?this.toTime(a,b).replace(/\s{2,}/," "):b.toString()}},e.parseDate=function(a){var b,c;b=a.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ |T](\d{2}):(\d{2}):(\d{2}))?(Z)?/);if(b){for(var d=1;d<=6;d++)b[d]=parseInt(b[d],10)||0;b[2]-=1,b[7]?c=new Date(Date.UTC(b[1],b[2],b[3],b[4],b[5],b[6])):c=new Date(b[1],b[2],b[3],b[4],b[5],b[6])}else typeof a=="number"?(c=new Date,c.setTime(a)):(c=new Date,c.setTime(Date.parse(a)));return c},e.toTime=function(a,b){var c=this.parseDate(b),d=this.lookup(a);return c.toString().match(/invalid/i)?c.toString():d?this.strftime(c,d):c.toString()},e.strftime=function(a,b){var c=this.lookup("date");if(!c)return a.toString();c.meridian=c.meridian||["AM","PM"];var d=a.getDay(),e=a.getDate(),f=a.getFullYear(),g=a.getMonth()+1,h=1+Math.round((new Date(f,g-1,e)-new Date(f,0,1))/864e5),i=a.getHours(),j=i,k=i>11?1:0,l=a.getSeconds(),m=a.getMilliseconds(),n=a.getMinutes(),o=a.getTimezoneOffset(),p=Math.floor(a.getTime()/1e3),q=Math.floor(Math.abs(o/60)),r=Math.abs(o)-q*60,s=(o>0?"-":"+")+(q.toString().length<2?"0"+q:q)+(r.toString().length<2?"0"+r:r);j>12?j-=12:j===0&&(j=12);var t=function(a,b,c){typeof b=="undefined"&&(b="00"),typeof c=="undefined"&&(c=2);var d=b+a.toString();return d.substr(d.length-c)},u=b.replace(/%([DFrRTv])/g,function(a,b){return{D:"%m/%d/%y",F:"%Y-%m-%d",r:"%I:%M:%S %p",R:"%H:%M",T:"%H:%M:%S",v:"%e-%b-%Y"}[b]}).replace(/%(%|\-?[a-zA-Z]|3N)/g,function(a,b){switch(b){case"a":return c.abbr_day_names[d];case"A":return c.day_names[d];case"b":return c.abbr_month_names[g];case"B":return c.month_names[g];case"d":return t(e);case"-d":return e;case"e":return t(e," ");case"h":return c.abbr_month_names[g];case"H":return t(i);case"-H":return i;case"I":return t(j);case"-I":return j;case"j":return t(h,"00",3);case"k":return t(i," ");case"l":return t(j," ");case"L":return t(m,"00",3);case"m":return t(g);case"-m":return g;case"M":return t(n);case"-M":return n;case"n":return"\n";case"3N":return t(m,"00",3);case"p":return c.meridian[k];case"P":return c.meridian[k].toLowerCase();case"s":return p;case"S":return t(l);case"-S":return l;case"t":return"\t";case"u":return d||d+7;case"w":return d;case"y":return t(f);case"-y":return t(f).replace(/^0+/,"");case"Y":return f;case"z":return s;case"%":return"%";default:return a}});return u},e.toNumber=function(a,b){b=this.prepareOptions(b,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var c=a<0,d=Math.abs(a).toFixed(b.precision).toString(),e=d.split(".");a=e[0];var f=e[1],g=[];while(a.length>0)g.unshift(a.substr(Math.max(0,a.length-3),3)),a=a.substr(0,a.length-3);var h=g.join(b.delimiter);b.precision>0&&(h+=b.separator+e[1]),c&&(h="-"+h);if(b.strip_insignificant_zeros){var i={separator:new RegExp(b.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};h=h.replace(i.zeros,"").replace(i.separator,"")}return h},e.toCurrency=function(a,b){return b=this.prepareOptions(b,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),a=this.toNumber(a,b),a=b.format.replace("%u",b.unit).replace("%n",a),a},e.toHumanSize=function(a,b){var c=1024,d=a,e=0,f,g;while(d>=c&&e<4)d/=c,e+=1;return e===0?(f=this.t("number.human.storage_units.units.byte",{count:d}),g=0):(f=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][e]),g=d-Math.floor(d)===0?0:1),b=this.prepareOptions(b,{precision:g,format:"%n%u",delimiter:""}),a=this.toNumber(d,b),a=b.format.replace("%u",f).replace("%n",a),a},e.toPercentage=function(a,b){return b=this.prepareOptions(b,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),a=this.toNumber(a,b),a+"%"},e.pluralize=function(a,b,c){var d;try{d=this.lookup(b,c)}catch(e){}if(!d)return this.missingTranslation(b);var f;c=this.prepareOptions(c),c.count=a.toString();switch(Math.abs(a)){case 0:f=this.isValidNode(d,"zero")?d.zero:this.isValidNode(d,"none")?d.none:this.isValidNode(d,"other")?d.other:this.missingTranslation(b,"zero");break;case 1:f=this.isValidNode(d,"one")?d.one:this.missingTranslation(b,"one");break;default:f=this.isValidNode(d,"other")?d.other:this.missingTranslation(b,"other")}return this.interpolate(f,c)},e.missingTranslation=function(){var a='[missing "'+this.currentLocale(),b=arguments.length;for(var c=0;c<b;c++)a+="."+arguments[c];return a+='" translation]',a},e.currentLocale=function(){return e.locale||e.defaultLocale},e.t=e.translate,e.l=e.localize,e.p=e.pluralize,e.scoped=function(a,b){var c=new e.scope(a);return b&&b(c),c},e.scope=function(a){this.scope=a},e.scope.prototype={resolveScope:function(a){return typeof a=="object"&&(a=a.join(e.defaultSeparator)),a[0]=="#"?a.replace(/^#/,""):this.scope+e.defaultSeparator+a},translate:function(a,b,d){return d=d||{},typeof d.count!="undefined"&&typeof b=="string"&&b.match(/^[\w\-]+$/)&&(b=c.withCount(d.count,b)),d.defaultValue=b,e.translate(this.resolveScope(a),d)},localize:function(a,b){return e.localize(this.resolveScope(a),b)},pluralize:function(a,b,c){return e.pluralize(a,this.resolveScope(b),c)},beforeLabel:function(a,b){return typeof b!="undefined"&&(a=this.t("labels."+a,b)),this.t("#before_label_wrapper","%{text}:",{text:a})},toTime:function(a,b){return e.toTime(a,b)},toNumber:function(a,b){return e.toNumber(a,b)},toCurrency:function(a,b){return e.toCurrency(a,b)},toHumanSize:function(a,b){return e.toHumanSize(a,b)},toPercentage:function(a,b){return e.toPercentage(a,b)}},e.scope.prototype.t=e.scope.prototype.translate,e.scope.prototype.l=e.scope.prototype.localize,e.scope.prototype.p=e.scope.prototype.pluralize,e.translations?a.extend(!0,e.translations,{en:{}}):e.translations={en:{}},e})