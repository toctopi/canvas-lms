define(["i18n!calendars","jquery","jquery.instructure_date_and_time","jquery.templateData","jqueryui/datepicker"],function(a,b){function c(a){return{day:a.getDate(),month:a.getMonth(),year:a.getFullYear()}}var d=a.t("#date.month_names");return{changeMonth:function(a,e){var f=a.data("calendar_objects"),g={},h=null;if(typeof e=="string"){var h=b.datepicker.parseDate("mm/dd/yy",e);h&&h.setDate(1)}if(!h)var i=parseInt(a.find(".month_number").text(),10),j=parseInt(a.find(".year_number").text(),10),h=new Date(j,i+e-1,1);var g={month_name:d[h.getMonth()+1],month_number:h.getMonth()+1,year_number:h.getFullYear()};a.fillTemplateData({data:g});var k=new Date,l=c(k),m=c(h);k=h,k.setDate(0),k.setDate(k.getDate()-k.getDay());var n=c(k),o=null;m.day!=n.day&&(k.setDate(1),k.setMonth(k.getMonth()+1),k.setDate(0),o={day:k.getDate(),month:n.month,year:n.year},k.setDate(1),k.setMonth(k.getMonth()+1)),k.setMonth(h.getMonth()+1),k.setDate(0);var p={day:k.getDate(),month:m.month,year:m.yearh};k.setDate(k.getDate()+1),k.setDate(k.getDate()+(6-k.getDay())),k.setDate(k.getDate()+7);var q=c(k),r=a.data("days");r||(r=a.find(".calendar_day_holder"),a.data("days",r)),a.hasClass("mini_month")&&(r=a.find(".day")),a.find(".calendar_event").remove();var s=0,t=n.day,i=n.month,j=n.year;while(t<=q.day||i!=q.month){var u=r.eq(s);if(u.length>0){var v=u.attr("class").split(" "),w=[];for(var x=0;x<v.length;x++)v[x].indexOf("date_")!=0&&w.push(v[x]);u.attr("class",w.join(" "))}u.show().addClass("visible").parents("tr").show().addClass("visible");var g={day_number:t},y=i<9?"0"+(i+1):i+1,z=t<10?"0"+t:t;id="day_"+j+"_"+y+"_"+z,a.hasClass("mini_month")&&(id="mini_"+id),u.attr("id",id).find(".day_number").text(t).attr("title",y+"/"+z+"/"+j).addClass("date_"+y+"_"+z+"_"+j);var A=u.children("div");a.hasClass("mini_month")&&(A=u),A.removeClass("current_month other_month today"),i==m.month?A.addClass("current_month"):A.addClass("other_month"),i==l.month&&t==l.day&&j==l.year&&A.addClass("today"),t++,s++;if(o&&t>o.day&&i==o.month||t>p.day&&i==p.month)i+=1,i>=12&&(i-=12,j++),t=1}while(s<r.length){var u=r.eq(s);u.parents("tr").hide().removeClass("visible"),u.hide().removeClass("visible"),s++}!!a.hasClass("mini_month")}}})