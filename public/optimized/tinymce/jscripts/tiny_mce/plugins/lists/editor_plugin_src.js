(function(){function a(a,b){while(a&&(a.nodeType===8||a.nodeType===3&&/^[ \t\n\r]*$/.test(a.nodeValue)))a=b(a);return a}function b(b){return a(b,function(a){return a.previousSibling})}function c(b){return a(b,function(a){return a.nextSibling})}function d(a,b,c){return a.dom.getParent(b,function(a){return tinymce.inArray(c,a)!==-1})}function e(a){return a&&(a.tagName==="OL"||a.tagName==="UL")}function f(a,c){var d,f,g;d=b(a.lastChild);while(e(d))f=d,d=b(f.previousSibling);return f&&(g=c.create("li",{style:"list-style-type: none;"}),c.split(a,f),c.insertAfter(g,f),g.appendChild(f),g.appendChild(f),a=g.previousSibling),a}function g(a,b,c){return a=h(a,b,c),i(a,b,c)}function h(a,c,d){var e=b(a.previousSibling);return e?j(e,a,c?e:!1,d):a}function i(a,b,d){var e=c(a.nextSibling);return e?j(a,e,b?e:!1,d):a}function j(a,b,c,d){return k(a,b,!!c,d)?n(a,b,c):(a&&a.tagName==="LI"&&e(b)&&a.appendChild(b),b)}function k(a,b,c,d){return!a||!b?!1:a.tagName==="LI"&&b.tagName==="LI"?b.style.listStyleType==="none"||m(b):e(a)?a.tagName===b.tagName&&(c||a.style.listStyleType===b.style.listStyleType)||l(b):d&&a.tagName==="P"&&b.tagName==="P"}function l(a){var d=c(a.firstChild),f=b(a.lastChild);return d&&f&&e(a)&&d===f&&(e(d)||d.style.listStyleType==="none"||m(d))}function m(a){var d=c(a.firstChild),f=b(a.lastChild);return d&&f&&d===f&&e(d)}function n(a,d,e){var f=b(a.lastChild),g=c(d.firstChild);a.tagName==="P"&&a.appendChild(a.ownerDocument.createElement("br"));while(d.firstChild)a.appendChild(d.firstChild);return e&&(a.style.listStyleType=e.style.listStyleType),d.parentNode.removeChild(d),j(f,g,!1),a}function o(a,b){var c;return b.is(a,"li,ol,ul")||(c=b.getParent(a,"li"),c&&(a=c)),a}var p=tinymce.each,q=tinymce.dom.Event,r;tinymce.create("tinymce.plugins.Lists",{init:function(a){function b(b){return b.keyCode===tinymce.VK.TAB&&!b.altKey&&!b.ctrlKey&&(a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertOrderedList"))}function c(){var b=a.selection.getRng(),c=b.startContainer;return c.nodeType==3?b.endOffset==c.nodeValue.length:c.nodeType==1?b.endOffset==c.childNodes.length:!1}function d(){var b=a.selection.getNode(),d=b.tagName==="P"&&b.parentNode.tagName==="LI"&&b.parentNode.lastChild===b;return a.selection.isCollapsed()&&d&&c()}function f(){var a=i(),b=a.parentNode.parentNode,c=a.parentNode.lastChild===a;return c&&!g(b)&&j(a)}function g(a){return e(a)?a.parentNode&&a.parentNode.tagName==="LI":a.tagName==="LI"}function h(){return a.selection.isCollapsed()&&j(i())}function i(){var b=a.selection.getStart();return b.tagName!="BR"&&b.tagName!=""||b.parentNode.tagName!="LI"?b:b.parentNode}function j(a){var b=a.childNodes.length;return a.tagName==="LI"?b==0?!0:b==1&&(a.firstChild.tagName==""||a.firstChild.tagName=="BR"||k(a)):!1}function k(a){var b=tinymce.grep(a.parentNode.childNodes,function(a){return a.tagName=="LI"}),c=a==b[b.length-1],d=a.firstChild;return tinymce.isIE9&&c&&(d.nodeValue==String.fromCharCode(160)||d.nodeValue==String.fromCharCode(32))}function l(a){return a.keyCode===tinymce.VK.ENTER}function m(a){return l(a)&&!a.shiftKey}function n(a){return b(a)?x:m(a)&&f()?z:m(a)&&h()?y:m(a)&&d()?A:B}function o(a,b){(C==x||C==y||tinymce.isGecko&&C==z)&&q.cancel(b)}function p(a,b){if(C==A){var c=a.selection.getNode(),d=a.dom.create("li"),e=a.dom.getParent(c,"li");a.dom.insertAfter(d,e),tinyMCE.isIE8?(d.appendChild(a.dom.create("&nbsp;")),a.selection.setCursorLocation(d,1)):tinyMCE.isGecko?setTimeout(function(){var b=a.getDoc().createTextNode("﻿");d.appendChild(b),a.selection.setCursorLocation(d,0)},0):a.selection.setCursorLocation(d,0),q.cancel(b)}}function r(a,b){function c(a){var b=a.firstChild,c=null;do{if(!b)break;b.tagName==="LI"&&(c=b)}while(b=b.nextSibling);return c}function d(a,b){while(a.childNodes.length>0)b.appendChild(a.childNodes[0])}var e;if(!tinymce.isGecko)return;var f=a.selection.getStart();if(b.keyCode!=tinymce.VK.BACKSPACE||f.tagName!=="IMG")return;e=f.parentNode.previousSibling;if(!e)return;var g;if(e.tagName==="UL"||e.tagName==="OL")g=e;else{if(!e.previousSibling||e.previousSibling.tagName!=="UL"&&e.previousSibling.tagName!=="OL")return;g=e.previousSibling}var h=c(g),i=a.dom.createRng();i.setStart(h,1),i.setEnd(h,1),a.selection.setRng(i),a.selection.collapse(!0);var j=a.selection.getBookmark(),k=f.parentNode.cloneNode(!0);k.tagName==="P"||k.tagName==="DIV"?d(k,h):h.appendChild(k),f.parentNode.parentNode.removeChild(f.parentNode),a.selection.moveToBookmark(j)}function s(b){var c=a.dom.getParent(b,"ol,ul");if(c!=null){var d=c.lastChild;d.appendChild(a.getDoc().createElement("")),a.selection.setCursorLocation(d,0)}}function t(b,c){var d=a.getDoc().createTextNode("﻿");b.insertBefore(d,c),a.selection.setCursorLocation(d,0),a.execCommand("mceRepaint")}function u(a,b){if(l(b)){var c=i();if(c){var d=c.parentNode,e=d&&d.parentNode;e&&e.nodeName=="LI"&&e.firstChild==d&&c==d.firstChild&&t(e,d)}}}function v(a,b){if(l(b)){var c=i();if(a.dom.select("ul li",c).length===1){var d=c.firstChild;t(c,d)}}}function w(a,b){function c(b,c){var d=[],e=new tinymce.dom.TreeWalker(c,b);for(var f=e.current();f;f=e.next())a.dom.is(f,"ol,ul,li")&&d.push(f);return d}if(b.keyCode==tinymce.VK.BACKSPACE){var d=i();if(d){var e=a.dom.getParent(d,"ol,ul");if(e&&e.firstChild===d){var f=c(e,d);return a.execCommand("Outdent",!1,f),a.undoManager.add(),q.cancel(b)}}}}var x="TABBING",y="EMPTY",z="ESCAPE",A="PARAGRAPH",B="UNKNOWN",C=B;this.ed=a,a.addCommand("Indent",this.indent,this),a.addCommand("Outdent",this.outdent,this),a.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),a.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),a.onInit.add(function(){a.editorCommands.addCommands({outdent:function(){function b(b){return b=d.getParent(b,d.isBlock),b&&parseInt(a.dom.getStyle(b,"margin-left")||0,10)+parseInt(a.dom.getStyle(b,"padding-left")||0,10)>0}var c=a.selection,d=a.dom;return b(c.getStart())||b(c.getEnd())||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertUnorderedList")}},"state")}),a.onKeyUp.add(function(a,b){if(C==x)return a.execCommand(b.shiftKey?"Outdent":"Indent",!0,null),C=B,q.cancel(b);if(C==y){var c=i(),d=a.settings.list_outdent_on_enter===!0||b.shiftKey;return a.execCommand(d?"Outdent":"Indent",!0,null),tinymce.isIE&&s(c),q.cancel(b)}if(C==z)if(tinymce.isIE8){var e=a.getDoc().createTextNode("﻿");a.selection.getNode().appendChild(e)}else if(tinymce.isIE9||tinymce.isGecko)return a.execCommand("Outdent"),q.cancel(b)}),a.onKeyDown.add(function(a,b){C=n(b)}),a.onKeyDown.add(o),a.onKeyDown.add(r),a.onKeyDown.add(p),tinymce.isGecko&&a.onKeyUp.add(u),tinymce.isIE8&&a.onKeyUp.add(v),(tinymce.isGecko||tinymce.isWebKit)&&a.onKeyDown.add(w)},applyList:function(a,b){function c(a){a&&a.tagName==="BR"&&q.remove(a)}function d(b){function d(a){(a.style.marginLeft||a.style.paddingLeft)&&m.adjustPaddingFunction(!1)(a)}var f=q.create(a),i;if(b.tagName!=="LI"){if(b.tagName==="P"||b.tagName==="DIV"||b.tagName==="BODY"){h(b,function(a,f){e(a,f,b.tagName==="BODY"?null:a.parentNode),i=a.parentNode,d(i),c(f)}),i&&(i.tagName==="LI"&&(b.tagName==="P"||x.length>1)&&q.split(i.parentNode.parentNode,i.parentNode),g(i.parentNode,!0));return}i=q.create("li"),q.insertAfter(i,b),i.appendChild(b),d(b),b=i}q.insertAfter(f,b),f.appendChild(b),g(f,!0),s.push(b)}function e(a,b,c){var e,f=a,g;while(!q.isBlock(a.parentNode)&&a.parentNode!==q.getRoot())a=q.split(a.parentNode,a.previousSibling),a=a.nextSibling,f=a;if(c){e=c.cloneNode(!0),a.parentNode.insertBefore(e,a);while(e.firstChild)q.remove(e.firstChild);e=q.rename(e,"li")}else e=q.create("li"),a.parentNode.insertBefore(e,a);while(f&&f!=b)g=f.nextSibling,e.appendChild(f),f=g;e.childNodes.length===0&&(e.innerHTML='<br _mce_bogus="1" />'),d(e)}function h(a,b){function c(a,b){var c=q.createRng(),d;return r.keep=!0,n.selection.moveToBookmark(r),r.keep=!1,d=n.selection.getRng(!0),b||(b=a.parentNode.lastChild),c.setStartBefore(a),c.setEndAfter(b),c.compareBoundaryPoints(g,d)<=0&&c.compareBoundaryPoints(h,d)>0}function d(a){if(a.nextSibling)return a.nextSibling;if(!q.isBlock(a.parentNode)&&a.parentNode!==q.getRoot())return d(a.parentNode)}var e,f,g=3,h=1,i="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";e=a.firstChild;var j=!1;p(q.select(i,a),function(a){if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;c(e,a)&&(q.addClass(a,"_mce_tagged_br"),e=d(a))}),j=e&&c(e,undefined),e=a.firstChild,p(q.select(i,a),function(a){var c=d(a);if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;q.hasClass(a,"_mce_tagged_br")?(b(e,a,f),f=null):f=a,e=c}),j&&b(e,undefined,f)}function j(a){h(a,function(a,b,d){e(a,b),c(b),c(d)})}function k(a){if(tinymce.inArray(s,a)!==-1)return;a.parentNode.tagName===b&&(q.split(a.parentNode,a),d(a),i(a.parentNode,!1)),s.push(a)}function l(a){var b,c,d,e;if(tinymce.inArray(s,a)!==-1)return;a=f(a,q);while(q.is(a.parentNode,"ol,ul,li"))q.split(a.parentNode,a);s.push(a),a=q.rename(a,"p"),d=g(a,!1,n.settings.force_br_newlines);if(d===a){b=a.firstChild;while(b)q.isBlock(b)?(b=q.split(b.parentNode,b),e=!0,c=b.nextSibling&&b.nextSibling.firstChild):(c=b.nextSibling,e&&b.tagName==="BR"&&q.remove(b),e=!1),b=c}}var m=this,n=m.ed,q=n.dom,s=[],t=!1,u=!1,v=!1,w,x=n.selection.getSelectedBlocks();p(x,function(c){c=o(c,q),c.tagName===b||c.tagName==="LI"&&c.parentNode.tagName===b?u=!0:c.tagName===a||c.tagName==="LI"&&c.parentNode.tagName===a?t=!0:v=!0}),v&&!t||u||x.length===0?w={LI:k,H1:d,H2:d,H3:d,H4:d,H5:d,H6:d,P:d,BODY:d,DIV:x.length>1?d:j,defaultAction:j,elements:this.selectedBlocks()}:w={defaultAction:l,elements:this.selectedBlocks()},this.process(w)},indent:function(){function a(a){var b=h.create("li",{style:"list-style-type: none;"});return h.insertAfter(b,a),b}function b(b){var c=a(b),d=h.getParent(b,"ol,ul"),e=d.tagName,f=h.getStyle(d,"list-style-type"),g={},i;return f!==""&&(g.style="list-style-type: "+f+";"),i=h.create(e,g),c.appendChild(i),i}function c(a){if(!d(e,a,i)){a=f(a,h);var c=b(a);c.appendChild(a),g(c.parentNode,!1),g(c,!1),i.push(a)}}var e=this.ed,h=e.dom,i=[];this.process({LI:c,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(a,b){function c(a){var b,c,g;if(!d(h,a,j)){if(i.getStyle(a,"margin-left")!==""||i.getStyle(a,"padding-left")!=="")return e.adjustPaddingFunction(!1)(a);g=i.getStyle(a,"text-align",!0);if(g==="center"||g==="right"){i.setStyle(a,"text-align","left");return}a=f(a,i),b=a.parentNode,c=a.parentNode.parentNode,c.tagName==="P"?i.split(c,a.parentNode):(i.split(b,a),c.tagName==="LI"?i.split(c,a):i.is(c,"ol,ul")||i.rename(a,"p")),j.push(a)}}var e=this,h=e.ed,i=h.dom,j=[],k=b&&tinymce.is(b,"array")?b:this.selectedBlocks();this.process({LI:c,defaultAction:this.adjustPaddingFunction(!1),elements:k}),p(j,g)},process:function(a){function b(a){var b=tinymce.grep(a.childNodes,function(a){return a.nodeName!=="BR"&&(a.nodeName!=="SPAN"||i.getAttrib(a,"data-mce-type")!="bookmark")&&(a.nodeType!=3||a.nodeValue!=String.fromCharCode(160)&&a.nodeValue!="")});return b.length===0}function c(c){i.removeClass(c,"_mce_act_on");if(!c||c.nodeType!==1||j.length>1&&b(c))return;c=o(c,i);var d=a[c.tagName];d||(d=a.defaultAction),d(c)}function d(a){g.splitSafeEach(a.childNodes,c)}function e(a,b){return b>=0&&a.hasChildNodes()&&b<a.childNodes.length&&a.childNodes[b].tagName==="BR"}function f(){var a=h.getNode(),b=i.getParent(a,"td");return b!==null}var g=this,h=g.ed.selection,i=g.ed.dom,j,k;j=a.elements,k=h.getRng(!0),k.collapsed||(e(k.endContainer,k.endOffset-1)&&(k.setEnd(k.endContainer,k.endOffset-1),h.setRng(k)),e(k.startContainer,k.startOffset)&&(k.setStart(k.startContainer,k.startOffset+1),h.setRng(k)));if(tinymce.isIE8){var l=g.ed.selection.getNode();if(l.tagName==="LI"&&l.parentNode.lastChild!==l){var m=g.ed.getDoc().createTextNode("﻿");l.appendChild(m)}}r=h.getBookmark(),a.OL=a.UL=d,g.splitSafeEach(j,c),h.moveToBookmark(r),r=null,f()||g.ed.execCommand("mceRepaint")},splitSafeEach:function(a,b){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(a,b):p(a,b)},classBasedEach:function(a,b){var c=this.ed.dom,d,e;p(a,function(a){c.addClass(a,"_mce_act_on")}),d=c.select("._mce_act_on");while(d.length>0)e=d.shift(),c.removeClass(e,"_mce_act_on"),b(e),d=c.select("._mce_act_on")},adjustPaddingFunction:function(a){var b,c,d=this.ed;return b=d.settings.indentation,c=/[a-z%]+/i.exec(b),b=parseInt(b,10),function(e){var f,g;f=parseInt(d.dom.getStyle(e,"margin-left")||0,10)+parseInt(d.dom.getStyle(e,"padding-left")||0,10),a?g=f+b:g=f-b,d.dom.setStyle(e,"padding-left",""),d.dom.setStyle(e,"margin-left",g>0?g+c:"")}},selectedBlocks:function(){var a=this.ed,b=a.selection.getSelectedBlocks();return b.length==0?[a.dom.getRoot()]:b},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})()