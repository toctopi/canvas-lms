define(["compiled/editor/stocktiny","i18n!editor","jquery","str/htmlEscape","jqueryui/dialog","jquery.instructure_misc_helpers"],function(a,b,c,d){function e(){k=c("<div/>",{html:r.instructions+"<form id='instructure_embed_prompt_form' style='margin-top: 5px;'><table class='formtable'><tr><td>"+r.url+"</td><td><input type='text' class='prompt' style='width: 250px;' value='http://'/></td></tr><tr><td class='nobr'>"+r.alt_text+"</td><td><input type='text' class='alt_text' style='width: 150px;' value=''/></td></tr><tr><td colspan='2' style='text-align: right;'><input type='submit' value='Embed Image'/></td></tr></table></form><div class='actions'></div>"}).hide(),n=k.find(".alt_text"),o=k.find(".actions"),m=k.find(".prompt"),p=c("<a/>",{"class":"flickr_search_link",text:r.search_flickr,href:"#"}),m.bind("keyup",h),o.delegate(".embed_image_link","click",g),p.click(f),k.append(p).find("#instructure_embed_prompt_form").submit(g),c("body").append(k),k.dialog({autoOpen:!1,width:425,title:r.embed_external,open:function(){m.select()}}),q=!0}function f(a){a.preventDefault(),k.dialog("close"),c.findImageForService("flickr_creative_commons",function(a){var b=INST.htmlEscape(a.title),c='<a href="'+a.link_url+'"><img src="'+a.image_url+'" title="'+b+'"alt="'+b+'" style="max-width: 500; max-height: 500"></a>';k.dialog("close"),l.editorBox("insert_code",c)})}function g(a){var b=INST.htmlEscape(n.val()||""),c=INST.htmlEscape(m.val());a.preventDefault(),l.editorBox("insert_code","<img src='"+c+"' alt='"+b+"'/>"),k.dialog("close")}function h(a){var b=m.val();return b.match(/\.(gif|png|jpg|jpeg)$/)?j(b):i()}function i(){o.empty()}function j(a){var b=c("<div/>"),d=c("<img/>");b.css("textAlign","center").text(r.loading),o.empty(),o.append(b),d.attr({src:a,title:r.click_to_embed}).addClass("embed_image_link").css("cursor","pointer").bind({load:function(){var a=d[0];d.height(a.height<200?a.height:100),b.empty().append(d)},error:function(){b.text(r.image_not_found)}})}var k,l,m,n,o,p,q=!1,r={click_to_embed:b.t("click_to_embed","Click to embed the image"),instructions:INST.htmlEscape(b.t("instructions","Paste or type the URL of the image you'd like to embed:")),url:INST.htmlEscape(b.t("url","URL:")),alt_text:INST.htmlEscape(b.t("alt_text","Alternate Text:")),search_flickr:b.t("search_flickr","Search flickr creative commons"),loading:b.t("loading","Loading..."),embed_external:b.t("embed_external","Embed External Image"),embed_image:INST.htmlEscape(b.t("embed_image","Embed Image")),image_not_found:b.t("image_not_found","Image not found, please try a new URL")};a.create("tinymce.plugins.InstructureEmbed",{init:function(a,b){var d=c("#"+a.id);a.addCommand("instructureEmbed",function(a){q||e(),l=d,k.dialog("open"),a==="flickr"&&p.click()}),a.addButton("instructure_embed",{title:r.embed_image,cmd:"instructureEmbed",image:b+"/img/button.gif"})},getInfo:function(){return{longname:"InstructureEmbed",author:"Brian Whitmer",authorurl:"http://www.instructure.com",infourl:"http://www.instructure.com",version:a.majorVersion+"."+a.minorVersion}}}),a.PluginManager.add("instructure_embed",a.plugins.InstructureEmbed)})