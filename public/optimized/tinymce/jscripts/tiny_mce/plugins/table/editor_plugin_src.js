(function(a){function b(a,b){var c=b.ownerDocument,d=c.createRange(),e;return d.setStartBefore(b),d.setEnd(a.endContainer,a.endOffset),e=c.createElement("body"),e.appendChild(d.cloneContents()),e.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function c(a,b){return parseInt(a.getAttribute(b)||1)}function d(b,d,f){function g(a,b){return a=a.cloneNode(b),a.removeAttribute("id"),a}function h(){var a=0;G=[],e(["thead","tbody","tfoot"],function(f){var g=d.select("> "+f+" tr",b);e(g,function(b,g){g+=a,e(d.select("> td, > th",b),function(a,b){var d,e,h,i;if(G[g])while(G[g][b])b++;h=c(a,"rowspan"),i=c(a,"colspan");for(e=g;e<g+h;e++){G[e]||(G[e]=[]);for(d=b;d<b+i;d++)G[e][d]={part:f,real:e==g&&d==b,elm:a,rowspan:h,colspan:i}}})}),a+=g.length})}function j(a,b){var c;c=G[b];if(c)return c[a]}function k(a,b,c){a&&(c=parseInt(c),c===1?a.removeAttribute(b,1):a.setAttribute(b,c,1))}function l(a){return a&&(d.hasClass(a.elm,"mceSelected")||a==J)}function m(){var a=[];return e(b.rows,function(b){e(b.cells,function(c){if(d.hasClass(c,"mceSelected")||c==J.elm)return a.push(b),!1})}),a}function n(){var a=d.createRng();a.setStartAfter(b),a.setEndAfter(b),f.setRng(a),d.remove(b)}function o(b){var c;return a.walk(b,function(f){var h;if(f.nodeType==3)return e(d.getParents(f.parentNode,null,b).reverse(),function(a){a=g(a,!1),c?h&&h.appendChild(a):c=h=a,h=a}),h&&(h.innerHTML=a.isIE?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),b=g(b,!1),k(b,"rowSpan",1),k(b,"colSpan",1),c?b.appendChild(c):a.isIE||(b.innerHTML='<br data-mce-bogus="1" />'),b}function p(){var a=d.createRng();e(d.select("tr",b),function(a){a.cells.length==0&&d.remove(a)});if(d.select("tr",b).length==0){a.setStartAfter(b),a.setEndAfter(b),f.setRng(a),d.remove(b);return}e(d.select("thead,tbody,tfoot",b),function(a){a.rows.length==0&&d.remove(a)}),h(),row=G[Math.min(G.length-1,H.y)],row&&(f.select(row[Math.min(row.length-1,H.x)].elm,!0),f.collapse(!0))}function q(a,b,c,e){var f,g,h,i,j;f=G[b][a].elm.parentNode;for(h=1;h<=c;h++){f=d.getNext(f,"tr");if(f){for(g=a;g>=0;g--){j=G[b+h][g].elm;if(j.parentNode==f){for(i=1;i<=e;i++)d.insertAfter(o(j),j);break}}if(g==-1)for(i=1;i<=e;i++)f.insertBefore(o(f.cells[0]),f.cells[0])}}}function r(){e(G,function(a,b){e(a,function(a,e){var f,g,h,i;if(l(a)){a=a.elm,f=c(a,"colspan"),g=c(a,"rowspan");if(f>1||g>1){k(a,"rowSpan",1),k(a,"colSpan",1);for(i=0;i<f-1;i++)d.insertAfter(o(a),a);q(e,b,g-1,f)}}})})}function s(b,c,f){var g,i,l,m,n,o,q,s,b,t,u;b?(pos=C(b),g=pos.x,i=pos.y,l=g+(c-1),m=i+(f-1)):(g=H.x,i=H.y,l=I.x,m=I.y),q=j(g,i),s=j(l,m);if(q&&s&&q.part==s.part){r(),h(),q=j(g,i).elm,k(q,"colSpan",l-g+1),k(q,"rowSpan",m-i+1);for(o=i;o<=m;o++)for(n=g;n<=l;n++){if(!G[o]||!G[o][n])continue;b=G[o][n].elm,b!=q&&(t=a.grep(b.childNodes),e(t,function(a){q.appendChild(a)}),t.length&&(t=a.grep(q.childNodes),u=0,e(t,function(a){a.nodeName=="BR"&&d.getAttrib(a,"data-mce-bogus")&&u++<t.length-1&&q.removeChild(a)})),d.remove(b))}p()}}function t(a){var b,f,h,i,j,m,n,p,q;e(G,function(c,d){e(c,function(c,e){if(l(c)){c=c.elm,j=c.parentNode,m=g(j,!1),b=d;if(a)return!1}});if(a)return!b});for(i=0;i<G[0].length;i++){if(!G[b][i])continue;f=G[b][i].elm;if(f!=h){if(!a){q=c(f,"rowspan");if(q>1){k(f,"rowSpan",q+1);continue}}else if(b>0&&G[b-1][i]){p=G[b-1][i].elm,q=c(p,"rowSpan");if(q>1){k(p,"rowSpan",q+1);continue}}n=o(f),k(n,"colSpan",f.colSpan),m.appendChild(n),h=f}}m.hasChildNodes()&&(a?j.parentNode.insertBefore(m,j):d.insertAfter(m,j))}function u(a){var b,f;e(G,function(c,d){e(c,function(c,d){if(l(c)){b=d;if(a)return!1}});if(a)return!b}),e(G,function(e,g){var h,i,j;if(!e[b])return;h=e[b].elm,h!=f&&(j=c(h,"colspan"),i=c(h,"rowspan"),j==1?a?(h.parentNode.insertBefore(o(h),h),q(b,g,i-1,j)):(d.insertAfter(o(h),h),q(b,g,i-1,j)):k(h,"colSpan",h.colSpan+1),f=h)})}function v(){var b=[];e(G,function(f,g){e(f,function(f,g){l(f)&&a.inArray(b,g)===-1&&(e(G,function(a){var b=a[g].elm,e;e=c(b,"colSpan"),e>1?k(b,"colSpan",e-1):d.remove(b)}),b.push(g))})}),p()}function w(){function a(a){var b,f,g;b=d.getNext(a,"tr"),e(a.cells,function(a){var b=c(a,"rowSpan");b>1&&(k(a,"rowSpan",b-1),f=C(a),q(f.x,f.y,1,1))}),f=C(a.cells[0]),e(G[f.y],function(a){var b;a=a.elm,a!=g&&(b=c(a,"rowSpan"),b>1?k(a,"rowSpan",b-1):d.remove(a),g=a)})}var b;b=m(),e(b.reverse(),function(b){a(b)}),p()}function z(){var a=m();return d.remove(a),p(),a}function A(){var a=m();return e(a,function(b,c){a[c]=g(b,!0)}),a}function B(a,b){var c=m(),f=c[b?0:c.length-1],g=f.cells.length;e(G,function(a){var b;g=0,e(a,function(a,c){a.real&&(g+=a.colspan),a.elm.parentNode==f&&(b=1)});if(b)return!1}),b||a.reverse(),e(a,function(a){var c=a.cells.length,e;for(i=0;i<c;i++)e=a.cells[i],k(e,"colSpan",1),k(e,"rowSpan",1);for(i=c;i<g;i++)a.appendChild(o(a.cells[c-1]));for(i=g;i<c;i++)d.remove(a.cells[i]);b?f.parentNode.insertBefore(a,f):d.insertAfter(a,f)})}function C(a){var b;return e(G,function(c,d){return e(c,function(c,e){if(c.elm==a)return b={x:e,y:d},!1}),!b}),b}function D(a){H=C(a)}function E(){var a,b,c;return b=c=0,e(G,function(a,d){e(a,function(a,e){var f,g;l(a)&&(a=G[d][e],e>b&&(b=e),d>c&&(c=d),a.real&&(f=a.colspan-1,g=a.rowspan-1,f&&e+f>b&&(b=e+f),g&&d+g>c&&(c=d+g)))})}),{x:b,y:c}}function F(a){var b,c,e,f,g,h,i,j;I=C(a);if(H&&I){b=Math.min(H.x,I.x),c=Math.min(H.y,I.y),e=Math.max(H.x,I.x),f=Math.max(H.y,I.y),g=e,h=f;for(y=c;y<=h;y++)a=G[y][b],a.real||b-(a.colspan-1)<b&&(b-=a.colspan-1);for(x=b;x<=g;x++)a=G[c][x],a.real||c-(a.rowspan-1)<c&&(c-=a.rowspan-1);for(y=c;y<=f;y++)for(x=b;x<=e;x++)a=G[y][x],a.real&&(i=a.colspan-1,j=a.rowspan-1,i&&x+i>g&&(g=x+i),j&&y+j>h&&(h=y+j));d.removeClass(d.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=c;y<=h;y++)for(x=b;x<=g;x++)G[y][x]&&d.addClass(G[y][x].elm,"mceSelected")}}var G,H,I,J;h(),J=d.getParent(f.getStart(),"th,td"),J&&(H=C(J),I=E(),J=j(H.x,H.y)),a.extend(this,{deleteTable:n,split:r,merge:s,insertRow:t,insertCol:u,deleteCols:v,deleteRows:w,cutRows:z,copyRows:A,pasteRows:B,getPos:C,setStartCell:D,setEndCell:F})}var e=a.each;a.create("tinymce.plugins.TablePlugin",{init:function(f,g){function h(a){var b=f.selection,c=f.dom.getParent(a||b.getNode(),"table");if(c)return new d(c,f.dom,b)}function i(){f.getBody().style.webkitUserSelect="",l&&(f.dom.removeClass(f.dom.select("td.mceSelected,th.mceSelected"),"mceSelected"),l=!1)}var j,k,l=!0;e([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(a){f.addButton(a[0],{title:a[1],cmd:a[2],ui:a[3]})}),a.isIE||f.onClick.add(function(a,b){b=b.target,b.nodeName==="TABLE"&&(a.selection.select(b),a.nodeChanged())}),f.onPreProcess.add(function(a,b){var c,d,e,f=a.dom,g;c=f.select("table",b.node),d=c.length;while(d--){e=c[d],f.setAttrib(e,"data-mce-style","");if(g=f.getAttrib(e,"width"))f.setStyle(e,"width",g),f.setAttrib(e,"width","");if(g=f.getAttrib(e,"height"))f.setStyle(e,"height",g),f.setAttrib(e,"height","")}}),f.onNodeChange.add(function(a,b,c){var d;c=a.selection.getStart(),d=a.dom.getParent(c,"td,th,caption"),b.setActive("table",c.nodeName==="TABLE"||!!d),d&&d.nodeName==="CAPTION"&&(d=0),b.setDisabled("delete_table",!d),b.setDisabled("delete_col",!d),b.setDisabled("delete_table",!d),b.setDisabled("delete_row",!d),b.setDisabled("col_after",!d),b.setDisabled("col_before",!d),b.setDisabled("row_after",!d),b.setDisabled("row_before",!d),b.setDisabled("row_props",!d),b.setDisabled("cell_props",!d),b.setDisabled("split_cells",!d),b.setDisabled("merge_cells",!d)}),f.onInit.add(function(d){function f(a,b,c,d){var e=3,f=a.dom.getParent(b.startContainer,"TABLE"),g,h,i;return f&&(g=f.parentNode),h=b.startContainer.nodeType==e&&b.startOffset==0&&b.endOffset==0&&d&&(c.nodeName=="TR"||c==g),i=(c.nodeName=="TD"||c.nodeName=="TH")&&!d,h||i}function g(b){if(!a.isWebKit)return;var c=b.selection.getRng(),d=b.selection.getNode(),e=b.dom.getParent(c.startContainer,"TD,TH");if(!f(b,c,d,e))return;e||(e=d);var g=e.lastChild;while(g.lastChild)g=g.lastChild;c.setEnd(g,g.nodeValue.length),b.selection.setRng(c)}var m,n,o=d.dom,p;j=d.windowManager,d.onMouseDown.add(function(a,b){b.button!=2&&(i(),n=o.getParent(b.target,"td,th"),m=o.getParent(n,"table"))}),o.bind(d.getDoc(),"mouseover",function(a){var b,c,e=a.target;if(n&&(p||e!=n)&&(e.nodeName=="TD"||e.nodeName=="TH")){c=o.getParent(e,"table"),c==m&&(p||(p=h(c),p.setStartCell(n),d.getBody().style.webkitUserSelect="none"),p.setEndCell(e),l=!0),b=d.selection.getSel();try{b.removeAllRanges?b.removeAllRanges():b.empty()}catch(f){}a.preventDefault()}}),d.onMouseUp.add(function(b,c){var d,e=b.selection,f,g=e.getSel(),h,i,j,k;if(n){p&&(b.getBody().style.webkitUserSelect="");function l(b,c){var e=new a.dom.TreeWalker(b,b);do{if(b.nodeType==3&&a.trim(b.nodeValue).length!=0){c?d.setStart(b,0):d.setEnd(b,b.nodeValue.length);return}if(b.nodeName=="BR"){c?d.setStartBefore(b):d.setEndBefore(b);return}}while(b=c?e.next():e.prev())}f=o.select("td.mceSelected,th.mceSelected");if(f.length>0){d=o.createRng(),i=f[0],k=f[f.length-1],d.setStartBefore(i),d.setEndAfter(i),l(i,1),h=new a.dom.TreeWalker(i,o.getParent(f[0],"table"));do if(i.nodeName=="TD"||i.nodeName=="TH"){if(!o.hasClass(i,"mceSelected"))break;j=i}while(i=h.next());l(j),e.setRng(d)}b.nodeChanged(),n=p=m=null}}),d.onKeyUp.add(function(a,b){i()}),d.onKeyDown.add(function(a,b){g(a)}),d.onMouseDown.add(function(a,b){b.button!=2&&g(a)}),d.plugins.table.fixTableCellSelection=g,d&&d.plugins.contextmenu&&d.plugins.contextmenu.onContextMenu.add(function(a,b,c){var e,f=d.selection,g=f.getNode()||d.getBody();d.dom.getParent(c,"td")||d.dom.getParent(c,"th")||d.dom.select("td.mceSelected,th.mceSelected").length?(b.removeAll(),g.nodeName=="A"&&!d.dom.getAttrib(g,"name")&&(b.add({title:"advanced.link_desc",icon:"link",cmd:d.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),b.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),b.addSeparator()),g.nodeName=="IMG"&&g.className.indexOf("mceItem")==-1&&(b.add({title:"advanced.image_desc",icon:"image",cmd:d.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),b.addSeparator()),b.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),b.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),b.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),b.addSeparator(),e=b.addMenu({title:"table.cell"}),e.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),e.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),e.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),e=b.addMenu({title:"table.row"}),e.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),e.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),e.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),e.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),e.addSeparator(),e.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),e.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),e.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!k),e.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!k),e=b.addMenu({title:"table.col"}),e.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),e.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),e.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):b.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})});if(a.isWebKit){function q(b,d){function f(c,d,e){var f=c?"previousSibling":"nextSibling",h=b.dom.getParent(d,"tr"),k=h[f];if(k)return q(b,d,k,c),a.dom.Event.cancel(e),!0;var l=b.dom.getParent(h,"table"),m=h.parentNode,n=m.nodeName.toLowerCase();if(n==="tbody"||n===(c?"tfoot":"thead")){var o=g(c,l,m,"tbody");if(o!==null)return i(c,o,d,e)}return j(c,h,f,l,e)}function g(a,c,d,e){var f=b.dom.select(">"+e,c),g=f.indexOf(d);if(a&&g===0||!a&&g===f.length-1)return h(a,c);if(g===-1){var i=d.tagName.toLowerCase()==="thead"?0:f.length-1;return f[i]}return f[g+(a?-1:1)]}function h(a,c){var d=a?"thead":"tfoot",e=b.dom.select(">"+d,c);return e.length!==0?e[0]:null}function i(c,d,e,f){var g=k(d,c);return g&&q(b,e,g,c),a.dom.Event.cancel(f),!0}function j(c,d,e,g,h){var i=g[e];if(i)return l(i),!0;var j=b.dom.getParent(g,"td,th");if(j)return f(c,j,h);var m=k(d,!c);return l(m),a.dom.Event.cancel(h)}function k(a,b){return a&&a[b?"lastChild":"firstChild"]}function l(a){b.selection.setCursorLocation(a,0)}function m(){return u==t.UP||u==t.DOWN}function n(a){var b=a.selection.getNode(),c=a.dom.getParent(b,"tr");return c!==null}function o(a){var b=0,d=a;while(d.previousSibling)d=d.previousSibling,b+=c(d,"colspan");return b}function p(a,b){var d=0,f=0;return e(a.children,function(a,e){d+=c(a,"colspan"),f=e;if(d>b)return!1}),f}function q(a,b,c,d){var e=o(a.dom.getParent(b,"td,th")),f=p(c,e),g=c.childNodes[f],h=k(g,d);l(h||g)}function r(a){var c=b.selection.getNode(),d=b.dom.getParent(c,"td,th"),e=b.dom.getParent(a,"td,th");return d&&d!==e&&s(d,e)}function s(a,c){return b.dom.getParent(a,"TABLE")===b.dom.getParent(c,"TABLE")}var t=a.VK,u=d.keyCode;if(m()&&n(b)){var v=b.selection.getNode();setTimeout(function(){r(v)&&f(!d.shiftKey&&u===t.UP,v,d)},0)}}d.onKeyDown.add(q)}if(!a.isIE){function r(){var a;for(a=d.getBody().lastChild;a&&a.nodeType==3&&!a.nodeValue.length;a=a.previousSibling);a&&a.nodeName=="TABLE"&&d.dom.add(d.getBody(),"p",null,'<br mce_bogus="1" />')}a.isGecko&&d.onKeyDown.add(function(a,c){var d,e,f=a.dom;if(c.keyCode==37||c.keyCode==38)d=a.selection.getRng(),e=f.getParent(d.startContainer,"table"),e&&a.getBody().firstChild==e&&b(d,e)&&(d=f.createRng(),d.setStartBefore(e),d.setEndBefore(e),a.selection.setRng(d),c.preventDefault())}),d.onKeyUp.add(r),d.onSetContent.add(r),d.onVisualAid.add(r),d.onPreProcess.add(function(a,b){var c=b.node.lastChild;c&&c.childNodes.length==1&&c.firstChild.nodeName=="BR"&&a.dom.remove(c)}),r(),d.startContent=d.getContent({format:"raw"})}}),e({mceTableSplitCells:function(a){a.split()},mceTableMergeCells:function(a){var b,c,d;d=f.dom.getParent(f.selection.getNode(),"th,td"),d&&(b=d.rowSpan,c=d.colSpan),f.dom.select("td.mceSelected,th.mceSelected").length?a.merge():j.open({url:g+"/merge_cells.htm",width:240+parseInt(f.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(f.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:b,cols:c,onaction:function(b){a.merge(d,b.cols,b.rows)},plugin_url:g})},mceTableInsertRowBefore:function(a){a.insertRow(!0)},mceTableInsertRowAfter:function(a){a.insertRow()},mceTableInsertColBefore:function(a){a.insertCol(!0)},mceTableInsertColAfter:function(a){a.insertCol()},mceTableDeleteCol:function(a){a.deleteCols()},mceTableDeleteRow:function(a){a.deleteRows()},mceTableCutRow:function(a){k=a.cutRows()},mceTableCopyRow:function(a){k=a.copyRows()},mceTablePasteRowBefore:function(a){a.pasteRows(k,!0)},mceTablePasteRowAfter:function(a){a.pasteRows(k)},mceTableDelete:function(a){a.deleteTable()}},function(a,b){f.addCommand(b,function(){var b=h();b&&(a(b),f.execCommand("mceRepaint"),i())})}),e({mceInsertTable:function(a){j.open({url:g+"/table.htm",width:400+parseInt(f.getLang("table.table_delta_width",0)),height:320+parseInt(f.getLang("table.table_delta_height",0)),inline:1},{plugin_url:g,action:a?a.action:0})},mceTableRowProps:function(){j.open({url:g+"/row.htm",width:400+parseInt(f.getLang("table.rowprops_delta_width",0)),height:295+parseInt(f.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:g})},mceTableCellProps:function(){j.open({url:g+"/cell.htm",width:400+parseInt(f.getLang("table.cellprops_delta_width",0)),height:295+parseInt(f.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:g})}},function(a,b){f.addCommand(b,function(b,c){a(c)})})}}),a.PluginManager.add("table",a.plugins.TablePlugin)})(tinymce)