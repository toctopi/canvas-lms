define(["INST","i18n!instructure","jquery","underscore","vendor/scribd.view","str/htmlEscape","jquery.ajaxJSON","jquery.google-analytics","jquery.instructure_misc_helpers","jquery.loadingImg"],function(a,b,c,d,e,f){var g={"application/vnd.openxmlformats-officedocument.wordprocessingml.template":[1,1],"application/vnd.oasis.opendocument.spreadsheet":[1,1],"application/vnd.sun.xml.writer":[1,1],"application/excel":[1,1],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[1,1],"text/rtf":[1,!1],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":[1,1],"application/vnd.sun.xml.impress":[1,1],"application/vnd.sun.xml.calc":[1,1],"application/vnd.ms-excel":[1,1],"application/msword":[1,1],"application/mspowerpoint":[1,1],"application/rtf":[1,1],"application/vnd.oasis.opendocument.presentation":[1,1],"application/vnd.oasis.opendocument.text":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.template":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":[1,1],"text/plain":[1,!1],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[1,1],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[1,1],"application/postscript":[1,1],"application/pdf":[1,1],"application/vnd.ms-powerpoint":[1,1]};c.filePreviewsEnabled=function(){return!a.disableScribdPreviews||!a.disableGooglePreviews},c.isPreviewable=function(b,d){return c.filePreviewsEnabled()&&g[b]&&(!d||!a["disable"+c.capitalize(d)+"Previews"]&&g[b][{scribd:0,google:1}[d]])},c.fn.loadDocPreview=function(g){var h=swfobject.getFlashPlayerVersion(),i=h&&h.major>9;return this.each(function(){function h(a){k.attachment_view_inline_ping_url&&(c.ajaxJSON(k.attachment_view_inline_ping_url,"POST",{},function(){},function(){}),c.trackEvent("Doc Previews",a,JSON.stringify(k)))}var j=c(this),k=c.extend({height:"400px"},j.data(),g);if(!a.disableScribdPreviews&&k.scribd_doc_id&&k.scribd_access_key&&i&&e){var l=e.Document.getDoc(k.scribd_doc_id,k.scribd_access_key),m=j.attr("id"),n=c.extend({jsapi_version:1,disable_related_docs:!0,auto_size:!1,height:k.height,use_ssl:"https:"==document.location.protocol},k.scribdParams);m||(m=d.uniqueId("scribd_preview_"),j.attr("id",m)),c.each(n,function(a,b){l.addParam(a,b)}),c.isFunction(k.ready)&&l.addEventListener("iPaperReady",k.ready),l.write(m),this.childNodes[0].keyboardShortcutDown=this.childNodes[0].keyboardShortcutUp=function(){},h("scribd")}else if(!a.disableGooglePreviews&&(!k.mimeType||c.isPreviewable(k.mimeType,"google"))&&k.attachment_id||k.public_url){function o(){var a="//docs.google.com/viewer?"+c.param({embedded:!0,url:k.public_url});c('<iframe src="'+a+'" height="'+k.height+'" width="100%" />').appendTo(j).load(function(){h("google"),c.isFunction(k.ready)&&k.ready()})}if(k.public_url)o();else if(k.attachment_id){var p="/files/"+k.attachment_id+"/public_url.json";k.submission_id&&(p+="?"+c.param({submission_id:k.submission_id})),j.loadingImage(),c.ajaxJSON(p,"GET",{},function(a){j.loadingImage("remove"),a&&a.public_url&&(c.extend(k,a),o())})}}else j.html("<p>"+f(b.t("errors.cannot_view_document_inline","This document cannot be viewed inline, you might not have permission to view it or it might have been deleted."))+"</p>")})}})