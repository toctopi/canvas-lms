define(["ENV","INST","i18n!instructure","jquery","underscore","compiled/userSettings","str/htmlEscape","wikiSidebar","instructure_helper","jqueryui/draggable","jquery.ajaxJSON","jquery.doc_previews","jquery.dropdownList","jquery.google-analytics","jquery.instructure_date_and_time","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.keycodes","jquery.loadingImg","jquery.rails_flash_notifications","jquery.templateData","compiled/jquery/fixDialogButtons","media_comments","tinymce.editor_box","vendor/date","vendor/jquery.ba-tinypubsub","jqueryui/accordion","jqueryui/resizable","jqueryui/sortable","jqueryui/tabs","vendor/scribd.view"],function(a,b,c,d,e,f,g,h){var i=function(b){a.AUTHENTICITY_TOKEN&&b.setRequestHeader("X-CSRF-Token",a.AUTHENTICITY_TOKEN)};d.ajaxPrefilter(function(a,b,c){a.crossDomain||i(c);var e=a.url,f=(new Date).getTime();c.done(function(a,b,c){var g=(new Date).getTime()-f;if(g>1e3){var h='{"requestingPage": "'+window.location+'," "status": "'+b+'", "X-Request-Context-Id" : "'+c.getResponseHeader("X-Request-Context-Id")+'", "X-Runtime": '+c.getResponseHeader("X-Runtime")+"}";d.trackEvent("XHRs",e,h,g)}})}),d(function(){function a(){window.clearTimeout(r),q.find(".menu-item").removeClass("hover hover-pending")}function i(){return p.filter(".hover-pending").removeClass("hover-pending"),r=window.setTimeout(a,400),!1}function j(b){var c=p.filter(".hover").length>0;a();var e=d(this);return e.addClass("hover-pending"),c&&e.addClass("hover"),setTimeout(function(){e.hasClass("hover-pending")&&e.addClass("hover")},300),d.publish("menu/hovered",e),!1}function k(){var a=500,b=s.find("li:visible:first").height()*1.5;t=t||s.find(".ellipsible"),t.css("maxWidth",""),t.ifExists(function(){for(var c=0;s.height()>b&&c<20;c++)u||(u=!0,t.addClass("ellipsis")),t.css("maxWidth",a-=20)})}function l(){var a=d("#content");d(".user_content:not(.enhanced):visible").addClass("unenhanced"),d(".user_content.unenhanced:visible").each(function(){var b=d(this);b.find("img").css("maxWidth",Math.min(a.width(),b.width())),b.data("unenhanced_content_html",b.html())}).find(".enhanceable_content").show().filter(".dialog").each(function(){var a=d(this);a.hide(),a.closest(".user_content").find("a[href='#"+a.attr("id")+"']").click(function(b){b.preventDefault(),a.dialog()})}).end().filter(".draggable").draggable().end().filter(".resizable").resizable().end().filter(".sortable").sortable().end().filter(".accordion").accordion().end().filter(".tabs").each(function(){d(this).tabs()}).end().end().find("a:not(.not_external, .external):external").each(function(){d(this).not(":has(img)").addClass("external").html("<span>"+d(this).html()+"</span>").attr("target","_blank").append('<span class="ui-icon ui-icon-extlink ui-icon-inline" title="'+g(c.t("titles.external_link","Links to an external site."))+'"/>')}).end().find("a.instructure_file_link").each(function(){var a=d(this),b=d("<span class='instructure_file_link_holder link_holder'/>");a.removeClass("instructure_file_link").before(b).appendTo(b),a.attr("target")!="_blank"&&b.append("<a href='"+a.attr("href")+"' target='_blank' title='"+g(c.t("titles.view_in_new_window","View in a new window"))+"' style='padding-left: 5px;'><img src='/images/popout.png'/></a>")}),d.filePreviewsEnabled()&&d("a.instructure_scribd_file").not(".inline_disabled").each(function(){var a=d(this);if(d.trim(a.text())){var b=d("<span class='instructure_scribd_file_holder link_holder'/>"),e=d("<a class='scribd_file_preview_link' href='"+a.attr("href")+"' title='"+g(c.t("titles.preview_document","Preview the document"))+"' style='padding-left: 5px;'><img src='/images/preview.png'/></a>");a.removeClass("instructure_scribd_file").before(b).appendTo(b),b.append(e),a.hasClass("auto_open")&&e.click()}}),d(".user_content.unenhanced a").find("img.media_comment_thumbnail").each(function(){d(this).closest("a").addClass("instructure_inline_media_comment")}).end().filter(".instructure_inline_media_comment").removeClass("no-underline").mediaCommentThumbnail("normal").end().filter(".instructure_video_link, .instructure_audio_link").mediaCommentThumbnail("normal",!0).end().not(".youtubed").each(function(){var a=d(this),b=a.attr("href"),e=d.youTubeID(b||"");if(!a.hasClass("inline_disabled")&&e){var f=d('<a href="'+b+'" class="youtubed"><img src="/images/play_overlay.png" class="media_comment_thumbnail" style="background-image: url(//img.youtube.com/vi/'+e+'/2.jpg)"/></a>').click(function(a){a.preventDefault();var b=d("<span class='youtube_holder' style='display: block;'><object width='425' height='344'><param name='wmode' value='opaque'></param><param name='movie' value='//www.youtube.com/v/"+e+"&autoplay=1&hl=en_US&fs=1&'></param><param name='allowFullScreen' value='true'></param><param name='allowscriptaccess' value='always'></param><embed src='//www.youtube.com/v/"+e+"&autoplay=1&hl=en_US&fs=1&' type='application/x-shockwave-flash' allowscriptaccess='always' allowfullscreen='true' width='425' height='344' wmode='opaque'></embed></object><br/><a href='#' style='font-size: 0.8em;' class='hide_youtube_embed_link'>"+g(c.t("links.minimize_youtube_video","Minimize Video"))+"</a></span>");b.find(".hide_youtube_embed_link").click(function(a){a.preventDefault(),b.remove(),f.show(),d.trackEvent("hide_embedded_content","hide_you_tube")}),d(this).after(b).hide()});d.trackEvent("show_embedded_content","show_you_tube"),a.addClass("youtubed").after(f)}}),d(".user_content.unenhanced").removeClass("unenhanced").addClass("enhanced"),setTimeout(function(){d(".user_content form.user_content_post_form:not(.submitted)").submit().addClass("submitted")},10)}function m(){x=d(".time_ago_date:visible").toArray(),n()}function n(){var a=x.shift();if(a){var b=d(a),e=b.data("original_date")||"",f=b.data("parsed_date")||(e?Date.parse(e.replace(/ (at|by)/,"")):Date.parse((b.text()||"").replace(/ (at|by)/,"")));if(f){var g=new Date;g.setDate(g.getDate()+1);if(!e&&f>g&&f-g>36e5){var h=f.getUTCFullYear().toString();f>g&&f.getUTCFullYear()==g.getUTCFullYear()&&!b.text().match(h)&&f.setUTCFullYear(f.getUTCFullYear()-1)}var i=g.getTimezoneOffset()-w;isNaN(i)&&(i=0);var j=g-f+i*60*1e3;b.data("original_date",f.toString("MMM d, yyyy h:mmtt")),b.data("parsed_date",f);var k=f.toString("MMM d, yyyy")+f.toString(" h:mmtt").toLowerCase(),l=k;if(j<864e5)if(j<36e5)if(j<6e4)l=c.t("#time.less_than_a_minute_ago","less than a minute ago");else{var o=parseInt(j/6e4,10);l=c.t("#time.count_minutes_ago",{one:"1 minute ago",other:"%{count} minutes ago"},{count:o})}else{var p=parseInt(j/36e5,10);l=c.t("#time.count_hours_ago",{one:"1 hour ago",other:"%{count} hours ago"},{count:p})}b.text(l),b.attr("title",k)}setTimeout(n,1)}else setTimeout(m,6e4)}function o(a){d("#wizard_spacer_box").height(z.height()||0).showIf(a==="show")}window._earlyClick&&(document.removeEventListener?document.removeEventListener("click",_earlyClick,!1):document.detachEvent("onclick",_earlyClick),_earlyClick.clicks&&setTimeout(function(){d.each(e.uniq(_earlyClick.clicks),function(){var a=d.Event("click");a.preventDefault(),d(this).trigger(a)})},1)),d("#main:not(.already_sized)").css({minHeight:Math.max(d("#left_side").height(),parseInt((d("#main").css("minHeight")||"").replace("px",""),10))});var p=d(".menu-item"),q=d("#menu"),r;q.delegate(".menu-item","mouseenter focusin",j).delegate(".menu-item","mouseleave focusout",i),b.browser.ie7&&d(".menu-item-drop").width(function(){var a=d(this).find(".menu-item-drop-column");return a.length*a.css("width").replace("px","")}),p.live("touchstart",function(){if(!d(this).hasClass("hover"))return j.call(this,event)}),d(document).bind("touchstart",function(a){d(a.target).closest(".menu-item").length||i()});var s=d("#breadcrumbs"),t,u=!1;k(),d(window).resize(k),d("#ajax_authenticity_token").ifExists(function(){this.text()&&d("input[name='authenticity_token']").val(this.text())}),d(document).keycodes("shift+/",function(a){d("#keyboard_navigation").dialog("close").dialog({title:c.t("titles.keyboard_shortcuts","Keyboard Shortcuts"),width:400,height:"auto",autoOpen:!1}).dialog("open")}),d("#switched_role_type").ifExists(function(){var a=d(this).attr("class"),b=d("<img/>"),e=null;switch(d(this).data("role")){case"TeacherEnrollment":e=c.t("switched_roles_message.teacher","You have switched roles temporarily for this course, and are now viewing the course as a teacher.  You can restore your role and permissions from the course home page.");break;case"StudentEnrollment":e=c.t("switched_roles_message.student","You have switched roles temporarily for this course, and are now viewing the course as a student.  You can restore your role and permissions from the course home page.");break;case"TaEnrollment":e=c.t("switched_roles_message.ta","You have switched roles temporarily for this course, and are now viewing the course as a TA.  You can restore your role and permissions from the course home page.");break;case"ObserverEnrollment":e=c.t("switched_roles_message.observer","You have switched roles temporarily for this course, and are now viewing the course as an observer.  You can restore your role and permissions from the course home page.");break;case"DesignerEnrollment":e=c.t("switched_roles_message.designer","You have switched roles temporarily for this course, and are now viewing the course as a designer.  You can restore your role and permissions from the course home page.");break;default:e=c.t("switched_roles_message.student","You have switched roles temporarily for this course, and are now viewing the course as a student.  You can restore your role and permissions from the course home page.")}b.attr("src","/images/warning.png").attr("title",e).css({paddingRight:2,width:12,height:12}),d("#crumb_"+a).find("a").prepend(b)}),d("a.show_quoted_text_link").live("click",function(a){var b=d(this).parents(".quoted_text_holder").children(".quoted_text");b.length>0&&(a.preventDefault(),b.show(),d(this).hide())}),d(".custom_search_results_link").click(function(a){a.preventDefault();var b=d("#custom_search_results_dialog");b.dialog("close").dialog({autoOpen:!1,title:c.t("titles.search_for_open_resources","Search for Open Resources"),width:600,height:400}).dialog("open");var e=b.data("searchControl");e&&e.execute(d("title").text())}),d("a.instructure_inline_media_comment").live("click",function(a){a.preventDefault();if(b.kalturaSettings){var e=d(this),f=d("<span><span></span></span>"),g="video",h=e.data("media_comment_id")||e.find(".media_comment_id:first").text();f.css("display","block"),!h&&e.attr("id")&&e.attr("id").match(/^media_comment_/)&&(h=e.attr("id").substring(14)),e.after(f),e.hide();if(e.data("media_comment_type")==="audio"||e.is(".audio_playback, .audio_comment, .instructure_audio_link"))g="audio";f.children("span").mediaComment("show_inline",h,g,e.attr("href")),f.append("<br/><a href='#' style='font-size: 0.8em;' class='hide_flash_embed_link'>"+c.t("links.minimize_embedded_kaltura_content","Minimize Embedded Content")+"</a>"),f.find(".hide_flash_embed_link").click(function(a){a.preventDefault(),f.remove(),e.show(),d.trackEvent("hide_embedded_content","hide_media")}),d.trackEvent("show_embedded_content","show_media")}else alert(c.t("alerts.kaltura_disabled","Kaltura has been disabled for this Canvas site"))}),d("a.equella_content_link").live("click",function(a){a.preventDefault();var b=d("#equella_preview_dialog");if(!b.length){b=d("<div/>"),b.attr("id","equella_preview_dialog").hide(),b.html("<h2/><iframe style='background: url(/images/ajax-loader-medium-444.gif) no-repeat left top; width: 800px; height: 350px; border: 0;' src='about:blank' borderstyle='0'/><div style='text-align: right;'><a href='#' class='original_link external external_link' target='_blank'>"+g(c.t("links.view_equella_content_in_new_window","view the content in a new window"))+"</a>"),b.find("h2").text(d(this).attr("title")||d(this).text()||c.t("titles.equella_content_preview","Equella Content Preview"));var e=b.find("iframe");setTimeout(function(){e.css("background","#fff")},2500),d("body").append(b),b.dialog({autoOpen:!1,width:"auto",resizable:!1,title:c.t("titles.equella_content_preview","Equella Content Preview"),close:function(){b.find("iframe").attr("src","about:blank")}})}b.find(".original_link").attr("href",d(this).attr("href")),b.dialog("close").dialog("open"),b.find("iframe").attr("src",d(this).attr("href"))}),d(".dialog_opener[aria-controls]:not(.user_content *)").live("click",function(a){var b=this;d("#"+d(this).attr("aria-controls")).ifExists(function(c){a.preventDefault(),c.data("dialog")||(c.dialog(d.extend({autoOpen:!1,modal:!0},d(b).data("dialogOpts"))),c.fixDialogButtons()),c.dialog("open")})}),d.filePreviewsEnabled()?d("a.scribd_file_preview_link").live("click",function(a){a.preventDefault();var b=d(this).loadingImage({image_size:"small"}).hide();d.ajaxJSON(b.attr("href").replace(/\/download.*/,""),"GET",{},function(a){var e=a&&a.attachment,f=e&&e.scribd_doc&&e.scribd_doc.attributes;b.loadingImage("remove");if(e&&(f||d.isPreviewable(e.content_type,"google"))){var h=d("<span><br /></span>").insertAfter(b.parents(".link_holder:last")).loadDocPreview({scribd_doc_id:f&&f.doc_id,scribd_access_key:f&&f.access_key,mimeType:e.content_type,public_url:e.authenticated_s3_url}).append(d('<a href="#" style="font-size: 0.8em;" class="hide_file_preview_link">'+g(c.t("links.minimize_file_preview","Minimize File Preview"))+"</a>").click(function(a){a.preventDefault(),b.show(),h.remove(),d.trackEvent("hide_embedded_content","hide_file_preview")}));d.trackEvent("show_embedded_content","show_file_preview")}},function(){b.loadingImage("remove").hide()})}):d("a.scribd_file_preview_link").live("click",function(a){a.preventDefault(),alert(c.t("alerts.file_previews_disabled","File previews have been disabled for this Canvas site"))});var v;d.subscribe("userContent/change",function(){clearTimeout(v),v=setTimeout(l,50)}),d(document).bind("user_content_change",l),setInterval(l,15e3),setTimeout(l,1e3),d(".zone_cached_datetime").each(function(){if(d(this).attr("title")){var a=d.parseFromISO(d(this).attr("title"));a.timestamp&&d(this).text(a.datetime_formatted)}}),d(".show_sub_messages_link").click(function(a){a.preventDefault(),d(this).parents(".subcontent").find(".communication_sub_message.toggled_communication_sub_message").removeClass("toggled_communication_sub_message"),d(this).parents(".communication_sub_message").remove()}),d(".show_comments_link").click(function(a){a.preventDefault(),d(this).closest("ul").find("li").show(),d(this).closest("li").remove()}),d(".communication_message .message_short .read_more_link").click(function(a){a.preventDefault(),d(this).parents(".communication_message").find(".message_short").hide().end().find(".message").show()}),d(".communication_message .close_notification_link").live("click",function(a){a.preventDefault();var b=d(this).parents(".communication_message");b.confirmDelete({url:d(this).attr("rel"),noMessage:!0,success:function(){d(this).slideUp(function(){d(this).remove()})}})}),d(".communication_message .add_entry_link").click(function(a){a.preventDefault();var b=d(this).parents(".communication_message"),c=b.find(".reply_message").hide(),f=b.find(".communication_sub_message.blank").clone(!0).removeClass("blank");c.before(f.show());var g=e.uniqueId("textarea_");f.find("textarea.rich_text").attr("id",g),d(document).triggerHandler("richTextStart",d("#"+g)),f.find("textarea:first").focus().select()}),d(document).bind("richTextStart",function(a,b){if(!b||b.length===0)return;b=d(b);if(!b||b.length===0)return;b.editorBox(),b.editorBox("focus",!0),h&&(h.attachToEditor(b),d("#sidebar_content").hide(),h.show())}).bind("richTextEnd",function(a,b){if(!b||b.length===0)return;b=d(b);if(!b||b.length===0)return;b.editorBox("destroy"),h&&(d("#sidebar_content").show(),h.hide())}),d(".cant_record_link").click(function(a){a.preventDefault(),d("#cant_record_dialog").dialog("close").dialog({autoOpen:!1,modal:!0,title:c.t("titles.cant_create_recordings","Can't Create Recordings?"),width:400}).dialog("open")}),d(".communication_message .content .links .show_users_link,.communication_message .header .show_users_link").click(function(a){a.preventDefault(),d(this).parents(".communication_message").find(".content .users_list").slideToggle()}),d(".communication_message .delete_message_link").click(function(a){a.preventDefault(),d(this).parents(".communication_message").confirmDelete({noMessage:!0,url:d(this).attr("href"),success:function(){d(this).slideUp()}})}),d(".communication_sub_message .add_conversation_message_form").formSubmit({beforeSubmit:function(a){d(this).find("button").attr("disabled",!0),d(this).find(".submit_button").text(c.t("status.posting_message","Posting Message...")),d(this).loadingImage()},success:function(a){d(this).loadingImage("remove");var b=d(this).parents(".communication_sub_message"),c=b.parents(".communication_message");message_data=a.messages[0],b.fillTemplateData({data:{post_date:d.parseFromISO(message_data.created_at).datetime_formatted,message:message_data.body},htmlValues:["message"]}),b.find(".message").show(),d(this).remove(),c.find(".reply_message").show(),d.flashMessage("Message Sent!"),d(document).triggerHandler("user_content_change"),location.href.match(/dashboard/)&&d.trackEvent("dashboard_comment","create")},error:function(a){d(this).loadingImage("remove"),d(this).find("button").attr("disabled",!1),d(this).find(".submit_button").text("Post Failed, Try Again"),d(this).formErrors(a)}}),d(".communication_sub_message .add_sub_message_form").formSubmit({beforeSubmit:function(a){d(this).find("button").attr("disabled",!0),d(this).find(".submit_button").text(c.t("status.posting_message","Posting Message...")),d(this).loadingImage()},success:function(a){d(this).loadingImage("remove");var b=d(this).parents(".communication_sub_message");if(d(this).hasClass("submission_comment_form")){var c=d(this).getTemplateData({textValues:["submission_user_id"]}).submission_user_id,e=null;for(var f in a){var g=a[f].submission;g.user_id==c&&(e=g)}if(e){var h=e.submission_comments[e.submission_comments.length-1].submission_comment;h.post_date=d.parseFromISO(h.created_at).datetime_formatted,h.message=h.formatted_body||h.comment,b.fillTemplateData({data:h,htmlValues:["message"]})}}else{var i=a.discussion_entry;i.post_date=d.parseFromISO(i.created_at).datetime_formatted,b.find(".content > .message_html").val(i.message),b.fillTemplateData({data:i,htmlValues:["message"]})}b.find(".message").show(),b.find(".user_content").removeClass("enhanced"),b.parents(".communication_message").find(".reply_message").removeClass("lonely_behavior_message").show(),d(document).triggerHandler("richTextEnd",d(this).find("textarea.rich_text")),d(document).triggerHandler("user_content_change"),d(this).remove(),location.href.match(/dashboard/)&&d.trackEvent("dashboard_comment","create")},error:function(a){d(this).loadingImage("remove"),d(this).find("button").attr("disabled",!1),d(this).find(".submit_button").text(c.t("errors.posting_message_failed","Post Failed, Try Again")),d(this).formErrors(a)}}),d(".communication_sub_message form .cancel_button").click(function(){var a=d(this).parents(".communication_sub_message"),b=d(this).parents(".communication_message");d(document).triggerHandler("richTextEnd",a.find("textarea.rich_text")),a.remove(),b.find(".reply_message").show()}),d(".communication_message,.communication_sub_message").bind("focusin mouseenter",function(){d(this).addClass("communication_message_hover")}).bind("focusout mouseleave",function(){d(this).removeClass("communication_message_hover")}),d(".communication_sub_message .more_options_reply_link").click(function(a){a.preventDefault();var b=d(this).parents("form"),c=null;b.hasClass("submission_comment_form")?c={comment:b.find("textarea:visible:first").val()||""}:c={message:b.find("textarea:visible:first").val()||""},location.href=d(this).attr("href")+"?message="+encodeURIComponent(c.message)}),d(".communication_message.new_activity_message").ifExists(function(){this.find(".message_type img").click(function(){var a=d(this),b=d.trim(a.attr("class"));a.parents(".message_type").find("img").removeClass("selected"),a.addClass("selected").parents(".new_activity_message").find(".message_type_text").text(a.attr("title")).end().find(".activity_form").hide().end().find("textarea, :text").val("").end().find("."+b+"_form").show().find(".context_select").change()}),this.find(".context_select").change(function(){var a=d(this),b=a.val(),c=a.parents(".communication_message"),e=c.find("form");e.attr("action",c.find("."+b+"_form_url").attr("href")),e.data("context_name",this.options[this.selectedIndex].text),e.data("context_code",b),c.find(".roster_list").hide().find(":checkbox").each(function(){d(this).attr("checked",!1)}),c.find("."+b+"_roster_list").show()}).triggerHandler("change"),this.find(".cancel_button").click(function(a){d(this).parents(".communication_message").hide().prev(".new_activity_message").show()}),this.find(".new_activity_message_link").click(function(a){a.preventDefault(),d(this).parents(".communication_message").hide().next(".new_activity_message").find(".message_type img.selected").click().end().show().find(":text:visible:first").focus().select()}),this.find("form.message_form").formSubmit({beforeSubmit:function(a){d("button").attr("disabled",!0),d("button.submit_button").text(c.t("status.posting_message","Posting Message..."))},success:function(a){d("button").attr("disabled",!1),d("button.submit_button").text("Post Message");var b=d(this).data("context_code")||"",c=d(this).data("context_name")||"";if(d(this).hasClass("discussion_topic_form")){var e=a.discussion_topic;e.context_code=c,e.user_name=d("#identity .user_name").text(),e.post_date=d.parseFromISO(e.created_at).datetime_formatted,e.topic_id=e.id;var f=d(this).parents(".communication_message").find(".template"),g=f.find(".communication_message").clone(!0);g.find(".header .title,.behavior_content .less_important a").attr("href",f.find("."+b+"_topic_url").attr("href")),g.find(".add_entry_link").attr("href",f.find("."+b+"_topics_url").attr("href")),g.find(".user_name").attr("href",f.find("."+b+"_user_url").attr("href")),g.find(".topic_assignment_link,.topic_assignment_url").attr("href",f.find("."+b+"_assignment_url").attr("href")),g.find(".attachment_name,.topic_attachment_url").attr("href",f.find("."+b+"_attachment_url").attr("href"));var h={discussion_topic_id:e.id};g.fillTemplateData({data:e,hrefValues:["topic_id","user_id","assignment_id","attachment_id"],avoid:".subcontent"}),g.find(".subcontent").fillTemplateData({data:h,hrefValues:["topic_id","user_id"]}),g.find(".subcontent form").attr("action",f.find("."+b+"_entries_url").attr("href")),g.fillFormData(h,{object_name:"discussion_entry"}),d(this).parents(".communication_message").after(g.hide()),g.slideDown(),d(this).parents(".communication_message").slideUp(),d(this).parents(".communication_message").prev(".new_activity_message").slideDown()}else d(this).hasClass("announcement_form")||location.reload()},error:function(a){d("button").attr("disabled",!1),d("button.submit_button").text(c.t("errors.posting_message_failed","Post Failed, Try Again")),d(this).formErrors(a)}})}),d("#topic_list .show_all_messages_link").show().click(function(a){a.preventDefault(),d("#topic_list .topic_message").show(),d(this).hide()});var w=parseInt(d("#time_zone_offset").text(),10),x=[];setTimeout(m,100);var y=d("#sequence_footer .sequence_details_url").filter(":last").attr("href");y&&d.ajaxJSON(y,"GET",{},function(a){var b=d("#sequence_footer");a.current_item&&(d("#sequence_details .current").fillTemplateData({data:a.current_item.content_tag}),d.each({previous:".prev",next:".next"},function(e,f){var g=b.find(f);if(a[e+"_item"]||a[e+"_module"]){var h=a[e+"_item"]&&a[e+"_item"].content_tag||a[e+"_module"]&&a[e+"_module"].context_module;a[e+"_item"]||(h.title=h.title||h.name,h.text=e=="previous"?c.t("buttons.previous_module","Previous Module"):c.t("buttons.next_module","Next Module"),g.addClass("module_button")),g.fillTemplateData({data:h}),a[e+"_item"]?g.attr("href",d.replaceTags(b.find(".module_item_url").attr("href"),"id",h.id)):g.attr("href",d.replaceTags(b.find(".module_url").attr("href"),"id",h.id)+"/items/"+(e==="previous"?"last":"first"))}else g.hide()}),b.show(),d(window).resize())}),d(".module_legend_link").click(function(a){var b=d(this).parents(".module_legend");b.hide(),b.next(".module_legend").show()});var z=d("#wizard_box"),A=window.location.pathname;d(".close_wizard_link").click(function(a){a.preventDefault(),f.set("hide_wizard_"+A,!0),z.slideUp("fast",function(){d(".wizard_popup_link").slideDown("fast"),o("hide")})}),d(".wizard_popup_link").click(function(a){a.preventDefault(),d(".wizard_popup_link").slideUp("fast"),z.slideDown("fast",function(){z.triggerHandler("wizard_opened"),d([document,window]).triggerHandler("scroll")})}),z.ifExists(function(a){a.bind("wizard_opened",function(){var b=a.find(".wizard_options"),c=b.height();b.height(c),a.find(".wizard_details").css({maxHeight:c-5,overflow:"auto"}),o("show")}),a.find(".wizard_options_list .option").click(function(b){var c=d(this),e=d(b.target).closest("a");if(e.length>0&&e.attr("href")!="#")return;b.preventDefault(),c.parents(".wizard_options_list").find(".option.selected").removeClass("selected"),c.addClass("selected");var f=a.find(".wizard_details"),g=c.getTemplateData({textValues:["header"]});g.link=g.header,f.fillTemplateData({data:g}),f.find(".details").remove(),f.find(".header").after(c.find(".details").clone(!0).show());var h=c.find(".header").attr("href");h!="#"?f.find(".link").show().attr("href",h):f.find(".link").hide(),f.hide().fadeIn("fast")}),setTimeout(function(){f.get("hide_wizard_"+A)||d(".wizard_popup_link.auto_open:first").click()},500)}),d(".more_link").click(function(a){return d(this).closest("li").slideUp().parents("ul").children(":hidden").slideDown().first().find(":tabbable:first").focus(),!1}),d(".to-do-list, #topic_list").delegate(".disable_item_link","click",function(a){function b(a){e.confirmDelete({url:a,noMessage:!0,success:function(){d(this).slideUp(function(){d(this).remove()})}})}a.preventDefault();var e=d(this).parents("li, div.topic_message"),f=d(this).data("api-href");d(this).hasClass("grading")?(options={},options['<span class="ui-icon ui-icon-trash">&nbsp;</span> '+g(c.t("ignore_forever","Ignore Forever"))]=function(){b(f+"?permanent=1")},options['<span class="ui-icon ui-icon-star">&nbsp;</span> '+g(c.t("ignore_until_new_submission","Ignore Until New Submission"))]=function(){b(f)},d(this).dropdownList({options:options})):b(f+"?permanent=1")}),d("h1").length||d('<h1 class="ui-helper-hidden-accessible" />').text(document.title).prependTo("#content");if(!d("h2").length&&d("#breadcrumbs li:last").text().length){var B=d('<h2 class="ui-helper-hidden-accessible" />').text(d("#breadcrumbs li:last").text()),C=d("#content h1");C.length?C.after(B):B.prependTo("#content")}setTimeout(function(){d("#content a:external,#content a.explicit_external_link").each(function(){d(this).not(":has(img)").not(".not_external").addClass("external").children("span.ui-icon-extlink").remove().end().html("<span>"+d(this).html()+"</span>").attr("target","_blank").append('<span class="ui-icon ui-icon-extlink ui-icon-inline" title="'+g(c.t("titles.external_link","Links to an external site."))+'"/>')})},2e3)})})