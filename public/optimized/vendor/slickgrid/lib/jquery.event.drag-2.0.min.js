/*! 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(a){a.fn.drag=function(b,c,d){var e=typeof b=="string"?b:"",f=a.isFunction(b)?b:a.isFunction(c)?c:null;return e.indexOf("drag")!==0&&(e="drag"+e),d=(b==f?c:d)||{},f?this.bind(e,d,f):this.trigger(e)};var b=a.event,c=b.special,d=c.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",livekey:"livedrag",add:function(c){var e=a.data(this,d.datakey),f=c.data||{};e.related+=1,!e.live&&c.selector&&(e.live=!0,b.add(this,"draginit."+d.livekey,d.delegate)),a.each(d.defaults,function(a,b){f[a]!==undefined&&(e[a]=f[a])})},remove:function(){a.data(this,d.datakey).related-=1},setup:function(){if(a.data(this,d.datakey))return;var c=a.extend({related:0},d.defaults);a.data(this,d.datakey,c),b.add(this,"mousedown",d.init,c),this.attachEvent&&this.attachEvent("ondragstart",d.dontstart)},teardown:function(){if(a.data(this,d.datakey).related)return;a.removeData(this,d.datakey),b.remove(this,"mousedown",d.init),b.remove(this,"draginit",d.delegate),d.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",d.dontstart)},init:function(e){var f=e.data,g;if(f.which>0&&e.which!=f.which)return;if(a(e.target).is(f.not))return;if(f.handle&&!a(e.target).closest(f.handle,e.currentTarget).length)return;f.propagates=1,f.interactions=[d.interaction(this,f)],f.target=e.target,f.pageX=e.pageX,f.pageY=e.pageY,f.dragging=null,g=d.hijack(e,"draginit",f);if(!f.propagates)return;g=d.flatten(g),g&&g.length&&(f.interactions=[],a.each(g,function(){f.interactions.push(d.interaction(this,f))})),f.propagates=f.interactions.length,f.drop!==!1&&c.drop&&c.drop.handler(e,f),d.textselect(!1),b.add(document,"mousemove mouseup",d.handler,f);var h=a.data(document,"events").mousemove,i=h.pop();return h.splice(0,0,i),!1},interaction:function(b,c){return{drag:b,callback:new d.callback,droppable:[],offset:a(b)[c.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(a){var e=a.data;switch(a.type){case!e.dragging&&"mousemove":if(Math.pow(a.pageX-e.pageX,2)+Math.pow(a.pageY-e.pageY,2)<Math.pow(e.distance,2))break;a.target=e.target,d.hijack(a,"dragstart",e),e.propagates&&(e.dragging=!0);case"mousemove":if(e.dragging){d.hijack(a,"drag",e);if(e.propagates){e.drop!==!1&&c.drop&&c.drop.handler(a,e);break}a.type="mouseup"};case"mouseup":b.remove(document,"mousemove mouseup",d.handler),e.dragging&&(e.drop!==!1&&c.drop&&c.drop.handler(a,e),d.hijack(a,"dragend",e)),d.textselect(!0),e.click===!1&&e.dragging&&(jQuery.event.triggered=!0,setTimeout(function(){jQuery.event.triggered=!1},20),e.dragging=!1)}},delegate:function(c){var e=[],f,g=a.data(this,"events")||{};return a.each(g.live||[],function(g,h){if(h.preType.indexOf("drag")!==0)return;f=a(c.target).closest(h.selector,c.currentTarget)[0];if(!f)return;b.add(f,h.origType+"."+d.livekey,h.origHandler,h.data),a.inArray(f,e)<0&&e.push(f)}),e.length?a(e).bind("dragend."+d.livekey,function(){b.remove(this,"."+d.livekey)}):!1},hijack:function(c,e,f,g,h){if(!f)return;var i={event:c.originalEvent,type:c.type},j=e.indexOf("drop")?"drag":"drop",k,l=g||0,m,n,o,p=isNaN(g)?f.interactions.length:g;c.type=e,c.originalEvent=null,f.results=[];do if(m=f.interactions[l]){if(e!=="dragend"&&m.cancelled)continue;o=d.properties(c,f,m),m.results=[],a(h||m[j]||f.droppable).each(function(g,h){o.target=h,k=h?b.handle.call(h,c,o):null,h&&h!==document&&e==="draginit"&&b.handle.call(document,c,o),k===!1?(j=="drag"&&(m.cancelled=!0,f.propagates-=1),e=="drop"&&(m[j][g]=null)):e=="dropinit"&&m.droppable.push(d.element(k)||h),e=="dragstart"&&(m.proxy=a(d.element(k)||m.drag)[0]),m.results.push(k),delete c.result;if(e!=="dropinit")return k}),f.results[l]=d.flatten(m.results),e=="dropinit"&&(m.droppable=d.flatten(m.droppable)),e=="dragstart"&&!m.cancelled&&o.update()}while(++l<p);return c.type=i.type,c.originalEvent=i.event,d.flatten(f.results)},properties:function(a,b,c){var e=c.callback;return e.drag=c.drag,e.proxy=c.proxy||c.drag,e.startX=b.pageX,e.startY=b.pageY,e.deltaX=a.pageX-b.pageX,e.deltaY=a.pageY-b.pageY,e.originalX=c.offset.left,e.originalY=c.offset.top,e.offsetX=a.pageX-(b.pageX-e.originalX),e.offsetY=a.pageY-(b.pageY-e.originalY),e.drop=d.flatten((c.drop||[]).slice()),e.available=d.flatten((c.droppable||[]).slice()),e},element:function(a){if(a&&(a.jquery||a.nodeType==1))return a},flatten:function(b){return a.map(b,function(b){return b&&b.jquery?a.makeArray(b):b&&b.length?d.flatten(b):b})},textselect:function(b){a(document)[b?"unbind":"bind"]("selectstart",d.dontstart).attr("unselectable",b?"off":"on").css("MozUserSelect",b?"":"none")},dontstart:function(){return!1},callback:function(){}};d.callback.prototype={update:function(){c.drop&&this.available.length&&a.each(this.available,function(a){c.drop.locate(this,a)})}},c.draginit=c.dragstart=c.dragend=d})(jQuery)