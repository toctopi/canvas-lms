(function(){function a(a,b,c,d,e,f){function g(a,b,c,d,e,f){var g=Math.PI/180,h=a+c*Math.cos(-d*g),i=a+c*Math.cos(-e*g),j=a+c/2*Math.cos(-(d+(e-d)/2)*g),k=b+c*Math.sin(-d*g),l=b+c*Math.sin(-e*g),m=b+c/2*Math.sin(-(d+(e-d)/2)*g),n=["M",a,b,"L",h,k,"A",c,c,0,+(Math.abs(e-d)>180),1,i,l,"z"];return n.middle={x:j,y:m},n}f=f||{};var h=this,i=[],j=a.set(),k=a.set(),l=a.set(),m=[],n=e.length,o=0,p=0,q=0,r=9,s=!0;k.covers=j;if(n==1)l.push(a.circle(b,c,d).attr({fill:h.colors[0],stroke:f.stroke||"#fff","stroke-width":f.strokewidth==null?1:f.strokewidth})),j.push(a.circle(b,c,d).attr(h.shim)),p=e[0],e[0]={value:e[0],order:0,valueOf:function(){return this.value}},l[0].middle={x:b,y:c},l[0].mangle=180;else{for(var t=0;t<n;t++)p+=e[t],e[t]={value:e[t],order:t,valueOf:function(){return this.value}};e.sort(function(a,b){return b.value-a.value});for(t=0;t<n;t++)s&&e[t]*360/p<=1.5&&(r=t,s=!1),t>r&&(s=!1,e[r].value+=e[t],e[r].others=!0,q=e[r].value);n=Math.min(r+1,e.length),q&&e.splice(n)&&(e[r].others=!0);for(t=0;t<n;t++){var u=o-360*e[t]/p/2;t||(o=90-u,u=o-360*e[t]/p/2);if(f.init)var v=g(b,c,1,o,o-360*e[t]/p).join(",");var w=g(b,c,d,o,o-=360*e[t]/p),x=a.path(f.init?v:w).attr({fill:f.colors&&f.colors[t]||h.colors[t]||"#666",stroke:f.stroke||"#fff","stroke-width":f.strokewidth==null?1:f.strokewidth,"stroke-linejoin":"round"});x.value=e[t],x.middle=w.middle,x.mangle=u,i.push(x),l.push(x),f.init&&x.animate({path:w.join(",")},+f.init-1||1e3,">")}for(t=0;t<n;t++)x=a.path(i[t].attr("path")).attr(h.shim),f.href&&f.href[t]&&x.attr({href:f.href[t]}),x.attr=function(){},j.push(x),l.push(x)}k.hover=function(a,f){f=f||function(){};var g=this;for(var h=0;h<n;h++)(function(h,i,j){var k={sector:h,cover:i,cx:b,cy:c,mx:h.middle.x,my:h.middle.y,mangle:h.mangle,r:d,value:e[j],total:p,label:g.labels&&g.labels[j]};i.mouseover(function(){a.call(k)}).mouseout(function(){f.call(k)})})(l[h],j[h],h);return this},k.each=function(a){var f=this;for(var g=0;g<n;g++)(function(g,h,i){var j={sector:g,cover:h,cx:b,cy:c,x:g.middle.x,y:g.middle.y,mangle:g.mangle,r:d,value:e[i],total:p,label:f.labels&&f.labels[i]};a.call(j)})(l[g],j[g],g);return this},k.click=function(a){var f=this;for(var g=0;g<n;g++)(function(g,h,i){var j={sector:g,cover:h,cx:b,cy:c,mx:g.middle.x,my:g.middle.y,mangle:g.mangle,r:d,value:e[i],total:p,label:f.labels&&f.labels[i]};h.click(function(){a.call(j)})})(l[g],j[g],g);return this},k.inject=function(a){a.insertBefore(j[0])};var y=function(g,i,m,o){var q=b+d+d/5,r=c,s=r+10;g=g||[],o=o&&o.toLowerCase&&o.toLowerCase()||"east",m=a[m&&m.toLowerCase()]||"circle",k.labels=a.set();for(var t=0;t<n;t++){var u=l[t].attr("fill"),v=e[t].order,w;e[t].others&&(g[v]=i||"Others"),g[v]=h.labelise(g[v],e[t],p),k.labels.push(a.set()),k.labels[t].push(a[m](q+5,s,5).attr({fill:u,stroke:"none"})),k.labels[t].push(w=a.text(q+20,s,g[v]||e[v]).attr(h.txtattr).attr({fill:f.legendcolor||"#000","text-anchor":"start"})),j[t].label=k.labels[t],s+=w.getBBox().height*1.2}var x=k.labels.getBBox(),y={east:[0,-x.height/2],west:[-x.width-2*d-20,-x.height/2],north:[-d-x.width/2,-d-x.height-10],south:[-d-x.width/2,d+10]}[o];k.labels.translate.apply(k.labels,y),k.push(k.labels)};return f.legend&&y(f.legend,f.legendothers,f.legendmark,f.legendpos),k.push(l,j),k.series=l,k.covers=j,k}var b=function(){};b.prototype=Raphael.g,a.prototype=new b,Raphael.fn.piechart=function(b,c,d,e,f){return new a(this,b,c,d,e,f)}})()