define(["jquery","vendor/jquery.ui.core-1.9","vendor/jquery.ui.widget-1.9","vendor/jquery.ui.position-1.9"],function(a,b,c,d){var e=0;a.widget("ui.popup",{version:"@VERSION",options:{position:{my:"left top",at:"left bottom"}},_create:function(){this.options.trigger||(this.options.trigger=this.element.prev()),this.element.attr("id")||(this.element.attr("id","ui-popup-"+e++),this.generatedId=!0),this.element.attr("role")||(this.element.attr("role","dialog"),this.generatedRole=!0),this.options.trigger.attr("aria-haspopup","true").attr("aria-owns",this.element.attr("id")),this.element.addClass("ui-popup"),this.close(),this._bind(this.options.trigger,{keydown:function(b){this.options.trigger.is("a:ui-button")&&b.keyCode==a.ui.keyCode.SPACE&&b.preventDefault(),b.keyCode==a.ui.keyCode.SPACE&&this.options.trigger.is("a:not(:ui-button)")&&this.options.trigger.trigger("click",b),b.keyCode==a.ui.keyCode.DOWN&&(b.preventDefault(),this.options.trigger.trigger("click",b))},click:function(a){a.preventDefault();if(this.isOpen)return;var b=this;clearTimeout(this.closeTimer),setTimeout(function(){b.open(a)},1)}}),this.element.is(":ui-menu")||this._bind({keydown:function(b){if(b.keyCode!==a.ui.keyCode.TAB)return;var c=a(":tabbable",this.element),d=c.first(),e=c.last();b.target===e[0]&&!b.shiftKey?(d.focus(1),b.preventDefault()):b.target===d[0]&&b.shiftKey&&(e.focus(1),b.preventDefault())}}),this._bind({focusout:function(a){var b=this;b.closeTimer=setTimeout(function(){b.close(a)},100)},focusin:function(a){clearTimeout(this.closeTimer)}}),this._bind({keyup:function(b){b.keyCode==a.ui.keyCode.ESCAPE&&this.element.is(":visible")&&(this.close(b),this.options.trigger.focus())}}),this._bind(document,{click:function(b){this.isOpen&&!a(b.target).closest(".ui-popup").length&&this.close(b)}})},_destroy:function(){this.element.show().removeClass("ui-popup").removeAttr("aria-hidden").removeAttr("aria-expanded").unbind("keypress.ui-popup"),this.options.trigger.removeAttr("aria-haspopup").removeAttr("aria-owns"),this.generatedId&&this.element.removeAttr("id"),this.generatedRole&&this.element.removeAttr("role")},open:function(b){var c=a.extend({},{of:this.options.trigger},this.options.position);this.element.show().attr("aria-hidden","false").attr("aria-expanded","true").position(c);if(this.element.is(":ui-menu"))this.element.menu("focus",b,this.element.children("li").first()),this.element.focus();else{var d=this.element.find(":tabbable");this.removeTabIndex=!1,d.length||(this.element.is(":tabbable")||(this.element.attr("tabindex","0"),this.removeTabIndex=!0),d=d.add(this.element[0])),d.first().focus(1)}this.options.trigger.attr("tabindex",-1),this.isOpen=!0,this._trigger("open",b)},close:function(a){this.element.hide().attr("aria-hidden","true").attr("aria-expanded","false"),this.options.trigger.attr("tabindex",0),this.removeTabIndex&&this.element.removeAttr("tabindex"),this.isOpen=!1,this._trigger("close",a)}})})