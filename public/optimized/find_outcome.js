define(["i18n!find_outcome","jquery","jquery.ajaxJSON","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.templateData"],function(a,b){var c=function(){return{find:function(d,e){e=e||{},c.callback=d;var f=b("#find_outcome_criterion_dialog");f.hasClass("loaded")||(f.find(".loading_message").text(a.t("messages.loading_outcomes","Loading Outcomes...")),b.ajaxJSON(f.find(".outcomes_list_url").attr("href"),"GET",{},function(c){valids=[];for(var d in c){var g=c[d].learning_outcome;(!e.for_rubric||g.data&&g.data.rubric_criterion)&&valids.push(g)}if(valids.length===0){var h;e.for_rubric?h=a.t("messages.no_rubric_outcomes_found","No Rubric-Configured Outcomes found"):h=a.t("messages.no_outcomes_found","No Outcomes found"),f.find(".loading_message").text(h)}else{f.find(".loading_message").hide(),f.addClass("loaded");for(var d in valids){var g=valids[d];g.name=g.short_description,g.mastery_points=g.data.rubric_criterion.mastery_points||g.data.rubric_criterion.points_possible;var i=f.find(".outcomes_select.blank:first").clone(!0).removeClass("blank");g.title=g.short_description;var j=b("<div/>");j.text(g.short_description),g.title=b.truncateText(b.trim(j.text()),35),g.display_name=g.cached_context_short_name||"",i.fillTemplateData({data:g}),f.find(".outcomes_selects").append(i.show());var k=f.find(".outcome.blank:first").clone(!0).removeClass("blank");k.find(".mastery_level").attr("id","outcome_question_bank_mastery_"+g.id).end().find(".mastery_level_text").attr("for","outcome_question_bank_mastery_"+g.id),g.learning_outcome_id=g.id;var l=g.data&&g.data.rubric_criterion,m=l.points_possible&&l.mastery_points!=null&&l.mastery_points/l.points_possible||0;m=Math.round(m*1e4)/100||"",k.find(".mastery_level").val(m),k.fillTemplateData({data:g,htmlValues:["description"]}),k.addClass("outcome_"+g.id);if(g.data&&g.data.rubric_criterion)for(var n in g.data.rubric_criterion.ratings){var o=g.data.rubric_criterion.ratings[n],p=k.find(".rating.blank").clone(!0).removeClass("blank");p.fillTemplateData({data:o}),k.find("tr").append(p.show())}f.find(".outcomes_list").append(k)}f.find(".outcomes_select:not(.blank):first").click()}},function(b){f.find(".loading_message").text(a.t("errors.outcome_retrieval_failed","Outcomes Retrieval failed unexpected.  Please try again."))}));var g;e.for_rubric?g=a.t("titles.find_outcome_criterion","Find Outcome Criterion"):g=a.t("titles.find_outcome","Find Outcome"),f.dialog("close").dialog({autoOpen:!1,modal:!0,title:g,width:700,height:400}).dialog("open")}}}();return window.find_outcome=c,b(document).ready(function(){b("#find_outcome_criterion_dialog .outcomes_select").click(function(a){a.preventDefault(),b("#find_outcome_criterion_dialog .outcomes_select.selected_side_tab").removeClass("selected_side_tab"),b(this).addClass("selected_side_tab");var c=b(this).getTemplateData({textValues:["id"]}).id;b("#find_outcome_criterion_dialog .outcomes_list .outcome").hide(),b("#find_outcome_criterion_dialog .outcomes_list .outcome_"+c).show()}),b("#find_outcome_criterion_dialog .select_outcome_link").click(function(a){a.preventDefault();var d=b(this).parents(".outcome");b("#find_outcome_criterion_dialog").dialog("close"),b.isFunction(c.callback)&&c.callback(d)})}),c})