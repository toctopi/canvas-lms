define(["i18n!question_bank","jquery","find_outcome","jquery.ajaxJSON","jquery.instructure_misc_plugins","jquery.templateData"],function(a,b,c){b(document).ready(function(){function d(c){b(".add_outcome_text").text(a.t("updating_outcomes","Updating Outcomes...")).attr("disabled",!0);var d={};for(var e in c){var f=c[e];d["assessment_question_bank[outcomes]["+f[0]+"]"]=f[1]}c.length==0&&(d["assessment_question_bank[outcomes]"]="");var g=b(".edit_bank_link").attr("href");b.ajaxJSON(g,"PUT",d,function(c){var d=c.assessment_question_bank.learning_outcome_tags.sort(function(a,b){var c=(a.content_tag&&a.content_tag.learning_outcome&&a.content_tag.learning_outcome.short_description||"none").toLowerCase(),d=(b.content_tag&&b.content_tag.learning_outcome&&b.content_tag.learning_outcome.short_description||"none").toLowerCase();return c<d?-1:c>d?1:0});b(".add_outcome_text").text(a.t("align_outcomes","Align Outcomes")).attr("disabled",!1);var e=b("#aligned_outcomes_list");e.find(".outcome:not(.blank)").remove();var f=e.find(".blank:first").clone(!0).removeClass("blank");for(var g in d){var h=d[g].content_tag,i={short_description:h.learning_outcome.short_description,mastery_threshold:Math.round(h.mastery_score*1e4)/100},j=f.clone(!0);j.attr("data-id",h.learning_outcome_id),j.fillTemplateData({data:i}),e.append(j.show())}},function(c){b(".add_outcome_text").text(a.t("update_outcomes_fail","Updating Outcomes Failed")).attr("disabled",!1)})}b("#aligned_outcomes_list").delegate(".delete_outcome_link","click",function(c){c.preventDefault();var e=confirm(a.t("remove_outcome_from_bank","Are you sure you want to remove this outcome from the bank?")),f=b(this).parents(".outcome"),g=[],h=f.attr("data-id");e&&(b(this).parents(".outcome").dim(),b("#aligned_outcomes_list .outcome:not(.blank)").each(function(){var a=b(this).attr("data-id"),c=b(this).getTemplateData({textValues:["mastery_threshold"]}).mastery_threshold/100;a!=h&&g.push([a,c])}),d(g))}),b(".add_outcome_link").click(function(a){a.preventDefault(),c.find(function(a){var c=a.find(".learning_outcome_id").text(),e=parseFloat(a.find(".mastery_level").val())/100||1,f=[];b("#aligned_outcomes_list .outcome:not(.blank)").each(function(){var a=b(this).attr("data-id"),c=b(this).getTemplateData({textValues:["mastery_threshold"]}).mastery_threshold/100;f.push([a,c])}),f.push([c,e]),d(f)})})})})