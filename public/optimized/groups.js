define(["i18n!groups","jquery","jquery.instructure_forms","jquery.loadingImg","jquery.templateData","vendor/jquery.pageless","vendor/jquery.scrollTo"],function(a,b){b(document).ready(function(){b(".add_group_link").click(function(a){a.preventDefault(),b("#add_group_form").slideDown(function(){b("html,body").scrollTo(b("#add_group_form"))})}),b("#add_group_form .cancel_button").click(function(){b("#add_group_form").slideUp()}),b("#add_group_form").formSubmit({beforeSubmit:function(c){b(this).loadingImage(),b(this).find(".submit_button").text(a.t("messages.creating_group","Creating Group...")).attr("disabled",!0)},success:function(c){b(this).loadingImage("remove"),b(this).find(".submit_button").text(a.t("buttons.create_group","Create Group")).attr("disabled",!1),b(this).slideUp();var d=b("#group_blank").clone(!0);d.fillTemplateData({data:c.group||c.course_assigned_group,hrefValues:["id"]}),d.attr("id","group_"+c.group.id),d.find(".members_count").text(a.t("member","member",{count:c.group.participating_users_count})),b("#group_blank").before(d.show()),b("html,body").scrollTo(d),d.animate({backgroundColor:"#FFEE88"},1e3).animate({display:"block"},2e3).animate({backgroundColor:"#FFFFFF"},2e3,function(){b(this).css("backgroundColor","")})},error:function(c){b(this).find(".submit_button").text(a.t("errors.creating_group_failed","Creating Group Failed")).attr("disabled",!1),b(this).loadingImage("remove")}}),b(".toggle_members_link").click(function(c){c.preventDefault(),c.stopPropagation();var d=b(this).parents("li.group"),e=d.find("ul.member_list");if(e.length){e.is(":visible")?(e.hide(),b(this).prop("title",a.t("member_tooltip_show","View group roster"))):(e.show(),b(this).prop("title",a.t("member_tooltip_hide","Hide group roster")));return}e=b("<ul/>").addClass("member_list");var f=b("<li/>").addClass("loader").html(a.t("loading","loading group roster..."));e.append(f),e.pageless({container:e,currentPage:0,totalPages:1,url:b(this).prop("href")+".json",loader:f,animate:!1,scrape:function(a,c){students=b.parseJSON(a);for(idx in students)b("<li/>").addClass("student").html(students[idx].display_name).insertBefore(f);return""}}),d.append(e),e.show(),b(this).prop("title",a.t("member_tooltip_hide","Hide group roster"))})})})