define(["INST","jquery","jquery.ajaxJSON"],function(a,b){b(document).ready(function(){var c=0,d=b("#page_view_id"),e=b("#page_view_update_path").attr("href"),f=!1;a.interaction_contexts={};if(document.cookie&&document.cookie.match(/last_page_view/)){var g=document.cookie.match(/last_page_view=([^;]+)/);if(g&&g[1])try{var h=b.parseJSON(unescape(g[1]));h&&h.url&&h.seconds&&setTimeout(function(){b.ajaxJSON(h.url,"PUT",{interaction_seconds:h.seconds},function(){},function(){},3e3)})}catch(i){}document.cookie="last_page_view=;expires=Thu, 01-Jan-1970 00:00:01 GMT"}if(d.length>0){var j=0,k=300;b(document).bind("page_view_id_received",function(a,c){b("#page_view_id").text(c),e="/page_views/"+c}),b(document).bind("page_view_update",function(a,f){var g={};d.hasClass("contributed")&&(g.contributed=!0);if(f||c>10&&j<k)g.interaction_seconds=c,b.ajaxJSON(e,"PUT",g,function(a){a&&a.id&&b(document).triggerHandler("page_view_id_receved",a.id)},function(){}),c=0}),setInterval(function(){b(document).triggerHandler("page_view_update")},1e3*k),window.onbeforeunload=function(){if(c>30){var a=new Date;a.setDate(a.getDate()+1);var b=JSON.stringify({url:e,seconds:c});document.cookie="last_page_view="+escape(b)}};var f=!1;b(document).bind("mousemove keypress mousedown focus",function(){f=!0}),setInterval(function(){f?(c++,a&&a.interaction_context&&a.interaction_contexts&&(a.interaction_contexts[a.interaction_context]=(a.interaction_contexts[a.interaction_context]||0)+1),f=!1,j>=k&&(j=0,b(document).triggerHandler("page_view_update")),j=0):j++},1e3)}})})