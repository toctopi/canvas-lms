(function(){define(["i18n!conversations.conversations_pane","compiled/conversations/ConversationsList","str/htmlEscape","compiled/util/shortcut"],function(a,b,c,d){return function(){function c(a,c){this.app=a,this.$pane=c,this.list=new b(this,this.$pane.find("> div.conversations")),this.selected=[],this.initializeActions()}return d(c,"list","baseData","updateItems","isActive"),c.prototype.initializeActions=function(){var b,c=this;return b=$("#conversation_actions").find("li a"),b.click(function(a){return a.preventDefault(),c.app.closeMenus()}),b.filter(".standard_action").click(function(a){return c.action($(a.currentTarget),{method:"PUT"})}),$("#action_delete_all").click(function(b){if(confirm(a.t("confirm.delete_conversation","Are you sure you want to delete your copy of this conversation? This action cannot be undone.")))return c.action($(b.currentTarget),{method:"DELETE"})})},c.prototype.updateView=function(a){return this.list.load(a)},c.prototype.action=function(a,b){var c,d,e,f,g=this;return d=(f=b.conversationId)!=null?f:a.closest("div.conversations li").data("id"),d==null&&(d=$("#conversation_actions").data("activeConversationId")),c=this.list.item(d),b=$.extend(!0,{},{url:this.actionUrlFor(a,d)},b),e=b.success,b.success=function(a){var b;return((b=a.messages)!=null?b.length:void 0)&&g.app.addMessage(a.messages[0]),typeof e=="function"?e(a):void 0},c.inboxAction(b)},c.prototype.actionUrlFor=function(a,b){var c;return c=$.replaceTags(a.attr("href"),"id",b),c+(c.match(/\?/)?"&":"?")+$.param(this.baseData())},c.prototype.active=function(){return this.list.active},c.prototype.openConversationMenu=function(a){var b,c,d,e,f=this;return this.app.closeMenus(),d={node:a,container:$("#conversation_actions"),conversation:a.closest("li"),parent:a.parent(),lists:$("#conversation_actions ul"),listElements:$("#conversation_actions li"),focusable:$("a, input, select, textarea"),actions:{markAsRead:$("#action_mark_as_read").parent(),markAsUnread:$("#action_mark_as_unread").parent(),unstar:$("#action_unstar").parent(),star:$("#action_star").parent(),unsubscribe:$("#action_unsubscribe").parent(),subscribe:$("#action_subscribe").parent(),forward:$("#action_forward").parent(),archive:$("#action_archive").parent(),unarchive:$("#action_unarchive").parent(),"delete":$("#action_delete").parent(),deleteAll:$("#action_delete_all").parent()}},this.activeActionMenu=d.node,d.parent.addClass("selected"),d.container.addClass("selected"),d.conversation.addClass("menu_active"),b=d.container,c=d.conversation,d.container.data("activeConversationId",d.conversation.data("id")),d.lists.removeClass("first last").hide(),d.listElements.hide(),d.conversation.hasClass("unread")&&d.actions.markAsRead.show(),d.conversation.hasClass("read")&&d.actions.markAsUnread.show(),d.conversation.hasClass("starred")?d.actions.unstar.show():d.actions.star.show(),d.conversation.hasClass("private")?(d.actions.subscribe.hide(),d.actions.unsubscribe.hide()):(d.conversation.hasClass("unsubscribed")||d.actions.unsubscribe.show(),d.conversation.hasClass("unsubscribed")&&d.actions.subscribe.show()),d.actions.forward.show(),d.actions["delete"].show(),d.actions.deleteAll.show(),d.conversation.hasClass("archived")?d.actions.unarchive.show():d.actions.archive.show(),$(window).one("keydown",function(a){if(a.keyCode!==9||a.shiftKey)return;return d.focusable.one("focus.actions_menu",function(a){return f.nextElement=$(a.target),d.focusable.unbind(".actions_menu"),d.container.find("a:visible:first").focus(),d.container.find("a:visible:first").bind("blur.actions_menu",a,function(){return $(window).one("keyup",function(a){var b;b=d.container.find("a:focus").length;if(!b)return d.container.find("a.visible").unbind(".actions_menu"),f.activeActionMenu.focus()})}),d.container.find("a:visible:last").bind("blur.actions_menu",a,function(){return $(window).one("keyup",function(a){var b;b=d.container.find("a:focus").length;if(!b)return d.container.find("a.visible").unbind(".actions_menu"),f.nextElement.focus(),f.closeMenus()})})})}),d.container.find('li[style*="list-item"]').parent().show(),d.groups=d.container.find('ul[style*="block"]'),d.groups.length&&(d.groups.first().addClass("first"),d.groups.last().addClass("last")),e=d.node.offset(),d.container.css({left:e.left+d.node.width()/2-d.container.offsetParent().offset().left-d.container.width()/2,top:e.top+d.node.height()*.9-d.container.offsetParent().offset().top})},c.prototype.resize=function(a){return this.list.$scroller.height(a-$("#actions").outerHeight(!0)),this.list.fetchVisible()},c}()})}).call(this)