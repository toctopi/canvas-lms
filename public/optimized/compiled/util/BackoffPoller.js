(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","jquery.ajaxJSON"],function(b){var c;return c=function(){function c(b,c,d){var e,f,g,h,i;this.url=b,this.handler=c,d==null&&(d={}),this.handle=a(this.handle,this),this.poll=a(this.poll,this),this.baseInterval=(e=d.baseInterval)!=null?e:1e3,this.backoffFactor=(f=d.backoffFactor)!=null?f:1.5,this.maxAttempts=(g=d.maxAttempts)!=null?g:8,this.handleErrors=(h=d.handleErrors)!=null?h:!1,this.initialDelay=(i=d.initialDelay)!=null?i:!0}return c.name="BackoffPoller",c.prototype.start=function(){return this.running?this.reset():this.nextPoll(!0),this},c.prototype.then=function(a){return this.callbacks==null&&(this.callbacks=[]),this.callbacks.push(a)},c.prototype.reset=function(){return this.nextInterval=this.baseInterval,this.attempts=0},c.prototype.stop=function(a){var b,c,d,e;a==null&&(a=!1),this.running&&clearTimeout(this.running),delete this.running;if(a&&this.callbacks){e=this.callbacks;for(c=0,d=e.length;c<d;c++)b=e[c],b()}return delete this.callbacks},c.prototype.poll=function(){var a=this;return this.running=!0,this.attempts++,b.ajaxJSON(this.url,"GET",{},this.handle,function(b,c){return a.handleErrors?a.handle(b,c):a.stop()})},c.prototype.handle=function(a,b){switch(this.handler(a,b)){case"continue":return this.nextPoll();case"reset":return this.nextPoll(!0);case"stop":return this.stop(!0);default:return this.stop()}},c.prototype.nextPoll=function(a){a==null&&(a=!1);if(a){this.reset();if(!this.initialDelay)return this.poll()}else this.nextInterval=parseInt(this.nextInterval*this.backoffFactor);return this.attempts<this.maxAttempts?this.running=setTimeout(this.poll,this.nextInterval):this.stop()},c}()})}).call(this)