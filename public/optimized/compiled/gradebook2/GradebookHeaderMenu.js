(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n!gradebook2","jquery","message_students","compiled/AssignmentDetailsDialog","compiled/AssignmentMuter","compiled/gradebook2/SetDefaultGradeDialog","compiled/gradebook2/CurveGradesDialog","jst/gradebook2/GradebookHeaderMenu","jst/re_upload_submissions_form","underscore","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","compiled/jquery.kylemenu"],function(b,c,d,e,f,g,h,i,j,k){var l;return l=function(){function d(b,d,e){var g,h=this;this.assignment=b,this.$trigger=d,this.gradebook=e,this.reuploadSubmissions=a(this.reuploadSubmissions,this),this.downloadSubmissions=a(this.downloadSubmissions,this),this.curveGrades=a(this.curveGrades,this),this.setDefaultGrade=a(this.setDefaultGrade,this),this.messageStudentsWho=a(this.messageStudentsWho,this),this.showAssignmentDetails=a(this.showAssignmentDetails,this),g={assignmentUrl:""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id,speedGraderUrl:""+this.gradebook.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id},this.$menu=c(i(g)).insertAfter(this.$trigger),this.$trigger.kyleMenu({noButton:!0}),this.$menu.appendTo("#gradebook_grid").delegate("a","click",function(a){var b;b=h[c(a.target).data("action")];if(b)return b(),!1}).bind("popupopen popupclose",function(a){return h.$trigger.toggleClass("ui-menu-trigger-menu-is-open",a.type==="popupopen")}).bind("popupopen",function(){var a,b,c,d;c={showAssignmentDetails:h.gradebook.allSubmissionsLoaded,messageStudentsWho:h.gradebook.allSubmissionsLoaded,setDefaultGrade:h.gradebook.allSubmissionsLoaded,curveGrades:h.gradebook.allSubmissionsLoaded&&h.assignment.grading_type!=="pass_fail"&&h.assignment.points_possible,downloadSubmissions:(""+h.assignment.submission_types).match(/(online_upload|online_text_entry|online_url)/),reuploadSubmissions:h.assignment.submissions_downloads>0},d=[];for(a in c)b=c[a],d.push(h.$menu.find("[data-action="+a+"]").showIf(b));return d}).popup("open"),new f(this.$menu.find("[data-action=toggleMuting]"),this.assignment,""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id+"/mute")}return d.name="GradebookHeaderMenu",d.prototype.showAssignmentDetails=function(){return new e(this.assignment,this.gradebook)},d.prototype.messageStudentsWho=function(){var a,d,e,f,g,h;return g=function(){var a,b;a=this.gradebook.students,b=[];for(d in a)f=a[d],b.push(c.extend({id:f.id,name:f.name},f["assignment_"+this.assignment.id]));return b}.call(this),h=this.assignment.submission_types,a=!0,h.length===0?a=!1:h.length===1&&(a=!k.include(["none","on_paper"],h[0])),e=[{text:b.t("students_who.havent_submitted_yet","Haven't submitted yet")},{text:b.t("students_who.havent_been_graded","Haven't been graded")},{text:b.t("students_who.scored_less_than","Scored less than"),cutoff:!0},{text:b.t("students_who.scored_more_than","Scored more than"),cutoff:!0}],a||e.splice(0,1),window.messageStudents({options:e,title:this.assignment.name,points_possible:this.assignment.points_possible,students:g,callback:function(a,d,e){return e=c.grep(e,function(c,e){f=c.user_data;if(a===b.t("students_who.havent_submitted_yet","Haven't submitted yet"))return!f.submitted_at;if(a===b.t("students_who.havent_been_graded","Haven't been graded"))return f.score==null;if(a===b.t("students_who.scored_less_than","Scored less than"))return f.score!=null&&f.score!==""&&d!=null&&f.score<d;if(a===b.t("students_who.scored_more_than","Scored more than"))return f.score!=null&&f.score!==""&&d!=null&&f.score>d}),c.map(e,function(a){return a.user_data.id})}})},d.prototype.setDefaultGrade=function(){return new g(this.assignment,this.gradebook)},d.prototype.curveGrades=function(){return new h(this.assignment,this.gradebook)},d.prototype.downloadSubmissions=function(){var a,b,d;return a=c.replaceTags(this.gradebook.options.download_assignment_submissions_url,"assignment_id",this.assignment.id),INST.downloadSubmissions(a),this.assignment.submissions_downloads=((d=(b=this.assignment).submissions_downloads)!=null?d:b.submissions_downloads=0)+1},d.prototype.reuploadSubmissions=function(){var a;return this.$re_upload_submissions_form||(d.prototype.$re_upload_submissions_form=c(j()).dialog({width:400,modal:!0,resizable:!1,autoOpen:!1}).submit(function(){var a;a=c(this).getFormData();if(!a.submissions_zip)return!1;if(!a.submissions_zip.match(/\.zip$/))return c(this).formErrors({submissions_zip:b.t("errors.upload_as_zip","Please upload files as a .zip")}),!1})),a=c.replaceTags(this.gradebook.options.re_upload_submissions_url,"assignment_id",this.assignment.id),this.$re_upload_submissions_form.attr("action",a).dialog("open")},d}()})}).call(this)