(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["compiled/gradebook2/GRADEBOOK_TRANSLATIONS","jquery","jquery.ajaxJSON"],function(a,c){var d;return d=function(){function b(a){this.opts=a,this.init()}return b.name="SubmissionCell",b.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=c(this.cellWrapper('<input class="grade"/>')).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},b.prototype.destroy=function(){return this.$input.remove()},b.prototype.focus=function(){return this.$input.focus()},b.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||"",this.$input.val(this.val),this.$input[0].defaultValue=this.val,this.$input.select()},b.prototype.serializeValue=function(){return this.$input.val()},b.prototype.applyValue=function(a,b){var c;return a[this.opts.column.field].grade=b,(c=this.wrapper)!=null&&c.remove(),this.postValue(a,b)},b.prototype.postValue=function(a,b){var d,e,f=this;return d=a[this.opts.column.field],e=this.opts.grid.getOptions().change_grade_url,e=e.replace(":assignment",d.assignment_id).replace(":submission",d.user_id),c.ajaxJSON(e,"PUT",{"submission[posted_grade]":b},function(a){return c.publish("submissions_updated",[[a]])})},b.prototype.isValueChanged=function(){return this.val!==this.$input.val()},b.prototype.validate=function(){return{valid:!0,msg:null}},b.formatter=function(a,b,c,d){return this.prototype.cellWrapper(c.grade,{submission:c,assignment:d,editable:!1})},b.prototype.cellWrapper=function(d,e){var f,g,h,i;return e==null&&(e={}),f=c.extend({},{innerContents:"",classes:"",editable:!0},e),f.submission||(f.submission=this.opts.item[this.opts.column.field]),f.assignment||(f.assignment=this.opts.column.object),g=b.classesBasedOnSubmission(f.submission,f.assignment),h=c.map(g,function(b){return a["submission_tooltip_"+b]}).join(", "),f.submission.grade||(f.classes+=" no_grade_yet "),d==null&&(d=((i=f.submission)!=null?i.submission_type:void 0)?'<span class="submission_type_icon" />':"-"),""+(h?'<div class="gradebook-tooltip">'+h+"</div>":"")+'\n<div class="gradebook-cell '+(f.editable?"gradebook-cell-editable focus":"")+" "+f.classes+" "+g.join(" ")+'">\n  <a href="#" data-user-id='+f.submission.user_id+" data-assignment-id="+f.assignment.id+' class="gradebook-cell-comment"><span class="gradebook-cell-comment-label">submission comments</span></a>\n  '+d+"\n</div>"},b.classesBasedOnSubmission=function(a,b){var c;return a==null&&(a={}),b==null&&(b={}),c=[],a.grade_matches_current_submission===!1&&c.push("resubmitted"),b.due_at&&a.submitted_at&&a.submitted_at.timestamp>b.due_at.timestamp&&c.push("late"),a.drop&&c.push("dropped"),""+b.submission_types=="not_graded"&&c.push("ungraded"),b.muted&&c.push("muted"),a.submission_type&&c.push(a.submission_type),c},b}(),d.out_of=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.name="out_of",d.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=c(this.cellWrapper('<div class="overflow-wrapper">\n  <div class="grade-and-outof-wrapper">\n    <input type="number" class="grade"/><span class="outof"><span class="divider">/</span>'+this.opts.column.object.points_possible+"</span>\n  </div>\n</div>",{classes:"gradebook-cell-out-of-formatter"})).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},d}(d),d.letter_grade=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.name="letter_grade",c.formatter=function(a,b,c,e){var f;return f=c.score?""+c.grade+"<span class='letter-grade-points'>"+c.score+"</span>":c.grade,d.prototype.cellWrapper(f,{submission:c,assignment:e,editable:!1})},c}(d),d.pass_fail=function(a){function g(){return g.__super__.constructor.apply(this,arguments)}var e,f;return b(g,a),g.name="pass_fail",f=["pass","fail",""],e=function(a){return{pass:"pass",complete:"pass",fail:"fail",incomplete:"fail"}[a.grade]||""},g.prototype.htmlFromSubmission=function(a){var b;return a==null&&(a={}),b=e(a.submission),d.prototype.cellWrapper('<a data-value="'+b+'" class="gradebook-checkbox gradebook-checkbox-'+b+" "+(a.editable?"editable":void 0)+'" href="#">'+b+"</a>",a)},g.formatter=function(a,b,c,e){return c.grade==null?d.formatter.apply(this,arguments):g.prototype.htmlFromSubmission({submission:c,assignment:e,editable:!1})},g.prototype.init=function(){var a=this;return this.$wrapper=c(this.cellWrapper()),this.$wrapper=c(this.htmlFromSubmission({submission:this.opts.item[this.opts.column.field],assignment:this.opts.column.object,editable:!0})).appendTo(this.opts.container),this.$input=this.$wrapper.find(".gradebook-checkbox").bind("click keypress",function(b){var c,d;return b.preventDefault(),c=a.$input.data("value"),c==="pass"?d="fail":c==="fail"?d="":d="pass",a.transitionValue(d)}).focus()},g.prototype.destroy=function(){return this.$wrapper.remove()},g.prototype.transitionValue=function(a){return this.$input.removeClass("gradebook-checkbox-pass gradebook-checkbox-fail").addClass("gradebook-checkbox-"+e({grade:a})).data("value",a)},g.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||""},g.prototype.serializeValue=function(){return this.$input.data("value")},g.prototype.isValueChanged=function(){return this.val!==this.$input.data("value")},g}(d),d.points=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.name="points",c}(d),d})}).call(this)