(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n!submission_details_dialog","jquery","jst/SubmissionDetailsDialog","jst/_submission_detail","jst/_turnitinScore","jquery.ajaxJSON","jquery.disableWhileLoading","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_plugins","vendor/jquery.scrollTo"],function(b,c,d){var e;return e=function(){function e(b,e,f){var g,h=this;this.assignment=b,this.student=e,this.options=f,this.update=a(this.update,this),this.scrollCommentsToBottom=a(this.scrollCommentsToBottom,this),this.open=a(this.open,this),this.url=this.options.change_grade_url.replace(":assignment",this.assignment.id).replace(":submission",this.student.id),this.submission=c.extend({},this.student["assignment_"+this.assignment.id],{assignment:this.assignment,speedGraderUrl:""+this.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id+"#%7B%22student_id%22%3A"+this.student.id+"%7D",loading:!0}),this.dialog=c('<div class="use-css-transitions-for-show-hide" style="padding:0;"/>'),this.dialog.html(d(this.submission)).dialog({title:this.student.name,width:600,resizable:!1,open:this.scrollCommentsToBottom}).delegate("select","change",function(a){return h.dialog.find(".submission_detail").each(function(b){return c(this).showIf(b===a.currentTarget.selectedIndex)})}).delegate(".submission_details_add_comment_form","submit",function(a){return a.preventDefault(),c(a.currentTarget).disableWhileLoading(c.ajaxJSON(h.url,"PUT",c(a.currentTarget).getFormData(),function(a){return h.update(a),setTimeout(function(){return h.dialog.dialog("close")},500)}))}),g=c.ajaxJSON(this.url+"?include[]=submission_history&include[]=submission_comments&include[]=rubric_assessment","GET",{},this.update),this.dialog.find(".submission_details_comments").disableWhileLoading(g)}return e.name="SubmissionDetailsDialog",e.prototype.open=function(){return this.dialog.dialog("open")},e.prototype.scrollCommentsToBottom=function(){return this.dialog.find(".submission_details_comments").scrollTop(999999)},e.prototype.update=function(a){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;c.extend(this.submission,a),this.submission.submission_history[0]=this.submission,this.submission.moreThanOneSubmission=this.submission.submission_history.length>1,this.submission.loading=!1,p=this.submission.submission_history;for(j=0,m=p.length;j<m;j++){g=p[j],g["submission_type_is"+g.submission_type]=!0,g.submissionWasLate=this.assignment.due_at&&new Date(this.assignment.due_at)>new Date(g.submitted_at),q=g.submission_comments||[];for(k=0,n=q.length;k<n;k++)f=q[k],f.url=""+this.options.context_url+"/users/"+f.author_id,i=""+location.protocol+"//"+location.host,f.image_url=""+i+"/images/users/"+f.author_id+"?fallback="+encodeURIComponent(i+"/images/messages/avatar-50.png");r=g.attachments||[];for(l=0,o=r.length;l<o;l++)e=r[l],(h=(s=g.turnitin_data)!=null?s["attachment_"+e.id]:void 0)&&h.similarity_score&&(e.turnitin_data=h,e.turnitin_data.state=""+(h.state||"no")+"_score",e.turnitin_data.score=""+h.similarity_score+"%",e.turnitin_data.reportUrl=""+this.options.context_url+"/assignments/"+this.assignment.id+"/submissions/"+this.student.id+"/turnitin/attachment_"+e.id,e.turnitin_data.tooltip=b.t("turnitin.tooltip.score","Turnitin Similarity Score - See detailed report"))}return this.dialog.html(d(this.submission)),this.dialog.find("select").trigger("change"),this.scrollCommentsToBottom()},e.cachedDialogs={},e.open=function(a,b,c){var d,f;return((d=e.cachedDialogs)[f=""+a.id+"-"+b.id]||(d[f]=new e(a,b,c))).open()},e}()})}).call(this)