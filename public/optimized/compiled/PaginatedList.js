(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n!paginated_list","vendor/spin"],function(b,c){var d;return d=function(){function d(b,c){this.onResponse=a(this.onResponse,this),this.getData=a(this.getData,this),this.cacheElements(b),this.options=$.extend({},this.defaultOptions,c),this.addEvents(),this.options.start&&this.getData()}return d.name="PaginatedList",d.prototype.keys={noResults:b.t("no_results_found","No Results"),viewMore:b.t("view_more_link","View More")},d.prototype.spinnerOptions={length:4,lines:12,radius:7,width:2},d.prototype.defaultOptions={presenter:!1,requestParams:{page:1,per_page:25},start:!0,template:$.noop,url:""},d.prototype.cacheElements=function(a){this.el={wrapper:a,list:a.find("ul:first")};if(this.el.wrapper.css("position")==="static")return this.el.wrapper.css("position","relative")},d.prototype.addEvents=function(){return this.el.wrapper.delegate(".view-more-link","click",this.getData)},d.prototype.getData=function(a){return a&&a.preventDefault(),this.startSpinner(a),this.currentRequest=$.getJSON(this.options.url,this.options.requestParams,this.onResponse)},d.prototype.onResponse=function(a){return this.stopSpinner(),a.length===0?this.noResults():(this.options.presenter&&(a=this.options.presenter(a)),this.animateInResults($(this.options.template(a))),this.updatePaging())},d.prototype.startSpinner=function(a){this.spinner=(new c(this.spinnerOptions)).spin(this.el.wrapper[0]).el;if(a!=null)return $(this.spinner).css({bottom:10,top:"auto"})},d.prototype.stopSpinner=function(){return $(this.spinner).remove()},d.prototype.animateInResults=function(a){var b;return b=this.el.list.children().length===0,a.css("display","none"),this.el.list.append(a),a.slideDown()},d.prototype.updatePaging=function(){if(!this.hasNextPage())return this.el.wrapper.find(".view-more-link").remove();this.options.requestParams.page++;if(!this.pageLinkPresent)return this.el.wrapper.append(this.viewMoreLink()),this.pageLinkPresent=!0},d.prototype.hasNextPage=function(){return this.currentRequest.getAllResponseHeaders().match(/rel="next"/)},d.prototype.viewMoreLink=function(){return'<a class="view-more-link" href="#">'+this.keys.viewMore+"</a>"},d.prototype.noResults=function(){return this.el.list.append("<li>"+this.keys.noResults+"</li>")},d}()})}).call(this)