(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["Backbone","i18n!discussions","underscore","jquery","jquery.ajaxJSON"],function(b,c,d,e){var f,g,h;return g=2e3,f=100,h=function(){function h(b){var c=this;this.view=b,this.markAsRead=a(this.markAsRead,this),h.unread.push(this),this.view.model.bind("change:collapsedView",function(a,b){c.ignore=b;if(b)return c.clearTimer()})}var b,c=this;return h.name="MarkAsReadWatcher",h.unread=[],h.prototype.createTimer=function(){return this.timer||(this.timer=setTimeout(this.markAsRead,g))},h.prototype.clearTimer=function(){return clearTimeout(this.timer),delete this.timer},h.prototype.markAsRead=function(){return this.view.model.markAsRead(),h.unread=d(h.unread).without(this),h.trigger("markAsRead",this.view.model)},b=e(window),h.init=function(){return b.bind("scroll resize",this.checkForVisibleEntries),this.checkForVisibleEntries()},h.checkForVisibleEntries=d.throttle(function(){var a,c,d,e,f,g,i,j;f=b.scrollTop(),a=f+b.height(),j=h.unread;for(g=0,i=j.length;g<i;g++){c=j[g];if(c.ignore)continue;e=c.view.$el.offset().top,d=e<a&&e+c.view.$el.height()>f,c[d?"createTimer":"clearTimer"]()}},f),h}.call(this),d.extend(h,b.Events)})}).call(this)