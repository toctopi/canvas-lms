(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["compiled/discussions/app","jquery","underscore","Backbone","compiled/discussions/findParticipant","jquery.ajaxJSON"],function(a,c,d,e,f){var g;return g=function(a){function g(){return g.__super__.constructor.apply(this,arguments)}return b(g,a),g.name="Entry",g.prototype.defaults={id:null,parent_id:null,message:null,user_id:null,read_state:"read",created_at:null,updated_at:null,deleted:!1,attachment:null,replies:[],parent_cid:null,collapsedView:!1,canAttach:ENV.DISCUSSION.PERMISSIONS.CAN_ATTACH,focused:!1},g.prototype.computedAttributes=["author","editor","canModerate","allowsSideComments","hideRepliesOnCollapse","speedgraderUrl",{name:"canReply",deps:["parent_id"]},{name:"summary",deps:["message"]}],g.prototype.read=function(){return""+ENV.DISCUSSION.ENTRY_ROOT_URL+"?ids[]="+this.get("id")},g.prototype.create=function(){var a;return a=this.get("parent_id"),a===null?ENV.DISCUSSION.ROOT_REPLY_URL:ENV.DISCUSSION.REPLY_URL.replace(/:entry_id/,a)},g.prototype["delete"]=function(){return ENV.DISCUSSION.DELETE_URL.replace(/:id/,this.get("id"))},g.prototype.update=function(){return ENV.DISCUSSION.DELETE_URL.replace(/:id/,this.get("id"))},g.prototype.sync=function(a,b,c){return c==null&&(c={}),c.url=this[a](),e.sync(a,this,c)},g.prototype.parse=function(a){return d.isArray(a)?a[0]:a},g.prototype.author=function(){return this.get("deleted")?{}:f(this.get("user_id"))},g.prototype.canModerate=function(){var a;return a=this.get("user_id")===ENV.DISCUSSION.CURRENT_USER.id,a||ENV.DISCUSSION.PERMISSIONS.MODERATE},g.prototype.canReply=function(){return ENV.DISCUSSION.PERMISSIONS.CAN_REPLY?ENV.DISCUSSION.THREADED?!0:!1:!1},g.prototype.editor=function(){var a;if(a=this.get("editor_id"))return f(a)},g.prototype.speedgraderUrl=function(){if(ENV.DISCUSSION.SPEEDGRADER_URL_TEMPLATE)return ENV.DISCUSSION.SPEEDGRADER_URL_TEMPLATE.replace(/%22%3Astudent_id%22/,this.get("user_id"))},g.prototype.summary=function(){return this.escapeDiv||(this.escapeDiv=c("<div/>")),this.escapeDiv.html(this.get("message")).text()},g.prototype.allowsSideComments=function(){var a;return a=this.get("deleted"),!ENV.DISCUSSION.THREADED&&ENV.DISCUSSION.PERMISSIONS.CAN_REPLY&&this.get("parent_id")===null&&!a},g.prototype.hideRepliesOnCollapse=function(){return!ENV.DISCUSSION.THREADED&&this.get("parent_id")===null},g.prototype.markAsRead=function(){var a;return this.set("read_state","read"),a=ENV.DISCUSSION.MARK_READ_URL.replace(/:id/,this.get("id")),c.ajaxJSON(a,"PUT")},g}(e.Model)})}).call(this)