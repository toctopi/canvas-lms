(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","underscore","jst/calendar/contextSelector","jst/calendar/contextSelectorItem","compiled/fn/preventDefault"],function(b,c,d,e,f){var g,h;return h=function(){function d(b){this.context=b,this.sectionChange=a(this.sectionChange,this),this.setState=a(this.setState,this),this.change=a(this.change,this),this.toggleSections=a(this.toggleSections,this),this.state="off",this.locked=!1}return d.name="ContextSelectorItem",d.prototype.render=function(a){return this.$listItem=b(e(this.context)),this.$listItem.appendTo(a),this.$sectionsList=this.$listItem.find(".ag_sections"),this.$listItem.find(".ag_sections_toggle").click(f(this.toggleSections)),this.$contentCheckbox=this.$listItem.find('[name="context_codes[]"]'),this.$contentCheckbox.change(f(this.change)),this.$sectionCheckboxes=this.$listItem.find('[name="sections[]"]'),this.$sectionCheckboxes.change(this.sectionChange)},d.prototype.toggleSections=function(a){return b(a.target).toggleClass("ag-sections-expanded"),this.$sectionsList.toggleClass("hidden")},d.prototype.change=function(){var a;return a=function(){switch(this.state){case"off":return"on";case"on":return"off";case"partial":return"on"}}.call(this),this.setState(a)},d.prototype.setState=function(a){var c;if(this.locked)return;this.state=a;switch(this.state){case"on":case"off":c=this.state==="on",this.$contentCheckbox.prop("checked",c),this.$contentCheckbox.prop("indeterminate",!1),this.$sectionCheckboxes.prop("checked",c);break;case"partial":this.$contentCheckbox.prop("checked",!0),this.$contentCheckbox.prop("indeterminate",!0)}return b.publish("/contextSelector/changed")},d.prototype.sectionChange=function(){switch(this.$sectionCheckboxes.filter(":checked").length){case 0:return this.setState("off");case this.$sectionCheckboxes.length:return this.setState("on");default:return this.setState("partial")}},d.prototype.disable=function(){return this.$contentCheckbox.prop("disabled",!0),this.disableSections()},d.prototype.disableSections=function(){return this.$sectionCheckboxes.prop("disabled",!0)},d.prototype.lock=function(){return this.locked=!0,this.disable(),this.disableSections()},d.prototype.isChecked=function(){return this.state!=="off"},d.prototype.sections=function(){var a;return a=this.$sectionCheckboxes.filter(":checked"),a.length===this.$sectionCheckboxes.length?[]:c.map(a,function(a){return a.value})},d}(),g=function(){function a(a,c,e,g,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=this;this.apptGroup=c,this.contexts=e,this.$menu=b(a).html(d()),j=this.$menu.find(".ag-contexts"),b.subscribe("/contextSelector/changed",function(){return g(H.selectedContexts(),H.selectedSections())}),this.contextSelectorItems={},B=this.contexts;for(r=0,v=B.length;r<v;r++)k=B[r],o=new h(k),o.render(j),this.contextSelectorItems[o.context.asset_string]=o;C=this.apptGroup.context_codes;for(s=0,w=C.length;s<w;s++){m=C[s];if(!this.contextSelectorItems[m])continue;this.contextSelectorItems[m].setState("on"),this.contextSelectorItems[m].lock()}if(this.apptGroup.sub_context_codes.length>0)if(this.apptGroup.sub_context_codes[0].match(/^group_category_/)){D=this.contextSelectorItems;for(k in D)o=D[k],o.lock()}else{n={},E=this.contexts;for(t=0,x=E.length;t<x;t++){k=E[t],F=k.course_sections;for(u=0,y=F.length;u<y;u++)p=F[u],n[p.asset_string]=k.asset_string}G=this.apptGroup.sub_context_codes;for(A=0,z=G.length;A<z;A++)q=G[A],b("[value='"+q+"']").prop("checked",!0),l=n[q],o=this.contextSelectorItems[l],o.sectionChange(),o.lock()}b(".ag_contexts_done").click(f(i)),g(this.selectedContexts(),this.selectedSections())}return a.name="ContextSelector",a.prototype.selectedContexts=function(){var a;return a=c.chain(this.contextSelectorItems).values().filter(function(a){return a.state!=="off"}).map(function(a){return a.context.asset_string}).value(),a},a.prototype.selectedSections=function(){var a;return a=c.chain(this.contextSelectorItems).values().map(function(a){return a.sections()}).reject(function(a){return a.length===0}).flatten().value(),a},a}()})}).call(this)