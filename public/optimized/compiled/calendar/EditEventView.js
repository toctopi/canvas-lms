(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["jquery","underscore","i18n!calendar.edit","Backbone","jst/calendar/editCalendarEventFull","wikiSidebar","compiled/object/unflatten","tinymce.editor_box","compiled/tinymce"],function(b,d,e,f,g,h,i){var j;return j=function(f){function j(){return this.toggleUseSectionDates=a(this.toggleUseSectionDates,this),this.toggleUsingSectionClass=a(this.toggleUsingSectionClass,this),this.destroyModel=a(this.destroyModel,this),this.render=a(this.render,this),j.__super__.constructor.apply(this,arguments)}return c(j,f),j.name="EditCalendarEventView",j.prototype.el=b("#content"),j.prototype.template=g,j.prototype.events={"submit form":"submit",'change [name="use_section_dates"]':"toggleUseSectionDates","click .delete_link":"destroyModel"},j.prototype.initialize=function(){var a=this;return this.model.fetch().done(function(){var b,c;return ENV.NEW_CALENDAR_EVENT_ATTRIBUTES&&(b=a.model.parse(ENV.NEW_CALENDAR_EVENT_ATTRIBUTES),b.all_day=((c=b.start_at)!=null?!!c.equals(b.end_at):!!void 0)&&b.start_at.equals(b.start_at.clearTime()),a.model.set(b)),a.render()}),this.model.on("change:use_section_dates",this.toggleUsingSectionClass)},j.prototype.render=function(){var a;return this.$el.html(this.template(this.model.toJSON("forView"))),this.$(".date_field").date_field(),this.$(".time_field").time_field(),a=this.$("textarea").editorBox(),h.inited||h.init(),h.attachToEditor(a).show(),this},j.prototype.destroyModel=function(){var a,b=this;a=e.t("confirm_delete_calendar_event","Are you sure you want to delete this calendar event?");if(confirm(a))return this.$el.disableWhileLoading(this.model.destroy({success:function(){return b.redirectWithMessage(e.t("event_deleted","%{event_title} deleted successfully",{event_title:b.model.get("title")}))}}))},j.prototype.toggleUsingSectionClass=function(){return this.$("#editCalendarEventFull").toggleClass("use_section_dates",this.model.get("use_section_dates"))},j.prototype.toggleUseSectionDates=function(){return this.model.set("use_section_dates",!this.model.get("use_section_dates"))},j.prototype.redirectWithMessage=function(a){b.flashMessage(a);if(this.model.get("return_to_url"))return window.location=this.model.get("return_to_url")},j.prototype.submit=function(a){var b,c=this;return a!=null&&a.preventDefault(),b=i(this.$el.getFormData()),b.use_section_dates=!!b.use_section_dates,d.each([b].concat(b.child_event_data),this.setStartEnd),this.$el.disableWhileLoading(this.model.save(b,{success:function(){return c.redirectWithMessage(e.t("event_saved","Event Saved Successfully"))}}))},j.prototype.setStartEnd=function(a){if(!a)return;return a.start_at=Date.parse(a.start_date+" "+a.start_time),a.end_at=Date.parse(a.start_date+" "+a.end_time)},j}(f.View)})}).call(this)