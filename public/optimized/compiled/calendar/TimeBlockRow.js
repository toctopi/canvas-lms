(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty;define(["i18n!calendar","jst/calendar/TimeBlockRow"],function(c,d){var e;return e=function(){function e(b,c){var e=this;this.TimeBlockList=b,c==null&&(c={}),this.focus=a(this.focus,this),this.remove=a(this.remove,this),this.locked=c.locked,this.$row=$(d(c)).bind({focusin:this.focus,focusout:function(){return e.$row.removeClass("focused")}}),this.inputs={},this.locked||(this.$row.find(".date_field").date_field(),this.$row.find(".time_field").time_field()),$.each(this.inputNames,function(a,b){e.inputs[b]={},e.inputs[b].$el=e.$row.find("input[name='"+b+"']").change(function(){return e.handleInputChange(b)}),e.updateModel(b);if(e.locked)return e.inputs[b].valid=!0}),this.$row.find(".delete-block-link").click(this.remove)}return e.name="TimeBlockRow",e.prototype.inputNames=["date","start_time","end_time"],e.prototype.updateModel=function(a){return this.inputs[a].val=$.trim(this.inputs[a].$el.val())},e.prototype.handleInputChange=function(a){this.updateModel(a),this.validateField(a),this.validate()},e.prototype.updateDom=function(a,b){return this.inputs[a].val=b,this.inputs[a].$el.val(b)},e.prototype.remove=function(a){return a!=null&&a.preventDefault(),this.$row.remove(),this.TimeBlockList.rowRemoved(this)},e.prototype.focus=function(){this.$row.addClass("focused");if(this.$row.is(":last-child"))return this.$row.parents(".time-block-list-body-wrapper").scrollTop(9999)},e.prototype.validateField=function(a){var b,c;return b=this.inputs[a].$el.nextAll(".datetime_suggest"),c=b.hasClass("invalid_datetime"),c||this.updateDom(a,b.text()),this.inputs[a].$el.toggleClass("error",c),this.inputs[a].valid=!c},e.prototype.validate=function(){var a,d,e,f,g,h;if(this.locked)return!0;f=!0,g=this.inputs;for(d in g){if(!b.call(g,d))continue;a=g[d],(h=a.$el.data("associated_error_box"))!=null&&h.remove(),this.validateField(d)||(f=!1)}return f&&!this.blank()&&(this.validDate()&&this.inputs.end_time.val&&this.endAt()<new Date&&(f=!1,this.inputs.end_time.$el.addClass("error").errorBox(c.t("ends_in_past_error","You cannot create an appointment slot that ends in the past"))),this.inputs.start_time.val&&this.inputs.end_time.val&&(e=this.validDate()||"Today",this.timeToDate(e,this.inputs.end_time.val)<=this.timeToDate(e,this.inputs.start_time.val)&&(f=!1,this.inputs.start_time.$el.addClass("error").errorBox(c.t("end_before_start_error","Start time must be before end time"))))),this.blank()||f},e.prototype.timeToDate=function(a,b){return Date.parse(a+" "+b)},e.prototype.endAt=function(){if(this.validDate())return this.timeToDate(this.inputs.date.val,this.inputs.end_time.val)},e.prototype.startAt=function(){if(this.validDate())return this.timeToDate(this.inputs.date.val,this.inputs.start_time.val)},e.prototype.validDate=function(){if(this.inputs.date.val&&this.inputs.date.valid)return this.inputs.date.val},e.prototype.getData=function(){return[this.startAt(),this.endAt(),!!this.locked]},e.prototype.blank=function(){return this.inputs.date.val===""&&this.inputs.start_time.val===""&&this.inputs.end_time.val===""},e}()})}).call(this)