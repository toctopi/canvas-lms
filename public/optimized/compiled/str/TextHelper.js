(function(){define(["i18n!lib.text_helper","str/htmlEscape"],function(a,b){var c,d,e;return c="LINK-PLACEHOLDER",d=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|(LINK-PLACEHOLDER)/gi,e={quoteClump:function(b){return"<div class='quoted_text_holder'>        <a href='#' class='show_quoted_text_link'>"+a.t("quoted_text_toggle","show quoted text")+"</a>        <div class='quoted_text' style='display: none;'>          "+b.join("\n")+"        </div>      </div>"},formatMessage:function(a){var f,g,h,i,j,k,l;h=[],i=[],a=a.replace(d,function(a,d){var e;return i.push(a===c?c:(e=a,e.slice(0,4)==="www"?e="http://"+e:void 0,e=encodeURI(e).replace(/'/g,"%27"),h.push(e),"<a href='"+b(e)+"'>"+b(a)+"</a>")),c}),a=b(a),a=a.replace(new RegExp(c,"g"),function(a,b){return i.shift()}),a=a.replace(/\n/g,"<br />\n"),j=[],k=[],l=a.split("\n");for(f in l)g=l[f],g.match(/^(&gt;|>)/)?k.push(g):(k.length&&j.push(e.quoteClump(k)),k=[],j.push(g));return k.length&&j.push(e.quoteClump(k)),a=j.join("\n")}}})}).call(this)