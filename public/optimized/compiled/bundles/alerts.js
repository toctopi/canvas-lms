define("translations/alerts",["i18nObj","jquery"],function(a,b){b.extend(!0,a,{translations:{es:{alerts:{errors:{criteria_required:"Al menos un activador de alarma es necesario",recipients_required:"Al menos un recipiente es necesario",threshold_should_be_numeric:"Este debería ser un número positivo"}}}}})}),define("alerts",["i18n!alerts","jquery","jquery.ajaxJSON","jquery.instructure_forms","jquery.instructure_misc_helpers","vendor/jquery.ba-tinypubsub","jqueryui/button"],function(a,b){b(function(){var c=b(".alerts_list"),d=function(a){var c=[];a.find("ul.criteria li").each(function(){c.push({id:b(this).find('input[name="alert[criteria][][id]"]').attr("value"),criterion_type:b(this).data("value"),threshold:b(this).find("span").text()})});var d=[];a.find("ul.recipients li").each(function(){d.push(b(this).data("value"))});var e=a.find('input[name="repetition"]:checked').attr("value");return e=="value"?e=a.find('input[name="alert[repetition]"]').attr("value"):e=null,{criteria:c,recipients:d,repetition:e}},e=function(a,b){return a.append(b),b},f=function(a,d,e,f){var g=b("<"+d+" />");return g.data("value",a),g.html(f[a][e]),d=="li"?(g.append(" "),g.append(c.find(">.delete_item_link").clone().toggle())):g.attr("value",a),g},g=function(a,c){return $element=f(a,c,"label",possible_alert_recipients),c=="li"&&$element.prepend(b("<input type='hidden' name='alert[recipients][]' />").attr("value",a)),$element},h=function(a,c){var d=a,e,g;return typeof a=="object"&&(d=a.criterion_type,e=a.threshold,g=a.id),$element=f(d,c,c=="li"?"label":"option",possible_alert_criteria),c=="li"&&(e||(e=possible_alert_criteria[d].default_threshold),$element.find("span").text(e),$element.find("input").attr("value",e).attr("title",possible_alert_criteria[d].title),$element.prepend(b("<input type='hidden' name='alert[criteria][][criterion_type]' />").attr("value",d)),g&&$element.prepend(b("<input type='hidden' name='alert[criteria][][id]' />").attr("value",g))),$element},i=function(a,b){var c=a.find(".criteria");c.empty();for(var d in b.criteria)c.append(h(b.criteria[d],"li"));var e=a.find(".recipients");e.empty();for(var d in b.recipients)e.append(g(b.recipients[d],"li"));b.repetition?(a.find('input[name="repetition"][value="value"]').attr("checked",!0),a.find('input[name="alert[repetition]"]').attr("value",b.repetition),a.find(".repetition_group .no_repetition").toggle(!1),a.find(".repetition_group .repetition").toggle(!0).find("span").text(b.repetition)):(a.find('input[name="repetition"][value="none"]').attr("checked",!0),a.find(".repetition_group .no_repetition").toggle(!0),a.find(".repetition_group .repetition").toggle(!1))};for(var j in alert_data){var k=alert_data[j];i(b("#edit_alert_"+k.id),k)}b(".add_alert_link").click(function(a){a.preventDefault();var d=b(".alert.blank"),e=d.clone();e.removeClass("blank"),e.addClass("new"),c.find(".alert:visible").length!=0&&b('<div class="alert_separator"></div>').insertBefore(d);var f=Math.floor(Math.random()*1e8);e.find("input").each(function(){b(this).attr("id",b.replaceTags(b(this).attr("id"),"id",f))}),e.find("label").each(function(){b(this).attr("for",b.replaceTags(b(this).attr("for"),"id",f))}),e.insertBefore(d),e.find(".edit_link").trigger("click"),e.toggle(!1),e.slideDown()}),c.delegate(".edit_link","click",function(){var a=b(this).parents(".alert"),c=d(a);a.data("data",c);var e=a.find(".add_criterion_link").prev();e.empty();var f=0;for(var i in possible_alert_criteria_order){var j=possible_alert_criteria_order[i],k=-1;for(var l in c.criteria)if(c.criteria[l].criterion_type==j){k=l;break}k==-1&&(e.append(h(j,"option")),f+=1)}f==0&&a.find(".add_criteria_line").toggle(!1);var m=a.find(".add_recipient_link").prev();m.empty(),f=0;for(var i in possible_alert_recipients_order){var n=possible_alert_recipients_order[i];b.inArray(n,c.recipients)==-1&&(m.append(g(n,"option")),f+=1)}return f==0&&a.find(".add_recipients_line").toggle(!1),a.find(".repetition_group label").toggle(!0),a.toggleClass("editing"),a.toggleClass("displaying"),!1}).delegate(".delete_link","click",function(){var a=b(this).parents(".alert");return a.hasClass("new")?a.slideUp(function(){a.remove(),c.find(".alert:first").prev(".alert_separator").remove(),c.find(".alert_separator + .alert_separator").remove(),c.find(".alert:visible:last").next(".alert_separator").remove()}):(a.find('input[name="_method"]').attr("value","DELETE"),b.ajaxJSON(a.attr("action"),"POST",a.serialize(),function(b){a.slideUp(function(){a.remove(),c.find(".alert:first").prev(".alert_separator").remove(),c.find(".alert_separator + .alert_separator").remove(),c.find(".alert:visible:last").next(".alert_separator").remove()})})),!1}).delegate(".cancel_button","click",function(){var a=b(this).parents(".alert");if(a.hasClass("new"))a.slideUp(function(){a.remove(),c.find(".alert:first").prev(".alert_separator").remove(),c.find(".alert_separator + .alert_separator").remove(),c.find(".alert:visible:last").next(".alert_separator").remove()});else{var d=a.data("data");i(a,d),a.toggleClass("editing",!1),a.toggleClass("displaying",!0)}return!1}).delegate(".alert","submit",function(){var c=b(this),d=[];c.find(".criteria li").length==0&&d.push([c.find(".add_criterion_link").prev(),a.t("errors.criteria_required","At least one trigger is required")]),c.find(".criteria input.editing").each(function(){var c=b(this).attr("value");(!c||isNaN(c)||parseFloat(c)<0)&&d.push([b(this),a.t("errors.threshold_should_be_numeric","This should be a positive number")])}),c.find(".recipients li").length==0&&d.push([c.find(".add_recipient_link").prev(),a.t("errors.recipients_required","At least one recipient is required")]);if(c.find('input[name="repetition"]:checked').attr("value")=="none")c.find('input[name="alert[repetition]"]').attr("value","");else{var e=c.find('input[name="alert[repetition]"]'),f=e.attr("value");(!f||isNaN(f)||parseFloat(f)<0)&&d.push([e,a.t("errors.threshold_should_be_numeric","This should be a positive number")])}return d.length!=0?(c.formErrors(d),!1):(b.ajaxJSON(c.attr("action"),"POST",c.serialize(),function(a,d){c.removeClass("new"),c.attr("action",d.getResponseHeader("Location"));var e=c.find('input[name="_method"]');e.length==0&&c.append(b('<input type="hidden" name="_method" value="put" />')),c.toggleClass("editing",!1),c.toggleClass("displaying",!0),i(c,a)},function(a){c.formErrors(a)}),!1)}).delegate(".recipients .delete_item_link","click",function(){var a=b(this).parents("li"),c=b(this).parents(".alert").find(".add_recipient_link");return e(c.prev(),g(a.data("value"),"option")),a.slideUp(function(){a.remove()}),c.parent().slideDown(function(){c.parent().css("display","")}),!1}).delegate(".add_recipient_link","click",function(){var a=b(this).parents(".alert").find(".recipients"),c=b(this).prev(),d=c.attr("value");e(a,g(d,"li")).toggle().slideDown();var f=c.data("associated_error_box");return f&&f.fadeOut("slow",function(){f.remove()}),c.find('option[value="'+d+'"]').remove(),c.find("*").length==0&&b(this).parent().slideUp(),!1}).delegate(".criteria .delete_item_link","click",function(){var a=b(this).parents("li"),c=b(this).parents(".alert").find(".add_criterion_link");return e(c.prev(),h(a.data("value"),"option")),a.slideUp(function(){a.remove()}),c.parent().slideDown(function(){c.parent().css("display","")}),!1}).delegate(".add_criterion_link","click",function(){var a=b(this).parents(".alert").find(".criteria"),c=b(this).prev(),d=c.attr("value");e(a,h(d,"li")).toggle().slideDown();var f=c.data("associated_error_box");return f&&f.fadeOut("slow",function(){f.remove()}),c.find('option[value="'+d+'"]').remove(),c.find("*").length==0&&b(this).parent().slideUp(),!1}).delegate('input[name="repetition"]',"click",function(){var a=b(this).parents(".alert").find('input[name="alert[repetition]"]').data("associated_error_box");a&&a.fadeOut("slow",function(){a.remove()})})})}),function(){require(["alerts"])}.call(this),define("compiled/bundles/alerts",function(){})