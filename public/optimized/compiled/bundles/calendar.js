define("translations/calendars",["i18nObj","jquery"],function(a,b){b.extend(!0,a,{translations:{es:{calendars:{assignment_details:"Detalles de la Tarea",default_title:"evento",event_details:"Detalles del Evento",feed_dialog_title:"Canal del Calendario",keycodes:{"delete":"d",edit:"e","new":"n",next_day:"ctrl + derecha",next_event:"j",next_week:"ctrl + abajo",open:"o",previous_day:"ctrl + izquierda",previous_event:"k",previous_week:"ctrl + arriba",refresh:"r"},notices:{event_moved:"%{event} fue movido a %{day}"},prompts:{delete_assignment:"¿Está seguro que quiere borrar esta tarea?",delete_event:"¿Está seguro que quiere borrar este evento?"},titles:{add_new_assignment:"Agregar Tarea Nueva",add_new_event:"Agregar Evento Nuevo",edit_assignment:"Editar la Tarea",edit_event:"Editar el Evento"}}}}})}),define("translations/content_locks",["i18nObj","jquery"],function(a,b){b.extend(!0,a,{translations:{es:{content_locks:{buttons:{ok_thanks:"Ok, Gracias"},messages:{assignment_locked_at:"Esta tarea fue bloqueada en %{at}.",assignment_locked_module:"Esta tarea es parte del módulo *%{module}* y aún no ha sido desbloqueada.",assignment_locked_no_reason:"Esta tarea esta bloqueada. No se ha provisto otra razón.",assignment_locked_until:"Esta tarea está bloqueada hasta %{date}.",content_locked_at:"Este contenido fue bloqueado en %{at}.",content_locked_module:"Este contenido es parte del módulo *%{module}* y aún no ha sido desbloqueado.",content_locked_no_reason:"Este contenido está bloqueado. No se ha provisto otra razón.",content_locked_until:"Este contenido está bloqueado hasta %{date}.",file_locked_at:"Este archivo fue bloqueado en %{at}.",file_locked_module:"Este archivo es parte del módulo *%{module}* y no ha sido desbloqueado aún.",file_locked_no_reason:"Este archivo está bloqueado. No se ha provisto otra razón.",file_locked_until:"Este archivo ha sido bloqueado hasta %{date}.",page_locked_at:"Esta página fue bloqueado en %{at}.",page_locked_module:"Esta página es parte del módulo *%{module}* y aún no ha sido desbloqueado.",page_locked_no_reason:"Esta página está bloqueada. No se ha provisto otra razón.",page_locked_until:"Esta página está bloqueada hasta %{date}.",quiz_locked_at:"Esta evaluación fue bloqueada en %{at}.",quiz_locked_module:"Esta evaluación es parte del módulo *%{module}* y aún no ha sido desbloqueado.",quiz_locked_no_reason:"Esta evaluación está bloqueada. No se ha provisto otra razón.",quiz_locked_until:"Esta evaluación está bloqueada hasta %{date}.",topic_locked_at:"Este tema fue bloqueado en %{at}.",topic_locked_module:"Este tema es parte del módulo *%{module}* y aún no ha sido desbloqueado.",topic_locked_no_reason:"Este tema está bloqueado. No se ha provisto otra razón.",topic_locked_until:"Este tema está bloqueado hasta %{date}.",visit_modules_page_for_details:"Visite la página de los módulos para información de cómo desbloquear este contenido."},titles:{content_is_locked:"El Contenido está Bloqueado"}}}}})}),define("content_locks",["INST","i18n!content_locks","jquery","str/htmlEscape","jquery.instructure_date_and_time","jqueryui/dialog"],function(a,b,c,d){a.lockExplanation=function(a,e){if(a.lock_at)switch(e){case"quiz":return b.t("messages.quiz_locked_at","This quiz was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted});case"assignment":return b.t("messages.assignment_locked_at","This assignment was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted});case"topic":return b.t("messages.topic_locked_at","This topic was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted});case"file":return b.t("messages.file_locked_at","This file was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted});case"page":return b.t("messages.page_locked_at","This page was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted});default:return b.t("messages.content_locked_at","This content was locked %{at}.",{at:c.parseFromISO(a.lock_at).datetime_formatted})}else if(a.unlock_at)switch(e){case"quiz":return b.t("messages.quiz_locked_until","This quiz is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted});case"assignment":return b.t("messages.assignment_locked_until","This assignment is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted});case"topic":return b.t("messages.topic_locked_until","This topic is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted});case"file":return b.t("messages.file_locked_until","This file is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted});case"page":return b.t("messages.page_locked_until","This page is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted});default:return b.t("messages.content_locked_until","This content is locked until %{date}.",{date:c.parseFromISO(a.unlock_at).datetime_formatted})}else if(a.context_module){var f="";switch(e){case"quiz":f+=b.t("messages.quiz_locked_module","This quiz is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"});break;case"assignment":f+=b.t("messages.assignment_locked_module","This assignment is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"});break;case"topic":f+=b.t("messages.topic_locked_module","This topic is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"});break;case"file":f+=b.t("messages.file_locked_module","This file is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"});break;case"page":f+=b.t("messages.page_locked_module","This page is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"});break;default:f+=b.t("messages.content_locked_module","This content is part of the module *%{module}* and hasn't been unlocked yet.",{module:d(a.context_module.name),wrapper:"<b>$1</b>"})}if(c("#context_modules_url").length>0)return f+="<br/>",f+="<a href='"+c("#context_modules_url").attr("href")+"'>",f+=b.t("messages.visit_modules_page_for_details","Visit the modules page for information on how to unlock this content."),f+="</a>",f}else switch(e){case"quiz":return b.t("messages.quiz_locked_no_reason","This quiz is locked.  No other reason has been provided.");case"assignment":return b.t("messages.assignment_locked_no_reason","This assignment is locked.  No other reason has been provided.");case"topic":return b.t("messages.topic_locked_no_reason","This topic is locked.  No other reason has been provided.");case"file":return b.t("messages.file_locked_no_reason","This file is locked.  No other reason has been provided.");case"page":return b.t("messages.page_locked_no_reason","This page is locked.  No other reason has been provided.");default:return b.t("messages.content_locked_no_reason","This content is locked.  No other reason has been provided.")}},c(document).ready(function(){c(".content_lock_icon").live("click",function(e){if(c(this).data("lock_reason")){e.preventDefault();var f=c(this).data("lock_reason"),g=f.type,h=c("<div/>");h.html(a.lockExplanation(f,g));var i=c("#lock_reason_dialog");if(i.length===0){i=c("<div/>").attr("id","lock_reason_dialog"),c("body").append(i.hide());var j="<div class='lock_reason_content'></div><div class='button-container'><button type='button' class='button'>"+d(b.t("buttons.ok_thanks","Ok, Thanks"))+"</button></div>";i.append(j),i.find(".button-container .button").click(function(){i.dialog("close")})}i.find(".lock_reason_content").empty().append(h),i.dialog("close").dialog({autoOpen:!1,title:b.t("titles.content_is_locked","Content Is Locked")}).dialog("open")}})})}),define("calendar_move",["i18n!calendars","jquery","jquery.instructure_date_and_time","jquery.templateData","jqueryui/datepicker"],function(a,b){function c(a){return{day:a.getDate(),month:a.getMonth(),year:a.getFullYear()}}var d=a.t("#date.month_names");return{changeMonth:function(a,e){var f=a.data("calendar_objects"),g={},h=null;if(typeof e=="string"){var h=b.datepicker.parseDate("mm/dd/yy",e);h&&h.setDate(1)}if(!h)var i=parseInt(a.find(".month_number").text(),10),j=parseInt(a.find(".year_number").text(),10),h=new Date(j,i+e-1,1);var g={month_name:d[h.getMonth()+1],month_number:h.getMonth()+1,year_number:h.getFullYear()};a.fillTemplateData({data:g});var k=new Date,l=c(k),m=c(h);k=h,k.setDate(0),k.setDate(k.getDate()-k.getDay());var n=c(k),o=null;m.day!=n.day&&(k.setDate(1),k.setMonth(k.getMonth()+1),k.setDate(0),o={day:k.getDate(),month:n.month,year:n.year},k.setDate(1),k.setMonth(k.getMonth()+1)),k.setMonth(h.getMonth()+1),k.setDate(0);var p={day:k.getDate(),month:m.month,year:m.yearh};k.setDate(k.getDate()+1),k.setDate(k.getDate()+(6-k.getDay())),k.setDate(k.getDate()+7);var q=c(k),r=a.data("days");r||(r=a.find(".calendar_day_holder"),a.data("days",r)),a.hasClass("mini_month")&&(r=a.find(".day")),a.find(".calendar_event").remove();var s=0,t=n.day,i=n.month,j=n.year;while(t<=q.day||i!=q.month){var u=r.eq(s);if(u.length>0){var v=u.attr("class").split(" "),w=[];for(var x=0;x<v.length;x++)v[x].indexOf("date_")!=0&&w.push(v[x]);u.attr("class",w.join(" "))}u.show().addClass("visible").parents("tr").show().addClass("visible");var g={day_number:t},y=i<9?"0"+(i+1):i+1,z=t<10?"0"+t:t;id="day_"+j+"_"+y+"_"+z,a.hasClass("mini_month")&&(id="mini_"+id),u.attr("id",id).find(".day_number").text(t).attr("title",y+"/"+z+"/"+j).addClass("date_"+y+"_"+z+"_"+j);var A=u.children("div");a.hasClass("mini_month")&&(A=u),A.removeClass("current_month other_month today"),i==m.month?A.addClass("current_month"):A.addClass("other_month"),i==l.month&&t==l.day&&j==l.year&&A.addClass("today"),t++,s++;if(o&&t>o.day&&i==o.month||t>p.day&&i==p.month)i+=1,i>=12&&(i-=12,j++),t=1}while(s<r.length){var u=r.eq(s);u.parents("tr").hide().removeClass("visible"),u.hide().removeClass("visible"),s++}!!a.hasClass("mini_month")}}}),define("calendar",["INST","i18n!calendars","jquery","compiled/userSettings","calendar_move","jqueryui/draggable","jquery.ajaxJSON","jquery.instructure_date_and_time","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.keycodes","jquery.rails_flash_notifications","jquery.templateData","vendor/date","vendor/jquery.scrollTo","jqueryui/datepicker","jqueryui/resizable","jqueryui/sortable","jqueryui/tabs"],function(a,b,c,d,e){function f(a,b){c(document).data("dragging",!0),c(this).parents(".calendar_day_holder").addClass("selected");if(c(this).hasClass("event_pending")||!(c(this).data("event_data")||{}).can_edit)return a.preventDefault(),a.stopPropagation(),!1;setTimeout(g,50),c(this).addClass("event_pending")}function g(){c(".calendar_month, .calendar_week, .calendar_day, .calendar_undated, .mini_calendar, .mini_calendar_week, .mini_calendar_day").each(function(){if(c(this).data("drag_position"))return;var a=c(this),b=a.offset(),d=a.outerWidth(),e=a.outerHeight();c(this).hasClass(".calendar_week")&&(e=a.find(".calendar_day:first").outerHeight()),c(this).data("drag_position",{offset:b,width:d,height:e})})}function h(a,b){a=a.originalEvent;var d=a.pageX,e=a.pageY,f=null,g=null,h=null;if(!c(".calendar_day_undated").data("drag_position"))return;if(B){var i=B.data("drag_position");if(d>=i.offset.left&&d<=i.offset.left+i.width&&e>=i.offset.top&&e<=i.offset.top+i.height)return B}return c(".calendar_day_undated").each(function(){var a=c(this).data("drag_position");if(d>=a.offset.left&&d<=a.offset.left+a.width&&e>=a.offset.top&&e<=a.offset.top+a.height)return h=c(this),!1}),h?h:(c(".calendar_month,.mini_calendar").each(function(){var a=c(this).data("drag_position");if(d>=a.offset.left&&d<=a.offset.left+a.width&&e>=a.offset.top&&e<=a.offset.top+a.height)return f=c(this),!1}),f&&(f.find(".calendar_week,.mini_calendar_week").each(function(){var a=c(this).data("drag_position");if(d>=a.offset.left&&d<=a.offset.left+a.width&&e>=a.offset.top&&e<=a.offset.top+a.height)return g=c(this),!1}),g&&g.find(".calendar_day,.mini_calendar_day").each(function(){var a=c(this).data("drag_position");if(d>=a.offset.left&&d<=a.offset.left+a.width&&e>=a.offset.top&&e<=a.offset.top+a.height)return h=c(this),!1})),B=h,h)}function i(a,d){c(document).data("dragging",!1),c("td.selected").removeClass("selected"),c(".drop_target").removeClass("drop_target");var e=h(a,d),f=c(this);if(e&&e[0]!=f.parents(".calendar_day")[0]){var g=c.extend({},f.getTemplateData({textValues:["start_date_string","start_time_string","end_time_string","event_type","id","context_id","context_type","all_day"]}),f.data("event_data")),i=g.context_type.toLowerCase()+"_"+g.context_id,k,l,n=g.event_type;g.all_day=="true"&&(g.start_time_string="",g.end_time_string="");if(e.hasClass("calendar_day_undated"))k=null,l=null;else{var o=f.parents(".calendar_day").find(".day_number").attr("title"),p=e.find(".day_number").attr("title");k=c.parseDateTime(p,g.start_time_string),l=c.parseDateTime(p,g.end_time_string)}var r=c("#context_urls ."+i+"_event_url").attr("href");n=="assignment"?(g=c.extend(g,c.formatDateTime(k,{object_name:"assignment",property_name:"due_at"})),r=c("#context_urls ."+i+"_assignment_url").attr("href")):(g=c.extend(g,c.formatDateTime(k,{object_name:"calendar_event",property_name:"start_at"})),g=c.extend(g,c.formatDateTime(l,{object_name:"calendar_event",property_name:"end_at"}))),r=c.replaceTags(r,"id",g.id);var s=null;if(e.hasClass("mini_calendar_day")){s=e.find(".day_number").attr("title")||"";var t=Date.parse(s);t&&(e=c("#day_"+t.toString("yyyy_MM_dd")).find(".calendar_day"))}j(f,e.parent()),c.ajaxJSON(r,"PUT",g,function(a){f.removeClass("event_pending"),q(a),m(a),!e.length&&s&&c.flashMessage(b.t("notices.event_moved","%{event} was moved to %{day}",{event:f.find(".title").text()||b.t("default_title","event"),day:s}))})}else c(this).removeClass("event_pending")}function j(a,b,d){return $before=null,b.length===0&&a.remove(),d||b.find(".calendar_event").each(function(){var b=(c(this).data("event_data")||{}).time_sortable||"",d=(a.data("event_data")||{}).time_sortable||"";if(b>d)return $before=c(this),!1;if(b==d&&c(this).find(".title").text()>a.find(".title").text())return $before=c(this),!1}),$before&&!d?$before.before(a.show()):b.children("div.calendar_day").append(a.show()),a}function k(a,b){e.changeMonth(a,b),a.hasClass("mini_month")||setTimeout(l,500)}function l(){$month=c(".calendar_container .calendar_month"),p($month,!0)}function m(a){var b=a.calendar_event||a.assignment,c=b.id;for(var d in D)calendar.appendToCache(d,[a])}function n(a){var b=a.attr("id").split("_").pop(),c=a.hasClass("assignment")?"assignment":"calendar_event";calendar.removeFromCache({asset_string:c+"_"+b})}function o(a,b){var c=0,d=[],e=function(f){if(a.length>0){var g=a.shift();c++;if(g){var h=q(g,null,b);d.push("#event_"+h)}c>50?(c=0,setTimeout(function(){e(f)},500)):e(f)}else if(f)var i=d.join(",")};setTimeout(function(){e(!0)},10)}function p(a,b,d,e){var f,g,h=!0;if(typeof a=="string"){var i=a.split("/");f=i[0],g=i[1],a=c(".calendar_month:first"),h=!1}else a.monthLoading(),f=parseInt(a.find(".month_number").text(),10),g=parseInt(a.find(".year_number").text(),10);var j="/calendar?"+c.param({month:f,year:g}),k=j+(e==0?"":"&include_undated=1"),l=[];D[j]||(D[j]=[]),D[j].contexts_last_update_at=D[j].contexts_last_update_at||{},D[j].contexts_loading=D[j].contexts_loading||{};var m=null,n=!0;c(".calendar_links .group_reference_checkbox:checked").each(function(){var a=c(this).attr("id").substring(6);D[j].contexts_last_update_at[a]||(n=!1);if(m!=""&&D[j].contexts_last_update_at[a]){if(!m||D[j].contexts_last_update_at[a]<m)m=D[j].contexts_last_update_at[a]}else m="";D[j].contexts_loading[a]||(!b||!D[j].contexts_last_update_at[a])&&l.push(a)}),k=k+"&last_update_at="+(m||"");var p={};h&&a.find(".calendar_event").each(function(){c(this).attr("id")&&(p[c(this).attr("id")]=!0)}),delete p.event_blank,delete p.event_new,delete p.event_id;if(b&&n&&D[j]&&(D[j].dont_retry||D[j].length>0)){var q=c.merge([],D[j]);h&&(o(q),a.monthLoading("remove"))}else{h&&a.monthLoading("remove");var r={};d&&(r.timeout=2e3);var s=[],t=[];for(var u in l)t.push(l[u]),t.length>=5&&(s.push(t),t=[]);t.length>0&&s.push(t);for(var u in s)h&&a.monthLoading(),function(b,d,e){for(var f in b)D[d].contexts_loading[b[f]]=!0;var g=e+"&only_contexts="+b.join(",");c.ajaxJSON(g,"GET",{},function(e){calendar.appendToCache(d,e),c.each(e,function(a,b){var c=(b.calendar_event||b.assignment).context_code,e=(b.calendar_event||b.assignment).updated_at;if(!calendar.lastUpdate[d]||e>calendar.lastUpdate[d])calendar.lastUpdate[d]=e;if(!D[d].contexts_last_update_at[c]||e>D[d].contexts_last_update_at[c])D[d].contexts_last_update_at[c]=e});var f=(new Date).toString("u");for(var g in b)D[d].contexts_last_update_at[b[g]]=D[d].contexts_last_update_at[b[g]]||f,D[d].contexts_loading[b[g]]=!1;h&&(o(e,!0),a.monthLoading("remove"))},function(c){D[d]&&D[d].dont_retry&&(D[d].dont_retry=!1);for(var e in b)D[d].contexts_loading[b[e]]=!1;h&&a.monthLoading("remove")})}(s[u],j,k)}}function q(a,b,d){var e=c.extend({},a.assignment),f=null,g=null;if(a.calendar_event){e=c.extend({},a.calendar_event);var h=c.parseFromISO(e.start_at),i=c.parseFromISO(e.end_at);e.start_time_string=h.time_string,e.end_time_string=i.time_string,e.start_time_formatted=h.time_formatted,e.start_date_string=h.date_formatted,e.end_time_formatted=i.time_formatted,e.time_sortable=h.time_sortable,e.event_type="calendar_event",f="calendar_event_"+e.id,q.details_urls=q.details_urls||{},key="calendar_event_"+e.context_type+e.context_id;if(!q.details_urls[key]){var k=E;k=c.replaceTags(k,"context_id",e.context_id),k=c.replaceTags(k,"context_type",e.context_type.toLowerCase()),q.details_urls[key]=k}g=q.details_urls[key]}else{var l=c.parseFromISO(e.due_at,"due_date");e.start_time_string=l.time_string,e.end_time_string=l.time_string,e.start_time_formatted=l.time_formatted,e.start_date_string=l.date_formatted,e.end_time_formatted=l.time_formatted,e.time_sortable=l.time_sortable,e.start_at=e.due_at,e.event_type="assignment",f="assignment_"+e.id,q.details_urls=q.details_urls||{},key="assignment_"+e.context_type+e.context_id;if(!q.details_urls[key]){var k=F;k=c.replaceTags(k,"context_id",e.context_id),k=c.replaceTags(k,"context_type",e.context_type.toLowerCase()),q.details_urls[key]=k}g=q.details_urls[key],g=c.replaceTags(g,"id",e.id),g=c.replaceTags(g,"context_id",e.context_id),g=c.replaceTags(g,"context_type",e.context_type.toLowerCase())}b&&b.attr("id")=="event_new"&&b.attr("id","event_"+f);if(!e.start_at&&!b&&!calendar.showingUndatedEvents){calendar.hiddenUndatedEvents=calendar.hiddenUndatedEvents||[],calendar.hiddenUndatedEvents.push(a),H.text(calendar.hiddenUndatedEvents.length);return}if(!b||b.attr("id")!="event_new"&&b.attr("id")!="event_"+f){b=c("#event_"+f+":visible");if(b.length>0&&b.find(".updated_at").text()==e.updated_at)return}b=c("#event_"+f);var m=c.parseFromISO(e.all_day_date);m.date_timestamp&&!1?(e.start_at=e.all_day_date.substring(0,10),e.all_day_date=m.date_formatted):e.all_day_date="",e.all_day&&(e.start_at=e.all_day_date.substring(0,10),m.date_timestamp&&(e.all_day_date=m.date_formatted,e.start_at=m.date_sortable.substring(0,10)),e.start_time_formatted="",e.end_time_formatted="");var n=managementContexts&&c.inArray(e.context_code,managementContexts)!=-1;if(e.permissions||n)e.can_edit=n||e.permissions&&e.permissions.update,e.can_delete=n||e.permissions&&e.permissions["delete"];if(e.workflow_state=="deleted")return b.remove(),f;!b||b.length===0?(b=G.clone(!0),g=c.replaceTags(g,"id",e.id),b.find(".title").attr("href",g),b.toggleClass("assignment",!!a.assignment),d!==!0&&b.draggable(C)):b.find(".title").attr("href")==="#"&&(g=c.replaceTags(g,"id",e.id),b.find(".title").attr("href",g)),b.fillTemplateData({data:{title:e.title},hrefValues:["id"],id:"event_"+f}),b.data("event_data",e),b.toggleClass("draggable",e.can_edit),b.data("description",e.description);var o=b.attr("class")||"",p="group_"+e.context_type.toLowerCase()+"_"+e.context_id;b.addClass(p),b.addClass("event_"+f);var r=c(".calendar_undated");e.start_at!=null&&(r=c("#day_"+e.start_at.substring(0,10).replace(/-/g,"_"))),b.hasClass("event_pending")||j(b,r,d);var s=e.start_time_formatted||"";return e.start_time_string&&e.start_time_string!=e.end_time_string&&(s+=" to "+(e.end_time_formatted||"")),event_title=e.title,event_title+=s?" - "+s:"",a.assignment&&s&&(event_title="due: "+event_title),b.find(".calendar_event_text").attr("title",event_title).show(),c("#"+p).length>0&&b.showIf(c("#"+p).attr("checked")),f}function r(a){c(".calendar_month").each(function(){p(c(this),a||!1,!0,null)})}function s(d,e){var f=c("#event_details"),g=c.extend({},d.getTemplateData({textValues:["id","start_time_string","end_time_string","start_date_string","title","event_type","can_edit","can_delete","context_id","context_type","all_day"],htmlValues:["description"]}),d.data("event_data"));g.description=d.data("description"),g.start_time=g.start_time_string,g.end_time=g.end_time_string;var h={},i="",j="";e.find(".day_number").length&&(i=e.find(".day_number").attr("title").split("/").pop(),j=g.start_date_string,j.match(new RegExp(i))||(j=j+" "+i)),g.all_day=="true"?(h=Date.parse(j),g.time_string=c.dateString(h)):g.start_time_string?(h=Date.parse(j),g.time_string=c.dateString(h)):(g.time_string="No Date Set",g.date=""),f.data("current_event",d).data("current_day",e);var k=null;f.find(".title").attr("href",d.find(".title").attr("href")),f.find(".view_event_link").attr("href",d.find(".title").attr("href")),f.find(".delete_event_link").attr("href",d.find(".delete_"+g.event_type+"_link").attr("href")),f.find(".edit_event").showIf(g.can_edit&&!g.frozen),f.find(".delete_event").showIf(g.can_delete&&!g.frozen);var l=d.attr("id")=="event_blank",m="Event",n=null;l?c("#edit_event").addClass("new_event"):c("#edit_event").removeClass("new_event"),g.event_type=="assignment"&&(m="Assignment");if(g.event_type=="assignment"||g.start_time==g.end_time){if(g.all_day=="true"&&g.event_type=="assignment")g.time_string=g.start_date_string+" at "+g.start_time_string;else if(g.start_time){var j=c.dateString(h);g.time_string=j+" at "+g.start_time_string}g.event_type=="assignment"&&g.time_string&&(g.time_string="due: "+g.time_string)}g.description=d.data("description"),f.fillTemplateData({data:g,htmlValues:["description"]}),g.lock_info&&f.find(".lock_explanation").html(a.lockExplanation(g.lock_info,"assignment")),c("#edit_event").dialog("close"),c("#event_details").dialog("close"),c("#event_details").find(".description").css("max-height",Math.max(c(window).height()-200,150));var o=m=="Event"?b.t("event_details","Event Details"):b.t("assignment_details","Assignment Details");c("#event_details").show().dialog({title:o,width:g.description.length>2e3?Math.max(c(window).width()-300,450):450,resizable:!0,close:function(){c(document).click(),u()},open:function(){c(document).triggerHandler("event_dialog",c(this))},autoOpen:!1}).dialog("open").dialog("option","title",o),d.addClass("selected"),t(e.parents(".calendar_day_holder"))}function t(a){c(".calendar_container").data("prevent_hover",!0),c(".calendar_day_holder.selected").removeClass("selected"),c(".mini_calendar .day.related").removeClass("related"),a.addClass("selected");var b=a.find(".day_number").attr("title");if(b){var d=c(".mini_calendar .day.date_"+b.replace(/\//g,"_"));d.addClass("related")}}function u(){c(".calendar_container").data("prevent_hover",!1),c(".calendar_day_holder.selected").removeClass("selected"),c(".mini_calendar .day.related").removeClass("related")}function v(a,b,d){if(a.attr("id")=="edit_assignment_form")if(a.hasClass("new_event")){a.attr("method","POST");var e=c("#context_urls ."+b+"_add_assignment_url").attr("href")||"";a.find(".more_options_link").attr("href",c("."+b+"_add_assignment_url").attr("href")+"/new"),a.attr("action",e)}else{a.attr("method","PUT");var e=c("#context_urls ."+b+"_assignment_url").attr("href")||"";e=c.replaceTags(e,"id",d),a.find(".more_options_link").attr("href",e+"/edit"),a.attr("action",e)}else if(a.hasClass("new_event")){a.attr("method","POST");var e=c("#context_urls ."+b+"_add_event_url").attr("href")||"";a.find(".more_options_link").attr("href",c("."+b+"_add_event_url").attr("href")+"/new"),a.attr("action",e)}else{a.attr("method","PUT");var e=c("#context_urls ."+b+"_event_url").attr("href")||"";e=c.replaceTags(e,"id",d),a.find(".more_options_link").attr("href",e+"/edit"),a.attr("action",e)}}function w(a,d){var e=c("#edit_event");c("#edit_event_tabs").show();var f=c.extend({},a.data("event_data"),a.getTemplateData({textValues:["title"]}));f.description=a.data("description"),f.context_type=f.context_type||"",f.id=f.id||"";var g=f.context_type.toLowerCase()+"_"+f.context_id;if(!f.context_type||a.attr("id")=="event_blank")g=c("#edit_event select.context_id").val();f.start_time=f.start_time_string||"",f.end_time=f.end_time_string||"",f.date=d.find(".day_number").attr("title"),f.all_day=="true"&&(f.start_time="",f.end_time="",f.date=f.all_day_date),f.due_at="";var h=Date.parse(f.date+" "+f.start_time)||Date.parse(f.date),i=Date.parse(f.date+" "+f.end_time)||Date.parse(f.date);h?(f.date=h.toString("MMM d, yyyy"),f.due_at=c.datetime.clean(h),f.start_time_string&&(f.start_time=h.toString("h:mmtt").toLowerCase()),f.end_time_string&&(f.end_time=i.toString("h:mmtt").toLowerCase())):f.date="";var j=a.attr("id")=="event_blank",k="Event",l=null;c("#edit_event,#edit_assignment_form,#edit_calendar_event_form").toggleClass("new_event",j),j&&f.event_type=="calendar_event";var m=0,n=e.find("#edit_assignment_form").show();n.find("select.context_id").val(g),v(n,g,f.id);var o=e.find("#edit_calendar_event_form").show();o.find("select.context_id").val(g),v(o,g,f.id),f.event_type=="assignment"?(l=n,k="Assignment"):l=o,c("#edit_assignment_form,#edit_calendar_event_form").data("event_id",f.id).data("context",g),c("#event_details").data("current_event",a),c("#edit_assignment_form").data("current_event",a),c("#edit_calendar_event_form").data("current_event",a),c("#edit_assignment_form").fillFormData(f,{object_name:"assignment"}),c("#edit_calendar_event_form").fillFormData(f,{object_name:"calendar_event"}),c("#event_details").dialog("close"),c("#edit_event").dialog("close"),t(d.parents(".calendar_day_holder"));var p;j?p=k=="Event"?b.t("titles.add_new_event","Add New Event"):b.t("titles.add_new_assignment","Add New Assignment"):p=k=="Event"?b.t("titles.edit_event","Edit Event"):b.t("titles.edit_assignment","Edit Assignment"),c("#edit_event").show().dialog({title:p,width:400,open:function(){c(document).triggerHandler("edit_event_dialog",e);var a=e.find("#edit_event_tabs"),b=c("#event_details").data("current_event"),d=c.extend({},b.data("event_data")),f=b.attr("id")=="event_blank",h=c.map(c(".group_reference_checkbox:checked"),function(a,b){return c(a).attr("id").replace("group_","")});c("#edit_event .context_select").each(function(){var a=c(this).find("select.context_id"),b=window.thisElementFiredTheEvent&&(c(window.thisElementFiredTheEvent).closest(".group_reference").find(".group_reference_checkbox").attr("id")||"").replace("group_",""),d=a.find("option").attr("disabled",function(){return h.length&&c.inArray(c(this).val(),h)===-1});h.length&&a.val(b||h[0]),c(this).showIf(f),a.val(g),a.triggerHandler("change",!1)}),a.tabs("enable",0),a.tabs("enable",1);var i=0;d.event_type=="assignment"?(i=1,a.tabs("select",1),f?a.find(".ui-tabs-nav").show():(a.find(".ui-tabs-nav").hide(),a.tabs("disable",0))):(a.tabs("select",0),f?a.find(".ui-tabs-nav").show():(a.find(".ui-tabs-nav").hide(),a.tabs("disable",1)),c("#edit_assignment_form select.context_id option").filter(function(){return!c(this).attr("disabled")}).length===0&&(a.tabs("disable",1),i=0)),f&&(i=0),a.tabs("select",i),i==0?c("#edit_calendar_event_form :text:first").focus().select():c("#edit_assignment_form :text:first").focus().select(),a.find(".ui-tabs-panel:eq("+a.tabs("option","selected")+") select.context_id").triggerHandler("change"),c("#edit_assignment_form").find(".assignment_group_id").val(d.assignment_group_id)},drag:function(){l.hideErrors()},autoSize:!0,close:function(){u();var a=c("#edit_event .assignment_group_id");if(a.length>0){var b=c("#"+a.attr("id").substring(5));b.empty().append(a.children().clone())}var d=c("#edit_event_tabs").data("selected.tabs");if(c("#edit_event").hasClass("new_event")){var e={};d==1?(e=c("#edit_assignment_form").getFormData({object_name:"assignment"}),e.event_type="assignment",e.start_time_string=e.start_time,e.end_time_string=e.start_time):(e=c("#edit_calendar_event_form").getFormData({object_name:"calendar_event"}),e.event_type="calendar_event",e.start_time_string=e.start_time,e.end_time_string=e.end_time),c("#event_blank").fillTemplateData({data:e})}l.find("input[name='date']").datepicker("hide")},autoOpen:!1,resizable:!1,modal:!0}).dialog("open").dialog("option","title",p);if(f.context_id&&f.context_type){var q=e.find("#edit_event_tabs"),r=(""+f.context_type+"_"+f.context_id).toLowerCase();q.data("group_class")&&q.removeClass(q.data("group_class")),q.addClass("group_"+r).data("group_class","group_"+r)}}function x(a){var b=c(".calendar_container .calendar_day_holder.selected:first");if(!b||b.length===0){y(a);return}var d=b.find(".calendar_event"),e=d.filter(".selected:first");if(d.length===0){a=="down"?a="right":a=="up"&&(a="left"),y(a);return}if(!e||e.length===0){c(".calendar_event.selected").removeClass("selected"),a=="up"?e=b.find(".calendar_event:last"):e=b.find(".calendar_event:first"),e.find("a.title").focus(),e.addClass("selected"),c("html,body").scrollTo(e);return}if(a=="up")var f=e.prev(".calendar_event");else var f=e.next(".calendar_event");f&&f.length>0?(c(".calendar_event.selected").removeClass("selected"),f.find("a.title").focus(),f.addClass("selected"),c("html,body").scrollTo(f)):(a=="down"?a="right":a=="up"&&(a="left"),y(a))}function y(a){var b=c(".calendar_container .calendar_day_holder.selected:first");if(!b||b.length===0){c(".calendar_container .calendar_day_holder.selected").removeClass("selected"),c(".calendar_container .calendar_event.selected").removeClass("selected"),b=c(".calendar_container .calendar_day_holder .current_month").eq(0).parent(),b.addClass("selected"),c("html,body").scrollTo(b);return}var d=b.parents(".calendar_month"),e=null,f=b.attr("id").split("_"),g=new Date(f[1],f[2]-1,f[3]);if(a=="right")e=b.next().find(".current_month").parent(),e.length===0&&(e=b.parent().next(".visible").find(".calendar_day_holder .current_month").eq(0).parent()),e.length===0&&(g.setDate(g.getDate()+1),k(d,1),e=c("#day_"+c.datepicker.formatDate("yy_mm_dd",g)));else if(a=="left")e=b.prev().find(".current_month").parent(),e.length===0&&(e=b.parent().prev(".visible").find(".calendar_day_holder .current_month").filter(":last").parent()),e.length===0&&(g.setDate(g.getDate()-1),k(d,-1),e=c("#day_"+c.datepicker.formatDate("yy_mm_dd",g)));else if(a=="up"){var h=b.parent().children(".calendar_day_holder").index(b);e=b.parent().prev(".visible").children(".calendar_day_holder").eq(h).find(".current_month").parent(),e.length===0&&(g.setDate(g.getDate()-7),k(d,-1),e=c("#day_"+c.datepicker.formatDate("yy_mm_dd",g)))}else if(a=="down"){var h=b.parent().children(".calendar_day_holder").index(b);e=b.parent().next(".visible").children(".calendar_day_holder").eq(h).find(".current_month").parent(),e.length===0&&(g.setDate(g.getDate()+7),k(d,1),e=c("#day_"+c.datepicker.formatDate("yy_mm_dd",g)))}e&&e.length>0&&(e.focus(),c(".calendar_container .calendar_day_holder.selected").removeClass("selected"),c(".calendar_container .calendar_day.hover").removeClass("hover"),c(".calendar_container .calendar_event.selected").removeClass("selected"),e.addClass("selected"),e.find(".calendar_day").addClass("hover"),c("html,body").scrollTo(e))}function z(){c(".calendar_month").each(function(){c(this).data("days",c(this).find(".calendar_day_holder"))})}function A(a){var d=c("#event_details"),e=c.extend({},a.data("event_data")),f=e.context_type.toLowerCase()+"_"+e.context_id,g=b.t("prompts.delete_event","Are you sure you want to delete this event?");e.event_type=="assignment"&&(g=b.t("prompts.delete_assignment","Are you sure you want to delete this assignment?"));var h=c("."+f+"_event_url").attr("href");e.event_type=="assignment"&&(h=c("."+f+"_assignment_url").attr("href")),h=c.replaceTags(h,"id",e.id),a.confirmDelete({url:h,message:g,confirmed:function(){d.dialog("close"),c(this).dim()},success:function(){c(document).triggerHandler("delete_event"),c(this).fadeOut(function(){c(this).remove(),n(a)})}})}window.calendar={viewItem:function(a,b,c){},showingUndatedEvents:!1,appendToCache:function(a,b){var d={};D[a]=D[a]||[],c.each(b,function(a,b){var c=null;b.calendar_event?c="calendar_event_"+b.calendar_event.id:c="assignment_"+b.assignment.id,d[c]=b}),c.each(D[a],function(b,c){var e=null;c.calendar_event?e="calendar_event_"+c.calendar_event.id:e="assignment_"+c.assignment.id,d[e]&&(D[a][b]=d[e],d[e]=null)}),c.each(d,function(b,c){c&&D[a].push(c)})},removeFromCache:function(a){for(var b in D){var d=c.merge([],D[b]),e=[],f=!1;for(var g=0;g<d.length;g++){var h=d[g].assignment?"assignment":"calendar_event",i=d[g][h],j=h+"_"+i.id;a.asset_string&&a.asset_string==j?f=!0:e.push(d[g])}f&&(D[b]=e)}},lastUpdate:{}};var B=null,C={helper:function(){var a=c(this).outerWidth(),b=c(this).clone();return b.width(a).css("zIndex",20),c(this).parents(".calendar_container").append(b),b},scroll:!0,drag:function(a,b){if(c.browser.msie)return;var d=h(a,b);if(d&&d.hasClass("drop_target"))return;c(".drop_target").removeClass("drop_target"),d&&d.closest(".calendar_day_holder,.mini_calendar_day").addClass("drop_target")},start:f,stop:i},D={};c.fn.monthLoading=function(a){return c.fn.monthLoading.cnt=Math.max(c.fn.monthLoading.cnt||0,0),a?c.fn.monthLoading.cnt--:c.fn.monthLoading.cnt++,this.find(".refresh_calendar_link").find(".static").showIf(c.fn.monthLoading.cnt<=0).end().find(".animated").showIf(c.fn.monthLoading.cnt>0),this};var E=c("#event_details").find(".calendar_event_url").attr("href"),F=c("#event_details").find(".assignment_url").attr("href"),G=c("#event_blank"),H=c(".show_undated_link .undated_count");c(document).ready(function(){c(".calendar_day.today").removeClass("today"),c("#day_"+(new Date).toString("yyyy_MM_dd")).children(".calendar_day").addClass("today"),c(".show_undated_link").click(function(a){a.preventDefault(),calendar.showingUndatedEvents=!0,c(".undated_link").hide(),events=(calendar.hiddenUndatedEvents||[]).sort(function(a,b){var c=(a.calendar_event||a.assignment||{}).title||"",d=(b.calendar_event||b.assignment||{}).title||"";return c<d?0:d>c?1:0}),o(events||[],!0),c(".undated_content").show()}),c("#edit_calendar_event_form .more_options_link").click(function(a){a.preventDefault();var b=c(this).attr("href").split("#"),d=c("#edit_calendar_event_form").getFormData({object_name:"calendar_event"}),e={};d.title&&(e.title=d.title),d.date&&(e.start_at=d.date+" "+(d.start_time||""),e.end_at=d.date+" "+(d.end_time||"")),e.return_to=location.href,b[0]+="?"+c.param(e),location.href=b.join("#")}),c(".calendar_event").live("mouseover",function(){!c(this).hasClass("ui-draggable")&&c(this).hasClass("draggable")&&c(this).draggable(C)}),c("#edit_assignment_form .more_options_link").click(function(a){a.preventDefault();var b=c(this).attr("href").split("#"),d=c("#edit_assignment_form").getFormData({object_name:"assignment"}),e={};d.title&&(e.title=d.title),d.due_at&&(e.due_at=d.due_at),d.assignment_group_id&&(e.assignment_group_id=d.assignment_group_id),e.return_to=location.href,b[0]+="?"+c.param(e),location.href=b.join("#")}),c(".calendar_feed_link").click(function(a){a.preventDefault(),c("#calendar_feed_box").find(".calendar_feed_url").val(c(this).attr("href")).end().find(".show_calendar_feed_link").attr("href",c(this).attr("href")),c("#calendar_feed_box").dialog("close").dialog({title:b.t("feed_dialog_title","Calendar Feed"),width:375,autoOpen:!1}).dialog("open")}),c("#calendar_feed_box .calendar_feed_url").focus(function(){c(this).select()}),c(".calendar_day_holder").focus(function(a){c(".calendar_container .calendar_day.hover").removeClass("hover"),c(".calendar_container .calendar_event.selected").removeClass("selected"),c(this).find(".calendar_day").addClass("hover")}),c(".calendar_event a").focus(function(a){c(".calendar_container .calendar_day.hover").removeClass("hover"),c(".calendar_container .calendar_event.selected").removeClass("selected"),c(this).parents(".calendar_event").addClass("selected"),c(this).parents(".calendar_day").addClass("hover")}),c("#edit_event select.context_id").change(function(a,b){var d=c(this).val(),e=c("#"+d+"_assignment_groups").clone(!0).attr("id","temp_"+d+"_assignment_groups");attachAddAssignmentGroup(e,c("#context_urls ."+d+"_add_assignment_group_url").attr("href")),c(this).parents("form").find(".assignment_group_select").empty().append(e);var f=c(this).parents("form"),g=f.data("event_id"),h="";v(f,d,g),b!==!1&&c(this).parents("#edit_event").find("select.context_id").not(c(this)).val(c(this).val()).triggerHandler("change",!1);var i=c(this).closest("#edit_event");i.data("group_class")&&i.removeClass(i.data("group_class")),i.addClass("group_"+d).data("group_class","group_"+d)}),c("#edit_assignment_form .datetime_field, #edit_calendar_event_form .datetime_field").datetime_field(),c("#edit_calendar_event_form .time_field").time_field().blur(function(a){var b=c("#edit_calendar_event_form .time_field.start_time").next(".datetime_suggest").text();c("#edit_calendar_event_form .time_field.start_time").next(".datetime_suggest").hasClass("invalid_datetime")&&(b=null),b=b||c("#edit_calendar_event_form .time_field.start_time").val();var d=c("#edit_calendar_event_form .time_field.end_time").next(".datetime_suggest").text();c("#edit_calendar_event_form .time_field.end_time").next(".datetime_suggest").hasClass("invalid_datetime")&&(d=null),d=d||c("#edit_calendar_event_form .time_field.end_time").val();var e=Date.parse(b),f=Date.parse(d);e=e||f,f=f||e,c(this).hasClass("end_time")?e>f&&(e=f):f<e&&(f=e),e&&c("#edit_calendar_event_form .time_field.start_time").val(e.toString("h:mmtt").toLowerCase()),f&&c("#edit_calendar_event_form .time_field.end_time").val(f.toString("h:mmtt").toLowerCase())}),c("#edit_calendar_event_form .date_field").date_field(),c("#edit_event_form input[name='date']").datepicker(),c(".calendar_month").delegate(".next_month_link","click",function(a){a.preventDefault();var b=c(".calendar_month .month_name").text()+" "+c(".calendar_month .year_number").text(),d=Date.parse(b)||new Date;d.setMonth(d.getMonth()+1);var e={};try{e=c.parseJSON(c.decodeFromHex(location.hash.substring(1)))||{}}catch(f){e={}}e.month=d.getMonth()+1,e.year=d.getFullYear(),location.replace("#"+c.encodeToHex(JSON.stringify(e)))}).delegate(".prev_month_link","click",function(a){a.preventDefault();var b=c(".calendar_month .month_name").text()+" "+c(".calendar_month .year_number").text(),d=Date.parse(b)||new Date;d.setMonth(d.getMonth()-1);var e={};try{e=c.parseJSON(c.decodeFromHex(location.hash.substring(1)))||{}}catch(f){e={}}e.month=d.getMonth()+1,e.year=d.getFullYear(),location.replace("#"+c.encodeToHex(JSON.stringify(e)))});var a=parseInt(c("#max_calendar_count").text(),10)||10,e=function(){e.log=!0};setInterval(function(){if(e.log){e.log=!1;var a=[];c(".calendar_links .group_reference_checkbox:checked").each(function(){var b=c(this).attr("id").substring(6);a.push(b)}),d.set("checked_calendar_codes",a)}},1e3),c(".group_reference_checkbox").bind("change click",function(){var b=this;setTimeout(function(){c("."+c(b).attr("id")+":not(.group_reference)").showIf(c(b).attr("checked")),c(".calendar_links .group_reference_checkbox:checked").length>a&&c(".calendar_links .group_reference_checkbox:checked").not(b).filter(":first").attr("checked",!1).change(),c(b).attr("checked")&&r(!0),e(),c(".calendars_open_count").text(c(".calendar_links .group_reference_checkbox:checked").length)},10)}).filter(":last").change(),c(".calendar_container").delegate(".calendar_day","mouseover",function(a){var b=c(a.liveFired||c(this).parents(".calendar_container"));if(b.data("prevent_hover"))return;c(".calendar_day.hover").removeClass("hover"),c(this).addClass("hover");var d=c(this).find(".day_number").attr("title");if(d&&!c(document).data("dragging")){var e=c(".mini_calendar .day.date_"+d.replace(/\//g,"_"));e.addClass("related")}}).delegate(".calendar_day","mouseout",function(a){var b=c(a.liveFired||c(this).parents(".calendar_container"));if(b.data("prevent_hover"))return;c(this).removeClass("hover");var d=c(this).find(".day_number").attr("title");if(d){var e=c(".mini_calendar .day.date_"+d.replace(/\//g,"_"));e.removeClass("related")}}),c(".mini_month").delegate(".next_month_link","mousedown",function(a){a.preventDefault(),k(c(a.liveFired||c(this).parents(".mini_month")),1)}).delegate(".prev_month_link","mousedown",function(a){a.preventDefault(),k(c(a.liveFired||c(this).parents(".mini_month")),-1)}).delegate(".next_month_link,.prev_month_link","click",function(a){a.preventDefault()}).delegate(".day_number","click",function(a){a.preventDefault();var b=c(this).attr("title");k(c(a.liveFired||c(this).parents(".mini_month")),b),k(c(".calendar_container .calendar_month"),b)}),c(document).click(function(a){var b=c(this);c(".calendar_container .calendar_event.selected").each(function(a){c(this).parent()[0]!=b[0]&&c(this).removeClass("selected")}),c(".calendar_container .calendar_day_holder.selected").each(function(a){c(this)[0]!=b.parent()[0]&&c(this).removeClass("selected")})}),c(".calendar_event").live("click",function(a){a.preventDefault(),a.stopPropagation(),c(".calendar_day_holder.selected,.calendar_event.selected").removeClass("selected"),s(c(this),c(this).parents(".calendar_day"))}),c(".calendar_container").delegate(".calendar_day","click",function(a){if(c(a.target).closest(".calendar_event").length>0)return;a.preventDefault(),a.stopPropagation();if(canCreateEvent){w(c("#event_blank"),c(this));var b=(c(".group_reference_checkbox:checked:first").attr("id")||"").replace(/^group_/,"");b||(b=(c(".group_reference.default_context").find(".group_reference_checkbox").attr("id")||"").replace(/^group_/,"")),b&&c("#edit_event .context_select select.context_id").each(function(){c(this).val(b),this.selectedIndex<0&&(this.selectedIndex=0),c(this).triggerHandler("change",!1)})}}),c(document).delegate(".add_event_link","click",function(a){window.thisElementFiredTheEvent=this,a.preventDefault(),w(c("#event_blank"),c(this));var b=(c(this).closest(".group_reference").find(".group_reference_checkbox").attr("id")||"").replace("group_","");c("#edit_event .context_select select.context_id").val(b).triggerHandler("change",!1),window.thisElementFiredTheEvent=undefined}),c(document).keycodes([b.t("keycodes.next_day","ctrl+right"),b.t("keycodes.previous_day","ctrl+left"),b.t("keycodes.next_week","ctrl+down"),b.t("keycodes.previous_week","ctrl+up")].join(" "),function(a){a.preventDefault(),a.stopPropagation();var c;switch(a.keyString){case b.t("keycodes.next_day","ctrl+right"):c="right";break;case b.t("keycodes.previous_day","ctrl+left"):c="left";break;case b.t("keycodes.next_week","ctrl+down"):c="down";break;case b.t("keycodes.previous_week","ctrl+up"):c="up"}y(c)}),c(document).keycodes([b.t("keycodes.next_event","j"),b.t("keycodes.previous_event","k"),b.t("keycodes.open","o"),b.t("keycodes.edit","e"),b.t("keycodes.delete","d"),b.t("keycodes.new","n"),b.t("keycodes.refresh","r")].join(" "),function(a){a.preventDefault(),a.stopPropagation();var d=c(".calendar_event.selected:first"),e=c(".calendar_day_holder.selected:first");a.keyString==b.t("keycodes.next_event","j")?x("down"):a.keyString==b.t("keycodes.previous_event","k")?x("up"):a.keyString==b.t("keycodes.open","o")?d.click():a.keyString==b.t("keycodes.delete","d")?d.length>0&&d.find(".can_delete").text()=="true"&&A(d):a.keyString==b.t("keycodes.edit","e")?d.length>0&&d.find(".can_edit").text()=="true"&&w(d,e.children(".calendar_day")):a.keyString==b.t("keycodes.new","n")?w(c("#event_blank"),e.children(".calendar_day")):a.keyString==b.t("keycodes.refresh","r")&&r()}),c("#edit_calendar_event_form").formSubmit({object_name:"calendar_event",required:["title"],processData:function(a){a.start_time&&(a.end_time||(a.end_time=a.start_time));var b=Date.parse(a.date+" "+a.start_time);a.start_at="",a.end_at="",b?(a.time_sortable=b.toString("HH:mm"),a.event_date_string=b.toString("yyyy_MM_dd"),a.start_at=c.datetime.process(b),a.start_time=b.toString("hh:mmtt").toLowerCase()):(a.time_sortable="0",a.event_date_string=null),a.start_time&&!a.end_time&&(a.end_time=a.start_time);var d=Date.parse(a.date+" "+a.end_time);return d&&(a.end_at=c.datetime.process(d),a.end_time=d.toString("hh:mmtt").toLowerCase()),a["calendar_event[start_at]"]=a.start_at,a["calendar_event[end_at]"]=a.end_at,a},beforeSubmit:function(a){var b=c(this).data("current_event");if(!b)return!1;b.attr("id")=="event_blank"&&(b=b.clone(!0).attr("id","event_new"),b.draggable(C)),a=c.extend(a,c(this).getFormData({object_name:"calendar_event"})),a.start_time_string=a.start_time,a.end_time_string=a.end_time,a.event_type="calendar_event",b.fillTemplateData({data:a});var d=c(this).find("select.context_id").val();b.addClass("group_"+d),c("#group_"+d).attr("checked",!0).change(),b.find(".calendar_event_text").attr("title",a.title),b.addClass("event_pending");var e=c(".calendar_undated");return a.event_date_string&&(e=c("#day_"+a.event_date_string)),j(b,e),c("#edit_event").dialog("close"),b},success:function(a,b){b.removeClass("event_pending"),c(document).triggerHandler("add_event",b),q(a,b),m(a)}}),c("#edit_calendar_event_form input[name='date'],#edit_assignment_form input[name='date']").change(function(){c(".calendar_day.hover").removeClass("hover"),c(".calendar_day_holder.selected").removeClass("selected");var a=c(this).val().split("/"),b=null;a.length==3&&(b=a[2]+"_"+a[0]+"_"+a[1]),b&&t(c("#day_"+b))}),c("#edit_assignment_form").formSubmit({object_name:"assignment",required:["title"],processData:function(a){var b=Date.parse(a.due_at);return a.time_sortable="0",a.event_date_string="",a.start_time="",b&&(a["assignment[due_at]"]=c.datetime.process(b),a.time_sortable=b.toString("HH:mm"),a.event_date_string=b.toString("yyyy_MM_dd"),a.start_time=b.toString("hh:mmtt").toLowerCase()),a.start_time_string=a.start_time,a.end_time_string=a.start_time,a.event_type="assignment",a},beforeSubmit:function(a){var b=c(this).data("current_event");if(!b)return!1;b.attr("id")=="event_blank"&&(b=b.clone(!0).attr("id","event_new"),b.draggable(C));var d=c(this).find("select.context_id").val();return b.addClass("group_"+d),c("#group_"+d).attr("checked",!0).change(),b.find(".calendar_event_text").attr("title",a.title),b.fillTemplateData({data:a}),b.find(".calendar_event_text").attr("title",a.title),b.addClass("event_pending"),j(b,c("#day_"+a.event_date_string)),c("#edit_event").dialog("close"),b},success:function(a,b){b.removeClass("event_pending"),c(document).triggerHandler("add_event",b),q(a,b),m(a)}}),c(".refresh_calendar_link").click(function(a){a.preventDefault();var b=c(this).parents(".calendar_month");b.length>0?p(b):r()}),c("#event_details").delegate(".edit_event_link","click",function(a){a.preventDefault();var b=c("#event_details"),d=b.data("current_event"),e=b.data("current_day");d&&e&&w(d,e)}).delegate(".delete_event_link","click",function(a){a.preventDefault();var b=c("#event_details"),d=b.data("current_event");A(d)}),c(document).fragmentChange(function(a,b){if(b.indexOf("#calendar_event_")==0||b.indexOf("#assignment_")==0){var d="event_"+b.substring(1),e=c("#"+d);e.length>0&&(e.addClass("selected"),c("html,body").scrollTo(e.parents(".calendar_day")),e.click())}}),c("#edit_event_tabs").tabs().bind("tabsselect",function(a,b){c(document).triggerHandler("event_tab_select",b.index),c(b.panel).find("select.context_id").triggerHandler("change")});var f=d.get("checked_calendar_codes");if(f){var g=0;for(var h in f){var i=c("#group_"+f[h]);i.attr("checked",!0),i.length>0&&g++}g==0&&c(".group_reference .group_reference_checkbox:lt(10)").each(function(){c(this).attr("checked",!0)})}else c(".group_reference .group_reference_checkbox:lt(10)").each(function(){c(this).attr("checked",!0)});setTimeout(r,3e3),setInterval(r,6e5),setTimeout(z,1e3)}),c(function(){c("#right-side").delegate(".group_reference","mouseenter mouseleave",function(a){c(this).find(".add_event_link").showIf(a.type==="mouseenter"&&c(this).find(".group_reference_checkbox").attr("checked"))})}),c(function(){c(document).fragmentChange(function(){var a=null;try{a=c.parseJSON(c.decodeFromHex(document.location.hash.substring(1)))}catch(b){}if(a&&a.month&&parseInt(a.month,10)&&a.year&&parseInt(a.year,10)){var d=c(".calendar_month .month_name").text()+" "+c(".calendar_month .year_number").text(),e=Date.parse(d)||new Date,f=Date.parse(a.month+" "+a.year)||new Date;if(f.getMonth()!=e.getMonth()||f.getFullYear()!=e.getFullYear()){var g=c.datepicker.formatDate("mm/dd/yy",f);k(c(".calendar_month"),g),k(c(".calendar_container").find(".mini_month"),g)}}if(a&&a.show){var h=a.show.split(","),i=!h&&!h.length,j=!1,l=[];c(".group_reference_checkbox").each(function(){var a=this.checked;j=(this.checked=c.inArray(c(this).attr("id"),h)>-1||i)||j,this.checked!=a&&l.push(this)}),!j&&h!="nothing"&&c(".group_reference_checkbox").each(function(){var a=this.checked;this.checked=!0,this.checked!=a&&l.push(this)}),c.each(l,function(){c(this).triggerHandler("change","dontUpdateFragment")})}}),c(".group_reference_checkbox").bind("change click",function(a,b){setTimeout(function(){if(a==="dontUpdateFragment")return!0;var a=null;try{a=c.parseJSON(c.decodeFromHex(document.location.hash.substring(1)))}catch(b){}var d=[];c(".group_reference_checkbox:checked").each(function(){d.push(c(this).attr("id"))});var e={};e.show=d.join(",")||"nothing";var f=c(".calendar_month:first .month_number").text(),g=c(".calendar_month:first .year_number").text();e.month=a&&a.month||f,e.year=a&&a.year||g,location.replace("#"+c.encodeToHex(JSON.stringify(e)))},10)})})}),function(){require(["calendar","calendar_move","content_locks"])}.call(this),define("compiled/bundles/calendar",function(){})