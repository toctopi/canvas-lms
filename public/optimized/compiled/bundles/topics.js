define("translations/topics",["i18nObj","jquery"],function(a,b){b.extend(!0,a,{translations:{es:{topics:{add_new_announcement:"Agregar un Aviso Nuevo",add_new_entry:"Agregar una Nueva Entrada",add_new_topic:"Agregar un Tema Nuevo",adding:"Agregando...",confirms:{delete_announcement:"¿Seguro que quiere borrar este anuncio?",delete_entry:"¿Seguro que quiere borrar esta entrada?",delete_topic:"¿Seguro que quiere borrar este tema?"},default_topic_title:"Título del Tema",default_user_name:"Nombre de Usuario",errors:{enter_a_message:"Incluya un mensaje",invalid_date_time:"Seleccione una fecha válida"},expand:"Expandir",loading:"Cargando...",no_replies:"Sin Respuestas",no_title:"Sin Título",number_of_replies:{one:"1 Respuesta",other:"%{count} Respuestas",zero:"Sin Respuestas"},reordering:"Reordenando...",titles:{assignment_rubric_details:"Detalles de la Rúbrica de la Tarea",lock_this_topic:"Bloquear este Tema",reorder_discussions:"Reordenar las Discusiones",unlock_this_topic:"Desbloquear este Tema"},update_announcment:"Actualizar el Aviso",update_entry:"Actualizar la Contribución",update_topic:"Actualizar el Tema",updating:"Actualizando..."}}}})}),define("topics",["INST","i18n!topics","jquery","wikiSidebar","ajax_errors","jquery.ajaxJSON","jquery.instructure_date_and_time","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.keycodes","jquery.loadingImg","jquery.templateData","compiled/tinymce","tinymce.editor_box","vendor/jquery.scrollTo","jqueryui/sortable"],function(a,b,c,d){function e(a,d){a||(a=c("#topic_blank").clone(!0),a.find(".delete_topic_link").show(),a.find(".edit_topic_link").show(),a.appendTo(c("#topic_list")).show(),a.attr("id","topic_new"));var e=d.discussion_topic||d.announcement;e.assignment&&(e.points_possible=e.assignment.points_possible,e.due_at=c.parseFromISO(e.assignment.due_at).datetime_formatted,e.assignment_group_id=e.assignment.assignment_group_id);var f=c("#topics_reorder_list topic_"+e.id);f.length===0&&(f=c("<li class='topic'/>"),f.addClass("topic_"+e.id),c("#topics_reorder_list").prepend(f)),f.text(e.title),c("#topics_reorder_list").sortable("refresh"),a.toggleClass("has_podcast",!!e.podcast_enabled),c("#podcast_link_holder").showIf(e.podcast_enabled),a.toggleClass("announcement",!!d.announcement),e.user_name=e.user_name?e.user_name:"",delete e.user;var g=c.parseFromISO(e.created_at,"event");e.post_date=g.datetime_formatted,e.assignment&&(e.assignment_title=e.assignment.title,a.find(".topic_assignment_link").attr("href",c.replaceTags(a.find(".topic_assignment_url").attr("href"),"assignment_id",e.assignment_id)),e.assignment.points_possible&&(e.assignment_points_possible=e.assignment.points_possible),c.each(["id","assignment_group_id","points_possible","due_at"],function(a,b){e["assignment_"+b]||(e["assignment_"+b]=e.assignment[b])})),a.find(".attachment_data").showIf(e.attachment);if(e.attachment){e.attachment_name=e.attachment.display_name;var h=c.replaceTags(a.find(".topic_attachment_url").attr("href"),"attachment_id",e.attachment.id);a.find(".attachment_name").attr("href",h)}e.workflow_state=="post_delayed"&&e.delayed_post_at&&(e.delayed_post_at=c.parseFromISO(e.delayed_post_at).datetime_formatted),a.find(".locked_icon").toggleClass("locked",e.workflow_state=="locked"),e.assignment_title=e.title,a.find(".content .message_html").val(e.message),a.fillTemplateData({id:"topic_"+e.id,data:e,htmlValues:["message"],hrefValues:["id","user_id","discussion_topic_id"]}),a.find("a.user_name").text().length&&a.find("a.user_name").show(),e.discussion_subentry_count&&a.find(".replies").text(b.t("number_of_replies",{zero:"No Replies",one:"1 Reply",other:"%{count} Replies"},{count:e.discussion_subentry_count})),a.find(".for_assignment").showIf(e.assignment_id),a.find(".assignment_points").showIf(e.assignment&&e.assignment.points_possible),a.find(".delayed_posting").showIf(e.workflow_state=="post_delayed"&&e.delayed_post_at),a.find(".edit_topic_link").showIf(e.permissions&&e.permissions.update),a.find(".delete_topic_link").showIf(e.permissions&&e.permissions["delete"])}function f(a){g(!0);var e=c("#add_topic_form").clone(!0);a.attr("id")=="topic_id"&&a.attr("id","topic_new");var f=a.attr("id");e.addClass("add_topic_form_new").attr("id","add_topic_form_"+f).find(".topic_content").addClass("topic_content_new").attr("id","topic_content_"+f);var h=a.getTemplateData({textValues:["title","is_announcement","delayed_post_at","assignment[id]","attachment_name","assignment[points_possible]","assignment[assignment_group_id]","assignment[due_at]","assignment[is_frozen]","podcast_enabled","podcast_has_student_posts","require_initial_post","threaded"],htmlValues:["message"]});h.message=a.find(".content .message_html").val(),h.title==b.t("no_title","No Title")&&(h.title=b.t("default_topic_title","Topic Title")),h.delayed_post_at&&(h.delay_posting="1"),c.each(["podcast_enabled","podcast_has_student_posts","require_initial_post","threaded"],function(a,b){h[b]==="true"&&(h[b]="1")});if(h["assignment[id]"])if(h["assignment[is_frozen]"]){var i=e.find(".assignment_options");i.text(b.t("assignment_is_locked","Some properties for this assignment are locked, go to the assignment page to edit."))}else h["assignment[set_assignment]"]="1";var j=a.hasClass("announcement")?b.t("update_announcment","Update Announcement"):b.t("update_topic","Update Topic");e.attr("method","PUT"),e.attr("action",a.find(".edit_topic_url").attr("href")),e.find(".discussion_remove_attachment").val("0"),e.find(".add_attachment").show().end().find(".no_attachment").showIf(!h.attachment_name).end().find(".current_attachment").showIf(h.attachment_name).end().find(".upload_attachment").hide().end().find(".attachment_name").text(h.attachment_name||"").end().find(".more_options_link").show().end().find(".more_options_holder").hide(),e.find(".datetime_field").datetime_field(),e.find(".announcement_option").showIf(a.attr("id")=="topic_new"),a.attr("id")=="topic_new"&&(j=a.hasClass("announcement")?b.t("add_new_announcement","Add New Announcement"):b.t("add_new_topic","Add New Topic"),e.attr("method","POST"),e.attr("action",c("#topic_urls .add_topic_url").attr("href"))),e.fillFormData(h,{object_name:"discussion_topic"}),e.find(".is_announcement").change(),a.find(".content").show().find(".links").hide().end().find(".message").hide().end().append(e.show()).end().find(".header").find(".post_date").hide().end().find(".link_box").hide().end().find(".title").hide().end().find(".topic_icon").hide().end().prepend("<span class='add_message title'>"+j+"</span>").hide(),e.find("#topic_content_"+f).editorBox(),e.find("#topic_content_"+f).editorBox("set_code",h.message),d&&(d.attachToEditor(e.find("#topic_content_"+f)),d.show(),c("#sidebar_content").hide()),e.find("button.submit_button").html(j),e.find("input[type='text']:first").focus().select(),c("html,body").scrollTo(e)}function g(b){var e=c(".add_topic_form_new");if(e.length==0)return;e.hideErrors();var f=e.parents(".topic");try{e.find(".topic_content_new").editorBox("destroy")}catch(g){a.log_error({message:g.message||g.description||"",line:g.lineNumber||""})}e.hide(),f.find(".header .add_message").remove(),f.find(".header").show().find(".post_date").show().end().find(".add_message").remove().end().find(".title").show().end().find(".topic_icon").css("display","").end().find(".link_box").show().end().end().find(".content").show().find(".links").show().end().find(".message").show().end(),e.appendTo(c("body")),d&&(d.hide(),c("#sidebar_content").show()),b&&(f.attr("id")=="topic_new"&&f.remove(),c("#topic_list > .topic").length===0&&c("#no_topics_message").show())}var h=window.attachAddAssignment,i=window.topics={};i.updateTopic=e,c(document).ready(function(){d&&(d.init(),c.scrollSidebar()),h&&c.isFunction(h)&&h(c("#add_topic_form .assignment_id_value"),null,".assignment_id_value",function(){return c(this).parents("form").find(".topic_title").val()}),c(".reorder_topics_link").click(function(a){a.preventDefault(),c("#reorder_topics_dialog").dialog("close").dialog({autoOpen:!1,title:b.t("titles.reorder_discussions","Reorder Discussions"),width:400,modal:!0}).dialog("open")}),c("#topics_reorder_list").sortable({axis:"y"}),c("#reorder_topics_form").submit(function(){var a=[];c("#reorder_topics_form .reorder_topics_button").text(b.t("reordering","Reordering...")),c("#reorder_topics_form button").attr("disabled",!0),c("#topics_reorder_list li").each(function(){var b=c(this).attr("class").split(/\s/),d=null;for(var e in b){var f=b[e];f.match(/topic_/)&&(d=f.substring(6))}d&&a.push(d)}),c("#reorder_topics_ids").val(a.join(","))}),c("#reorder_topics_form .cancel_button").click(function(){c("#reorder_topics_dialog").dialog("close")}),c("#add_topic_form .topic_title").formSuggestion(),c("#add_topic_form").find(".delay_posting").change(function(){c(this).parents("form").find(".delay_posting_option").showIf(c(this).attr("checked"))}).change().end().find(".set_assignment").change(function(){c(this).parents("form").find(".set_assignment_option").showIf(c(this).attr("checked")),c(this).parents("form").find(".announcement_option").showIf(!c(this).attr("checked")&&c(this).parents("form").attr("id").match(/_new$/))}).change().end().find(".is_announcement").change(function(){c(this).parents("form").find(".assignment_options").showIf(!c(this).attr("checked")),c(this).parents("form").find(".podcast_options").showIf(!c(this).attr("checked"))}).end().find(".podcast_enabled_checkbox").change(function(){c(this).parents("form").find(".podcast_sub_options").showIf(c(this).attr("checked"))}).end().find(".more_options_link").click(function(a){a.preventDefault(),c(this).hide().parents("form").find(".more_options_holder").show()}).end().find(".add_attachment_link").click(function(a){a.preventDefault();var b=c(this).parents("form");b.find(".no_attachment").slideUp().addClass("current"),b.find(".current_attachment").hide().removeClass("current"),b.find(".upload_attachment").slideDown()}).end().find(".delete_attachment_link").click(function(a){a.preventDefault();var b=c(this).parents("form");b.find(".current_attachment").slideUp().removeClass("current"),b.find(".no_attachment").slideDown().addClass("current"),b.find(".upload_attachment").hide(),b.find(".discussion_remove_attachment").val("1")}).end().find(".replace_attachment_link").click(function(a){a.preventDefault();var b=c(this).parents("form");b.find(".upload_attachment").slideDown(),b.find(".no_attachment").hide().removeClass("current"),b.find(".current_attachment").slideUp().addClass("current")}).end().find(".cancel_attachment_link").click(function(a){a.preventDefault();var b=c(this).parents("form");b.find(".no_attachment.current").slideDown(),b.find(".upload_attachment").slideUp(),b.find(".current_attachment.current").slideDown(),b.find(".attachment_uploaded_data").val(""),b.find(".discussion_remove_attachment").val("0")}),c(".topic .editable_locked_icon").click(function(a){a.preventDefault();var d=c(this).parents(".topic"),e=c(this).hasClass("locked")?"0":"1",f=c(this);f.loadingImage({image_size:"small"});var g=c(this).parents(".topic").find(".edit_topic_link").attr("href");c.ajaxJSON(g,"PUT",{"discussion_topic[lock]":e},function(a){f.loadingImage("remove");var c=a.discussion_topic||a.announcement;d.find(".locked_icon").toggleClass("locked",c.workflow_state=="locked"),d.find(".locked_icon").attr("title",c.workflow_state=="locked"?b.t("titles.unlock_this_topic","Unlock this Topic"):b.t("titles.lock_this_topic","Lock this Topic"))},function(a){f.loadingImage("remove")})}),c("#add_topic_form").formSubmit({fileUpload:function(a){var b=a["attachment[uploaded_data]"];return b&&c(this).attr("action",c(this).attr("action")+".text"),b},object_name:"discussion_topic",required:["title"],processData:function(a){var d=c(this).getFormData({object_name:"discussion_topic"});try{d.message=c(this).find(".topic_content_new").editorBox("get_code")}catch(e){return}return d.message=c(this).find(".topic_content_new").editorBox("get_code"),d["discussion_topic[message]"]=d.message,d.message?a.delay_posting=="1"&&!d["discussion_topic[delayed_post_at]"]?(c(this).find(".delayed_post_at_value").errorBox(b.t("errors.invalid_date_time","Please select a valid date time")),!1):d:(c(this).find(".topic_content").is(":visible")?c(this).find(".topic_content").errorBox(b.t("errors.enter_a_message","Please enter a message")):c(this).find(".topic_content").next().find(".mceIframeContainer").errorBox(b.t("errors.enter_a_message","Please enter a message")),!1)},beforeSubmit:function(a){var d=b.t("updating","Updating..."),e=c(this).parents(".topic");return e.attr("id")=="topic_new"&&(d=b.t("adding","Adding..."),e.attr("id","topic_id")),a.post_date=d,e.fillTemplateData({data:a,except:["message"]}),e.find(".content").loadingImage(),g(),e},success:function(a,b){e(b,a),b.find(".content").loadingImage("remove")},error:function(a,c){return c.find(".content").loadingImage("remove"),f(c),c.attr("id")=="topic_id"&&(addingMessage=b.t("adding","Adding..."),c.attr("id","topic_new")),c.find("form")}}),c("#add_topic_form .cancel_button").click(function(a){var b=c(this).parents(".topic");g(!0)}),c(".add_topic_link").click(function(a){a.preventDefault(),c("#no_topics_message").hide();if(c("#topic_new").length>0)return;var b=c("#topic_blank").clone(!0);b.find(".delete_topic_link").show(),b.find(".edit_topic_link").show(),b.prependTo(c("#topic_list")).show(),b.attr("id","topic_new"),f(b)}),c(".switch_topic_views_link").click(function(a){a.preventDefault(),c(this).parents("form").find("textarea").editorBox("toggle")}),c(".topic").bind("mouseover focus",function(){c(this).find(".header .locked_icon").addClass("locked_icon_hover")}).bind("mouseout blur",function(){c(this).find(".header .locked_icon").removeClass("locked_icon_hover")}),c(".edit_topic_link").click(function(a){a.preventDefault(),$topic=c(this).parents(".topic"),$topic.length==0&&($topic=c("#topic_list .topic:visible:first")),$topic.length>0&&f($topic)}),c(".delete_topic_link").click(function(a){a.preventDefault();var d=c("form:first").getFormData().authenticity_token,e=c(this).parents(".topic");e.confirmDelete({message:e.hasClass("announcement")?b.t("confirms.delete_announcement","Are you sure you want to delete this announcement?"):b.t("confirms.delete_topic","Are you sure you want to delete this topic?"),token:d,url:c(this).attr("href"),success:function(){c(this).fadeOut("slow",function(){c(this).remove(),c("#topic_list > .topic").length||c("#no_topics_message").show()})},error:function(a){c(this).formErrors(a)}})}),c("#add_topic_form :text").keycodes("tab esc",function(a){if(c(this).hasClass("topic_title")&&a.keyCode==9){c(this).blur(),c(this).parents("form").find(".topic_content_new").editorBox("focus"),a.preventDefault();return}a.keyCode==27&&(a.preventDefault(),g(!0))}),c(document).fragmentChange(function(a,b){b=="#new"&&c(".add_topic_link:visible:first").click();var d=(b||"").match(/#edit_topic_(\d+)/);if(d){var e=c("#topic_"+d[1]);e.length&&f(e)}}).fragmentChange()})}),function(){require(["topics"])}.call(this),define("compiled/bundles/topics",function(){})