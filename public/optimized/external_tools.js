define(["i18n!external_tools","jquery","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_plugins","jquery.templateData"],function(a,b){b(document).ready(function(){var c=b("#external_tools_dialog");b(".add_tool_link").click(function(d){d.preventDefault();var e={domain:"",url:"",config_url:"",config_xml:"",description:"",name:"",custom_fields_string:"",privacy:"anonymous",consumer_key:"",shared_secret:""};c.dialog("close").dialog({autoOpen:!1,title:a.t("titles.edit_external_tool","Edit External Tool"),width:600,height:420}).dialog("open"),c.find(".shared_secret_note").hide(),c.find("form").attr("method","POST").attr("action",c.find(".external_tools_url").attr("href")),c.fillFormData(e,{object_name:"external_tool"}),c.find(".config_type_option").show(),b("#external_tool_match_by").val("domain").change(),b("#external_tool_config_type").val("manual").change()}),c.find("form").formSubmit({beforeSubmit:function(c){b(this).find("button").attr("disabled",!0).filter(".save_button").text(a.t("messages.saving_tool_settings","Saving Tool Settings..."))},success:function(d){b(this).find("button").attr("disabled",!1).filter(".save_button").text(a.t("buttons.save_tool_settings","Save Tool Settings")),c.dialog("close");var e=b("#external_tool_"+d.id);e.length==0&&(e=b("#external_tool_blank").clone(!0).removeAttr("id"),b("#external_tools").append(e)),e.fillTemplateData({data:d,dataValues:["id","workflow_state"],hrefValues:["id"],id:"external_tool_"+d.id}),e.toggleClass("has_editor_button",d.has_editor_button).toggleClass("has_resource_selection",d.has_resource_selection).toggleClass("has_course_navigation",d.has_course_navigation).toggleClass("has_user_navigation",d.has_user_navigation).toggleClass("has_account_navigation",d.has_account_navigation),e.find(".tool_url").showIf(d.url).end().find(".tool_domain").showIf(d.domain),e.show()},error:function(c){b(this).find("button").attr("disabled",!1).filter(".save_button").text(a.t("errors.save_tool_settings_failed","Save Tool Settings Failed"))}}),c.find(".cancel_button").click(function(){c.dialog("close")}),b("#external_tools").delegate(".edit_tool_link","click",function(d){d.preventDefault();var e=b(this).parents(".external_tool"),f=e.getTemplateData({textValues:["name","description","domain","url","consumer_key","custom_fields_string"],dataValues:["id","workflow_state"]});f.privacy_level=f.workflow_state,b("#external_tool_match_by").val(f.url?"url":"domain").change(),c.find(".shared_secret_note").show(),c.find("form").attr("method","PUT").attr("action",e.find(".update_tool_url").attr("rel")),c.fillFormData(f,{object_name:"external_tool"}),c.dialog("close").dialog({autoOpen:!1,title:a.t("titles.edit_external_tool","Edit External Tool"),width:600,height:420}).dialog("open"),c.find(".config_type_option").hide(),b("#external_tool_config_type").val("manual").change()}).delegate(".delete_tool_link","click",function(c){c.preventDefault();var d=b(this).parents(".external_tool"),e=d.find(".update_tool_url").attr("rel");d.confirmDelete({url:e,message:a.t("prompts.remove_tool","Are you sure you want to remove this tool?  Any courses using this tool will no longer work."),success:function(){b(this).slideUp(function(){b(this).remove()})}})}),b("#external_tool_match_by").change(function(){b(this).val()=="url"?b(this).parents("form").find(".tool_domain").hide().find(":text").val("").end().end().find(".tool_url").show():b(this).parents("form").find(".tool_url").hide().find(":text").val("").end().end().find(".tool_domain").show()}),b("#external_tool_config_type").change(function(a){b("#external_tool_form .config_type").hide(),b("#external_tool_form .config_type."+b(this).val()).show()})})})